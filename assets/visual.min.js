!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-let"),require("d3-collection"),require("d3-timer"),require("d3-selection"),require("d3-dispatch"),require("d3-dsv"),require("d3-array"),require("d3-time-format"),require("d3-transition"),require("d3-format"),require("d3-scale-chromatic")):"function"==typeof define&&define.amd?define(["exports","d3-let","d3-collection","d3-timer","d3-selection","d3-dispatch","d3-dsv","d3-array","d3-time-format","d3-transition","d3-format","d3-scale-chromatic"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,r,i,o,a,s,u,l,c,d){"use strict";function f(t){function n(t){Wt(this).el=t}return n.prototype=e.assign({},Xt,t),n}function h(t,n){if(e.isString(t)){if(!n)return t;var r=function(t){var n=Dt.handlebars;if(n||(n=e.inBrowser?window.handlebars:require("handlebars")),n)return n.compile(t);Nt("compile function requires handlebars")}(t);if(!r)return t;t=r}return t(n)}function p(t,e){var n=i.select(document.createElement("div"));n.html(h(t,e));var r=n.node().children;return 1!==r.length&&Nt("HtmlElement function should return one root element only, got "+r.length),r[0]}function m(t){this.response=t,this.description=t.statusText}function g(t){if(t.status>=300)throw new m(t);var e=(t.headers.get("content-type")||"").split(";")[0];if("application/json"===e)return t.json();throw new Error("Expected JSON content type, got "+e)}function v(t,e,n){return n?p(t,e):h(t,e)}function y(t,e,n){switch(e.type){case Kt.IDENTIFIER:return t[e.name];case Kt.LITERAL:return n?t[e.value]:e.value;case Kt.ARRAY_EXP:return e.elements.map(function(e){return y(t,e)});case Kt.LOGICAL_EXP:case Kt.BINARY_EXP:return function(t,e,n){de[t]||(de[t]=new Function("a","b","return a "+t+" b"));return de[t](e,n)}(e.operator,y(t,e.left),y(t,e.right));case Kt.CALL_EXP:return function(t,e,n){var r;n=n.map(function(e){return y(t,e)}),e.type!==Kt.IDENTIFIER&&(t=y(t,e.object),e=e.property);if(!(r=t[e.name]))throw new EvalError('callable "'+e.name+'" not found in context');return r.apply(t,n)}(t,e.callee,e.arguments);case Kt.MEMBER_EXP:return y(y(t,e.object),e.property,!0);case Kt.CONDITIONAL_EXP:return y(t,e.test)?y(t,e.consequent):y(t,e.alternate);case Kt.UNARY_EXP:return function(t,e){ce[t]||(ce[t]=new Function("arg","return "+t+" arg"));return ce[t](e)}(e.operator,y(t,e.argument))}}function b(t,e){switch(1===arguments.length&&(e=n.set()),t.type){case Kt.IDENTIFIER:e.add(t.name);break;case Kt.ARRAY_EXP:t.elements.forEach(function(t){return b(t,e)});break;case Kt.LOGICAL_EXP:case Kt.BINARY_EXP:b(t.left,e),b(t.right,e);break;case Kt.CALL_EXP:b(t.callee,e),t.arguments.forEach(function(t){return b(t,e)});break;case Kt.MEMBER_EXP:e.add(x(t));break;case Kt.CONDITIONAL_EXP:b(t.test,e),b(t.consequent,e),y(t.alternate,e);break;case Kt.UNARY_EXP:b(t.argument,e)}return e}function x(t){return t.type===Kt.IDENTIFIER?t.name:x(t.object)+"."+t.property.name}function w(t){this.codes=Kt,this.expr=t,this.parsed=le(t)}function k(t,e,r,i){var o=n.map(),a=null;o.set("",me()),Object.defineProperties(pe(t),{$events:{get:function(){return o}},parent:{get:function(){return r}},isolated:{get:function(){return i}}}),t.$child=function(e){return null===a&&(a=function(t){function e(e){k(this,e,t,!1)}return e.prototype=t,e}(t)),new a(e)},t.$update(e)}function E(t){return e.isObject(t)&&"[object d3Model]"===t.toString()}function _(t,n,r){function i(e){if(a&&(e=a.get.call(t)),e!==r){var i=t.$$name||"model";jt("updating "+i+"."+n),t.$change(n,r).$change(),r=o(e,r)}}function o(n,r){return n===r?r:e.isArray(n)?function(t,n){E(n)&&n.$off();e.isArray(n)||(n=[]);for(var r=0;r<t.length;++r)t[r]=o(t[r],n[r]);return t}(n,r):E(r)?function(t,e){return ge(t)?(e.$update(t),e):(e.$off(),o(t))}(n,r):ge(n)?t.$new(n):n}var a;t.$events.set(n,me()),Object.defineProperty(t,n,function(){var o={get:function(){return r}};return e.isFunction(r)&&(r={get:r}),ge(r)&&e.isFunction(r.get)?(r=(a=r).get.call(t),a.reactOn?a.reactOn.forEach(function(e){t.$on(e+"."+n,i)}):Nt("reactive lazy property "+n+" does not specify 'reactOn' list or properties"),e.isFunction(a.set)&&(o.set=a.set)):o.set=i,o}()),r=o(r),t.$change(n)}function M(t,e){var n=t.$events.get(e);return!n&&t.parent?M(t.parent,e):n}function A(t,e){e?t.on("change."+e,null):t.on("change",null)}function z(t,e){k(this,t,e,!0)}function O(t){return new z(t)}function S(t,n,r){var i=3===arguments.length?n[r]:void 0;e.isFunction(i)||2===arguments.length?$(t,n).events.add(""):i instanceof O?(S(t,i),(n=n.$owner(r))&&$(t,n).events.add("")):((n=n.$owner(r)||n).$isReactive(r)||n.$set(r,i),$(t,n).events.add(r))}function $(t,e){var r=t.get(e.uid);return r||(r={model:e,events:n.set()},t.set(e.uid,r)),r}function P(t,r,i){function a(r){var a=e.pop(r,"parent"),s=n.map(a?a.components:null),u=n.map(a?a.directives:i),h=o.dispatch("message","mounted"),p={};l.each(function(t,e){s.set(e,t)}),c.each(function(t,e){u.set(e,t)}),C(s,e.pop(r,"components")),T(u,e.pop(r,"directives")),Object.defineProperties(this,{name:{get:function(){return t}},components:{get:function(){return s}},directives:{get:function(){return u}},parent:{get:function(){return a}},root:{get:function(){return a?a.root:this}},cache:{get:function(){return a?a.cache:p}},props:{get:function(){return f}},uid:{get:function(){return this.model.uid}},events:{get:function(){return h}}}),this.model=e.assign({},e.isFunction(d)?d():d,e.pop(r,"model")),we.call("component-created",void 0,this)}function s(t){return new a(t)}e.isFunction(r)&&(r={render:r});var u=e.assign({},r),l=C(n.map(),e.pop(u,"components")),c=T(n.map(),e.pop(u,"directives")),d=e.pop(u,"model"),f=e.pop(u,"props");return a.prototype=e.assign({},Ut,ke,u),s.prototype=a.prototype,s}function C(t,e){return n.map(e).each(function(e,n){t.set(n,P(n,e,ke))}),t}function T(t,e){return n.map(e).each(function(e,n){t.set(n,be(e))}),t}function j(t,e,n){return Object.defineProperty(Wt(t),"el",{get:function(){return e}}),t.select(e).view(t).mount(null,n).then(function(){return function(t,e){var n=t.parent;t.childrenMounted(),n&&!n.isMounted?n.events.on("mounted."+t.uid,function(){D(t,e)}):D(t,e)}(t,n)})}function D(t,e){return void 0===t.isMounted?(t.isMounted=!1,!1):(t.isMounted?Nt("view "+t.name+" already mounted"):(t.isMounted=!0,t.mounted(),e&&e(t),t.events.call("mounted",void 0,t,e),t.events.on("mounted",null),we.call("component-mounted",void 0,t)),!0)}function N(){this.attrs={},this.all=[]}function q(t,e,n,r){if(t&&t.tagName){var i=e.components.get(t.tagName.toLowerCase()),o=_e(t,e.directives),a=o.preMount();if(a)return a.execute(e.model);var s=void 0;return s=i?[i({parent:e}).mount(t,n,r)]:ve(t.children).map(function(t){return q(t,e,n,r)}),Promise.all(s).then(function(){return o.execute(e.model)})}}function R(){var t=this.__d3_directives__,e=this.__d3_view__;t&&(t.all.forEach(function(t){return t.destroy()}),delete this.__d3_directives__),e&&(e.destroy(),delete this.__d3_view__)}function F(){document.removeEventListener("DOMContentLoaded",F),window.removeEventListener("load",F),L()}function L(){for(var t=void 0;Dt.readyCallbacks.length;)t=Dt.readyCallbacks.shift(),r.timeout(t)}function W(t){var n=this.model.data.children;if(n){if(!e.isArray(n))return Pe("children should be an array of fields, for "+(void 0===n?"undefined":De(n))),t;t.selectAll(".d3form").data(n).enter().append(X).classed("d3form",!0)}return t}function X(t){var e=function(t){var e=t.type||"text";return Ne[e]||e}(t);return e||(Pe("Could not find form component "+t.type),e="input",t.type="hidden"),document.createElement("d3-form-"+e)}function Y(t){var e=t.attr("min"),n=t.attr("max");return e=null===e?-1/0:+e,n=null===n?1/0:+n,[e,n]}function H(t,e,n){var r=Ue[n.attr("type")]||Ue[n.node().tagName.toLowerCase()];if(!r)return e;var i=void 0;return r.forEach(function(r){(i=Ue.wrappers[r])?e=i(t,e,n):Pe("Could not find form field wrapper "+r)}),e}function I(t,n){!e.isArray(t)&&arguments.length||(t={store:n,data:t||[],dimensions:{}}),Object.defineProperties(this,{_inner:{get:function(){return t}},store:{get:function(){return t.store}},data:{get:function(){return t.data}},dimensions:{get:function(){return t.dimensions}},type:{get:function(){return"dataframe"}}})}function B(t){var e=(t.headers.get("content-type")||"").split(";")[0];return rn.has(e)?t.text().then(a.csvParse):"text/tab-separated-values"===e?t.text().then(a.tsvParse):"application/json"===e?t.json():(en("Cannot load content type '"+e+"'"),[])}function V(t){this.frames=n.map(),Object.defineProperties(this,{store:{get:function(){return t}},type:{get:function(){return"frameCollection"}}})}function G(t,e){return t.reduce(function(t,n){return void 0!==e(n)&&(t+=1),t},0)}function U(t,n,r){if(e.isArray(r)?t=t.new(r):r&&(t=r),n.length){var i=n.splice(0,1)[0],o=i?i(t):null;return e.isPromise(o)?o.then(function(e){return U(t,n,e)}):U(t,n,o)}return t}function K(t){var r=n.map();Object.defineProperties(this,{sources:{get:function(){return r}}}),this.transforms=e.assign({},wn),this.dataCount=0,this.model=t&&e.isFunction(t.$child)?t:O(t)}function J(t,e){return"string"==typeof t&&t.indexOf("%")===t.length-1?Mn(.01*parseFloat(t)*e):+t}function Z(t,e){var n={width:e.width,height:e.height};return n.width||(n.width=function(t){var e=Q(t,"width");if(e)return function(t){var e=t.getBoundingClientRect().width,n=i.select(t),r=tt(n.style("padding-left")),o=tt(n.style("padding-right"));return e-r-o}(e)}(t),n.width?n.widthElement=function(t){return Q(t,"width")}(t):n.width=An),n.height||(n.height=function(t){var e=Q(t,"width");if(e)return function(t){var e=t.getBoundingClientRect().height,n=i.select(t),r=tt(n.style("padding-top")),o=tt(n.style("padding-bottom"));return e-r-o}(e)}(t),n.height?n.heightElement=function(t){return Q(t,"height")}(t):n.height=zn),n.height=vn(J(n.height,n.width),void 0,window.innerHeight),n}function Q(t,e){for(var n=t.node?t.node():t;n&&"BODY"!==n.tagName;){if(n.getBoundingClientRect()[e])return n;n=n.parentNode}}function tt(t){return t&&"px"==t.substring(t.length-2)?+t.substring(0,t.length-2):0}function et(t){if(e.isArray(t))return t.map(et);if(e.isObject(t)){var n={};for(var r in t)n[r]=et(t[r]);return n}return t}function nt(t){var e={},n=void 0,r=void 0,i=void 0;for(i in t)(r=t[i]).$ref&&(r=function(t){var e=t.split("/");return Sn.schema.definitions[e[e.length-1]]||{}}(r.$ref)),n=r.default,e[i]=void 0===n?null:n;return e}function rt(){var t=this.__visual__;t?(t.destroy(),jt('Removed "'+t.toString()+'" from DOM, '+Sn.live.length+" live visuals left")):dn("d3-visual without __visual__ object")}function it(t,n){function r(e,n){var r=this.initialise(e,n);Object.defineProperties(this,{element:{get:function(){return r}},sel:{get:function(){return this.select(r)}},paperType:{get:function(){return t}}})}return r.prototype=e.assign({},Ut,Nn,n),Sn.papers[t]=r,r}function ot(t,n){var r=n.options[t];void 0===r||e.isObject(r)||(n.options[t]=lt(r||0))}function at(t,e,n){return Xn.reduce(function(r,i){return r[i]=J(t[i],Yn.indexOf(i)>-1?e:n),r},{})}function st(t){delete t.__boundingBox,e.isArray(t.layers)&&t.layers.forEach(st)}function ut(){return{width:this.innerWidth,height:this.innerHeight,margin:lt(0),padding:lt(0),total:lt(0),innerWidth:this.innerWidth,innerHeight:this.innerHeight,$nomargins:this.$nomargins}}function lt(t){return{left:t,right:t,top:t,bottom:t}}function ct(t,e,n){t.select("path.domain").attr("stroke",e.stroke);var r=t.selectAll("text").attr("fill",e.stroke);if(e.hide){var i=n.range();Math.abs(i[0]-i[i.length-1])<e.hide?t.style("opacity",0):t.style("opacity",1)}e.rotate&&r.attr("transform","rotate("+e.rotate+")").style("text-anchor",e.ancor)}function dt(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ft(){}function ht(t){var e;return t=(t+"").trim().toLowerCase(),(e=Un.exec(t))?(e=parseInt(e[1],16),new vt(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1)):(e=Kn.exec(t))?pt(parseInt(e[1],16)):(e=Jn.exec(t))?new vt(e[1],e[2],e[3],1):(e=Zn.exec(t))?new vt(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Qn.exec(t))?mt(e[1],e[2],e[3],e[4]):(e=tr.exec(t))?mt(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=er.exec(t))?yt(e[1],e[2]/100,e[3]/100,1):(e=nr.exec(t))?yt(e[1],e[2]/100,e[3]/100,e[4]):rr.hasOwnProperty(t)?pt(rr[t]):"transparent"===t?new vt(NaN,NaN,NaN,0):null}function pt(t){return new vt(t>>16&255,t>>8&255,255&t,1)}function mt(t,e,n,r){return r<=0&&(t=e=n=NaN),new vt(t,e,n,r)}function gt(t){return t instanceof ft||(t=ht(t)),t?(t=t.rgb(),new vt(t.r,t.g,t.b,t.opacity)):new vt}function vt(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function yt(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new bt(t,e,n,r)}function bt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function xt(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function wt(t){if(t instanceof kt)return new kt(t.l,t.a,t.b,t.opacity);if(t instanceof zt){var e=t.h*ir;return new kt(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof vt||(t=gt(t));var n=At(t.r),r=At(t.g),i=At(t.b),o=Et((.4124564*n+.3575761*r+.1804375*i)/ar),a=Et((.2126729*n+.7151522*r+.072175*i)/sr);return new kt(116*a-16,500*(o-a),200*(a-Et((.0193339*n+.119192*r+.9503041*i)/ur)),t.opacity)}function kt(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function Et(t){return t>fr?Math.pow(t,1/3):t/dr+lr}function _t(t){return t>cr?t*t*t:dr*(t-lr)}function Mt(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function At(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function zt(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function Ot(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function St(t){this.vertical=!0,this.init(t),this.sx.rangeRound([0,this.box.innerWidth]),this.sy.rangeRound([this.box.innerHeight,0])}function $t(t){this.init(t),this.sx.rangeRound([0,this.box.innerHeight]),this.sy.rangeRound([0,this.box.innerWidth])}function Pt(t,e,n,r){this.data=t,this.stacked=r,this.x=e,this.y=n}function Ct(){var t=Oe({components:{marked:Ir,info:Gr}}).use(Ge).use(Ke).use(Pr);return we.on("component-mounted",function(t){"d3form"===t.name&&t.model.$on(function(){})}),t}var Tt="[d3-view-debug]",jt=function(t){Dt.logger.debug&&Dt.logger.debug(t)};e.logger.debug=null;var Dt={logger:e.logger,fetch:function(){if(e.inBrowser)return window.fetch}(),readyCallbacks:[],setDebug:function(t){!arguments.length||t?this.logger.debug=e.isFunction(t)?t:function(t){Dt.logger.info(Tt+" "+t)}:this.logger.debug=null},require:function(){var t=null;return e.inBrowser&&window.d3&&(t=window.d3.require),t||function(){return Promise.reject(new Error("Cannot requires libraries, d3-require is not available"))}}()},Nt=function(t){Dt.logger.warn("[d3-view] "+t)},qt=n.map({disabled:"disabled",readonly:"readOnly",required:"required"}),Rt={create:function(t){return this.arg?t:Nt("Cannot bind to empty attribute. Specify :<attr-name>")},refresh:function(t,n){if("class"===this.arg)return this.refreshClass(n);if(e.isArray(n))return Nt("Cannot apply array to attribute "+this.arg);var r=qt.get(this.arg);r?this.sel.property(r,n||!1):this.sel.attr(this.arg,n||null)},refreshClass:function(t){var n=this.sel;e.isArray(t)||(t=[t]),this.oldValue&&this.oldValue.forEach(function(t){t&&n.classed(t,!1)}),this.oldValue=t.map(function(t){var r=!0;return e.isArray(t)&&(r=t[1],t=t[0]),t&&n.classed(t,r),t})}},Ft={refresh:function(t,n){if(e.isNumber(n)&&(n=""+n),e.isString(n)){var r=this,i=this.sel,o=this.passes?this.transition(i):null;o?o.style("opacity",0).on("end",function(){i.html(n),r.selectChildren().mount(),r.transition(i).style("opacity",1)}):(i.html(n),this.selectChildren().mount())}}},Lt=function(t,e){function n(){if(null!==i)return i;var n=this,o=arguments;return i=new Promise(function(a,s){r.timeout(function(){i=null;try{a(t?t.apply(n,o):void 0)}catch(t){s(t)}},e)})}var i=null;return n.promise=function(){return i},n},Wt=function(t){return Object.defineProperty(t,"sel",{get:function(){return i.select(this.el)}}),t},Xt={on:function(t,e){var n=function(t,e,n){return Lt(function(){e.$set(n,t.value())})}(this,t,e);this.sel.on("input",n).on("change",n)},off:function(){this.sel.on("input",null).on("change",null)},value:function(t){if(!arguments.length)return this.sel.property("value");this.sel.property("value",t)}},Yt=f(),Ht=f({value:function(t){if(!arguments.length)return this.sel.property("checked");this.sel.property("checked",t)}}),It={input:Yt,textarea:Yt,select:f({value:function(t){var n,r=this.sel,o=r.selectAll("option"),a=t;if(!arguments.length)return a=[],o.each(function(){(n=i.select(this)).property("selected")&&a.push(n.attr("value")||"")}),r.property("multiple")?a:a[0]||"";e.isArray(a)||(a=[t||""]),o.each(function(){n=i.select(this),t=n.attr("value")||"",n.property("selected",a.indexOf(t)>-1)})}}),checkbox:Ht},Bt={create:function(t){var e=this.sel.attr("type"),n=this.el.tagName.toLowerCase(),r=It[e]||It[n];return r?(this.tag=new r(this.el),t):Nt("Cannot apply d3-value directive to "+n)},mount:function(t){var e=this.expression;if(e.parsed.type!==e.codes.IDENTIFIER)return Nt('d3-value expression support identifiers only, got "'+e.parsed.type+'": '+this.expression);var n=this.expression.expr;return t.$set(n,this.tag.value()),this.tag.on(t,n),t},refresh:function(t,e){this.tag.value(e)},destroy:function(){this.tag.off()}};m.prototype=Error.prototype;var Vt=function(t){return t&&!e.isFunction(t.size)?i.select(t):t},Gt={isd3:!0,providers:Dt,viewElement:p,select:function(t){return i.select(t)},selectAll:function(t){return i.selectAll(t)},createElement:function(t){return i.select(document.createElement(t))},fetch:function(t,e){var n=Dt.fetch;return 1==arguments.length?n(t):n(t,e)},fetchText:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.fetch.apply(this,[t].concat(n)).then(function(t){return t.text()})},json:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.fetch.apply(this,[t].concat(n)).then(g)},renderFromUrl:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.cache;return t in r?Promise.resolve(v(r[t],e,n)):this.fetchText(t).then(function(i){return r[t]=i,v(i,e,n)})},on:function(t,e,n){if(t=Vt(t),null===n)return t.on(e,null);t.on(e,function(){return n(i.event)})},selectChildren:function(t){return arguments.length||(t=this.el),this.selectAll(Array.prototype.slice.call(t.children))},domEvent:function(){return i.event}};Dt.transition={duration:0};var Ut=e.assign(Gt,{transition:function(t){arguments.length||(t=this.sel);var e=this.transitionDuration(t);if(e>0)return t.transition(this.uid).duration(e)},transitionDuration:function(t){if(arguments.length||(t=this.sel),t&&e.isFunction(t.transition)&&t.size()){var n=t.attr("data-transition-duration");return+(null===n?Dt.transition.duration:n)}return 0}}),Kt={COMPOUND:"Compound",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",LOGICAL_EXP:"LogicalExpression",CONDITIONAL_EXP:"ConditionalExpression",ARRAY_EXP:"ArrayExpression"},Jt=function(t,e){var n=new Error(t+" at character "+e);throw n.index=e,n.description=t,n},Zt={"-":!0,"!":!0,"~":!0,"+":!0},Qt={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},te=function(t){var e,n=0;for(var r in t)(e=r.length)>n&&t.hasOwnProperty(r)&&(n=e);return n},ee=te(Zt),ne=te(Qt),re={true:!0,false:!1,null:null},ie=function(t){return Qt[t]||0},oe=function(t,e,n){return{type:"||"===t||"&&"===t?Kt.LOGICAL_EXP:Kt.BINARY_EXP,operator:t,left:e,right:n}},ae=function(t){return t>=48&&t<=57},se=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=128&&!Qt[String.fromCharCode(t)]},ue=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t>=128&&!Qt[String.fromCharCode(t)]},le=function(t){for(var e,n,r=0,i=t.charAt,o=t.charCodeAt,a=function(e){return i.call(t,e)},s=function(e){return o.call(t,e)},u=t.length,l=function(){for(var t=s(r);32===t||9===t;)t=s(++r)},c=function t(){var e,n,i=f();return l(),63!==s(r)?i:(r++,(e=t())||Jt("Expected expression",r),l(),58===s(r)?(r++,(n=t())||Jt("Expected expression",r),{type:Kt.CONDITIONAL_EXP,test:i,consequent:e,alternate:n}):void Jt("Expected :",r))},d=function(){l();for(var e=t.substr(r,ne),n=e.length;n>0;){if(Qt.hasOwnProperty(e))return r+=n,e;e=e.substr(0,--n)}return!1},f=function(){var t,e,n,i,o,a,s,u;if(a=h(),!(e=d()))return a;for(o={value:e,prec:ie(e)},(s=h())||Jt("Expected expression after "+e,r),i=[a,o,s];(e=d())&&0!==(n=ie(e));){for(o={value:e,prec:n};i.length>2&&n<=i[i.length-2].prec;)s=i.pop(),e=i.pop().value,a=i.pop(),t=oe(e,a,s),i.push(t);(t=h())||Jt("Expected expression after "+e,r),i.push(o,t)}for(t=i[u=i.length-1];u>1;)t=oe(i[u-1].value,i[u-2],t),u-=2;return t},h=function e(){var n,i,o;if(l(),n=s(r),ae(n)||46===n)return p();if(39===n||34===n)return m();if(se(n)||40===n)return y();if(91===n)return x();for(o=(i=t.substr(r,ee)).length;o>0;){if(Zt.hasOwnProperty(i))return r+=o,{type:Kt.UNARY_EXP,operator:i,argument:e(),prefix:!0};i=i.substr(0,--o)}return!1},p=function(){for(var t,e,n="";ae(s(r));)n+=a(r++);if(46===s(r))for(n+=a(r++);ae(s(r));)n+=a(r++);if("e"===(t=a(r))||"E"===t){for(n+=a(r++),"+"!==(t=a(r))&&"-"!==t||(n+=a(r++));ae(s(r));)n+=a(r++);ae(s(r-1))||Jt("Expected exponent ("+n+a(r)+")",r)}return e=s(r),se(e)?Jt("Variable names cannot start with a number ("+n+a(r)+")",r):46===e&&Jt("Unexpected period",r),{type:Kt.LITERAL,value:parseFloat(n),raw:n}},m=function(){for(var t,e="",n=a(r++),i=!1;r<u;){if((t=a(r++))===n){i=!0;break}if("\\"===t)switch(t=a(r++)){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+="\\"+t}else e+=t}return i||Jt('Unclosed quote after "'+e+'"',r),{type:Kt.LITERAL,value:e,raw:n+e+n}},g=function(){var e,n=s(r),i=r;for(se(n)?r++:Jt("Unexpected "+a(r),r);r<u&&(n=s(r),ue(n));)r++;return e=t.slice(i,r),re.hasOwnProperty(e)?{type:Kt.LITERAL,value:re[e],raw:e}:"this"===e?{type:Kt.THIS_EXP}:{type:Kt.IDENTIFIER,name:e}},v=function(t){for(var e,n,i=[],o=!1;r<u;){if(l(),(e=s(r))===t){o=!0,r++;break}44===e?r++:((n=c())&&n.type!==Kt.COMPOUND||Jt("Expected comma",r),i.push(n))}return o||Jt("Expected "+String.fromCharCode(t),r),i},y=function(){var t,e;for(e=40===(t=s(r))?b():g(),l(),t=s(r);46===t||91===t||40===t;)r++,46===t?(l(),e={type:Kt.MEMBER_EXP,computed:!1,object:e,property:g()}):91===t?(e={type:Kt.MEMBER_EXP,computed:!0,object:e,property:c()},l(),93!==(t=s(r))&&Jt("Unclosed [",r),r++):40===t&&(e={type:Kt.CALL_EXP,arguments:v(41),callee:e}),l(),t=s(r);return e},b=function(){r++;var t=c();if(l(),41===s(r))return r++,t;Jt("Unclosed (",r)},x=function(){return r++,{type:Kt.ARRAY_EXP,elements:v(93)}},w=[];r<u;)59===(e=s(r))||44===e?r++:(n=c())?w.push(n):r<u&&Jt('Unexpected "'+a(r)+'"',r);return 1===w.length?w[0]:{type:Kt.COMPOUND,body:w}};le.addUnaryOp=function(t){return ee=Math.max(t.length,ee),Zt[t]=!0,this},le.addBinaryOp=function(t,e){return ne=Math.max(t.length,ne),Qt[t]=e,this},le.addLiteral=function(t,e){return re[t]=e,this},le.removeUnaryOp=function(t){return delete Zt[t],t.length===ee&&(ee=te(Zt)),this},le.removeBinaryOp=function(t){return delete Qt[t],t.length===ne&&(ne=te(Qt)),this},le.removeLiteral=function(t){return delete re[t],this};var ce={},de={};w.prototype={eval:function(t){return y(t,this.parsed)},safeEval:function(t){try{return y(t,this.parsed)}catch(t){Nt("Could not evaluate <<"+this.expr+">> expression: "+t)}},identifiers:function(){return b(this.parsed).values()}};var fe=function(t){return new w(t)},he=0,pe=function(t){var e="d3v"+ ++he;return arguments.length?(Object.defineProperty(t,"uid",{get:function(){return e}}),t):e},me=function(){var t=o.dispatch("change"),e=0;return{on:function(e,n){return arguments.length<2?t.on(e):(t.on(e,n),this)},trigger:Lt(function(){t.apply("change",this,arguments),e+=1}),triggered:function(){return e}}},ge=function(t){return t&&t.constructor===Object},ve=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.prototype.slice.call(t,e)};O.prototype=z.prototype={constructor:z,toString:function(){return"[object d3Model]"},$on:function(t,n){1===arguments.length&&e.isFunction(t)&&(n=t,t="");var r=t.split("."),i=r[0],o=M(this,i);return o?(this.$events.get(i)||r.push(this.uid),r[0]="change",o.on(r.join("."),n)):Nt('Cannot bind to "'+i+'" - no such reactive property')},$change:function(t){var e=arguments.length?t:"",n=this.$events.get(e),r=ve(arguments,1);return n?n.trigger.apply(this,r):this.isolated?Nt("attribute '"+e+"' is not a reactive property this model"):this.parent.$change(e),this},$update:function(t,e){if(t){e=2!==arguments.length||e;for(var n in t)(e||void 0===this[n])&&("$"===n.substring(0,1)?this.constructor.prototype[n]?Nt("Cannot set attribute method "+n+", it is protected"):this[n]=t[n]:this.$set(n,t[n]))}return this},$set:function(t,e){this.$events.get(t)?this[t]=e:_(this,t,e)},$new:function(t){return new z(t,this)},$off:function(t){if(void 0===t)this.$events.each(function(t){return A(t)});else{var e=t.split("."),n=e.splice(0,1)[0],r=this.$events.get(n);r&&A(r,e.join("."))}},$isReactive:function(t){return!!this.$events.has(t)||!(!this.parent||this.isolated)&&this.parent.$isReactive(t)},$owner:function(t){if(!this.$events.has(t)){if(!this.parent||this.isolated)return;return this.parent.$owner(t)}return this},$push:function(t,e){var n=this[t].slice();return n.push(e),this[t]=n,this},$splice:function(t,e,n){var r=this[t].slice();return 2==arguments.length?r.splice(e):3==arguments.length&&r.splice(e,n),this[t]=r,this}},Object.defineProperty(z.prototype,"root",{get:function(){return this.parent?this.parent.root:this}});var ye={create:function(t){return t},preMount:function(){},mount:function(t){return t},refresh:function(){},destroy:function(){},removeAttribute:function(){this.el.removeAttribute(this.name)},execute:function(t){this.active&&(this.removeAttribute(),this.identifiers=[],(t=this.mount(t))&&this.bindModel(t))},bindModel:function(t){var r=this,i=function(){var e=r.expression?r.expression.eval(t):void 0;r.refresh(t,e),r.passes++},o=void 0,a=void 0,s=void 0,u=void 0;if(this.expression){var l=n.map();this.expression.identifiers().forEach(function(n){for(o=n.split("."),a=t,s=null,u=0;u<o.length-1;++u)if(a=a[o[u]],!e.isObject(a)){s=o.slice(0,u+1).join("."),Nt("Property "+s+" is not an object. Directive "+r.name+" cannot bind to "+n);break}if(null===s){if(!(a instanceof O))return Nt(n+" is not a reactive model. Directive "+r.name+" cannot bind to it");S(l,a,o[o.length-1])}}),l.each(function(t){t.events.has("")?r.identifiers.push({model:t.model,attr:""}):t.events.each(function(e){r.identifiers.push({model:t.model,attr:e})})})}else r.identifiers.push({model:t,attr:""});this.identifiers.forEach(function(t){var e=t.attr+"."+r.uid;t.model.$on(e,i)}),this.bindDestroy(t),i()},bindDestroy:function(t){var e=this,n=this,r=this.destroy;n.destroy=function(){return r.call(n,t)},this.sel.on("remove."+n.uid,function(){e.identifiers.forEach(function(t){t.model.$off(t.attr+"."+n.uid)}),n.destroy()})}},be=function(t){function n(t,e,n){this.el=t,this.name=e.name,this.arg=n,this.passes=0;var r=Wt(pe(this)).create(e.value);r&&(this.expression=fe(r)),this.active||(this.active=!e.value||this.expression)}function r(t,e,r){return new n(t,e,r)}return n.prototype=e.assign({},Ut,ye,t),r.prototype=n.prototype,r},xe=function(t){if(e.isString(t))try{return JSON.parse(t)}catch(e){return t}return t},we=o.dispatch("message","component-created","component-mount","component-mounted"),ke={render:function(){},childrenMounted:function(){},mounted:function(){},destroy:function(){},mount:function(t,n,r){var i=this;if(!D(this)){we.call("component-mount",void 0,this,t,n);var o=this.select(t),a=o.directives(),s=a?a.attrs:function(t){for(var e={},n=void 0,r=0;r<t.attributes.length;++r)e[(n=t.attributes[r]).name]=n.value;return e}(t),u=this.parent.model,l=o.datum(),c=this.props,d=this.model,f=e.assign(function(t){var n=void 0;return Object.keys(t).reduce(function(r,i){return"data-"===i.substring(0,5)&&(r[n=i.split("-").splice(1).reduce(function(t,e,n){return t+=n?e.substring(0,1).toUpperCase()+e.substring(1):e},"")]=e.pop(t,i)),r},{})}(s),l,n),h=void 0,p=void 0;n=e.assign({},l,n);for(h in d)void 0!==(p=e.pop(f,h))&&(e.isString(p)?u.$isReactive(p)?p!==h?d[h]=function(t){return{reactOn:[t],get:function(){return this[t]}}}(p):delete d[h]:d[h]=xe(p):d[h]=p);this.model=d=u.$child(d),d.$$view=this,d.$$name=this.name,e.isArray(c)&&(c=c.reduce(function(t,e){return t[e]=void 0,t},{})),e.isObject(c)&&Object.keys(c).forEach(function(t){void 0!==(p=xe(void 0===f[t]?void 0===n[t]?s[t]:n[t]:f[t]))?(e.isString(p)&&d[p]&&(p=d[p]),n[t]=p):void 0!==c[t]&&(n[t]=c[t])});var m=this.render(n,s,t);return m.then||(m=Promise.resolve(m)),m.then(function(e){return function(t,e,n,r){return n?(1!==(n=Vt(n)).size()&&Nt("render function must return a single HTML node"),n=n.node(),e.parentNode.insertBefore(n,e),t.select(e).remove(),j(t,n,r)):Nt("render function must return a single HTML node. It returned nothing!")}(i,t,e,r)})}Nt("already mounted")}},Ee=["name","class","disabled","readonly","required","href"],_e=function(t,e){var n=i.select(t),r=n.directives();if(r)return r;if(r=new N,!e)return r;for(var o=0;o<t.attributes.length;++o){var a=t.attributes[o],s=a.name.split("-"),u="d3"===s[0]?s[1]:null,l=void 0;if(u){!(l=s.slice(2).join("-"))&&Ee.indexOf(u)>-1&&(l=u,u="attr");var c=e.get(u);c?r.add(c(t,a,l)):Nt(t.tagName+' cannot find directive "'+u+'". Did you forget to register it?')}r.attrs[a.name]=a.value}return r.size()&&n.directives(r),r};N.prototype={size:function(){return this.all.length},pop:function(t){var e=this.all.indexOf(t);return e>-1&&(t.removeAttribute(),this.all.splice(e,1)),t},add:function(t){this.all.push(t)},forEach:function(t){this.all.forEach(t)},preMount:function(){for(var t=void 0,e=0;e<this.all.length;++e)if((t=this.all[e]).preMount())return this.pop(t)},execute:function(t){if(this.size())return Promise.all(this.all.map(function(e){return e.execute(t)}))}},i.selection.prototype.mount=function(t,e){var n=[];return this.each(function(){var r=i.select(this).view();r?n.push(q(this,r,t,e)):Nt("Cannot mount, no view object available to mount to")}),Promise.all(n)},i.selection.prototype.view=function(t){if(arguments.length)return this.property("__d3_view__",t);for(var e=this.node(),n=e?e.__d3_view__:null,r=e?e.parentNode:null;r&&!n;)n=r.__d3_view__,r=r.parentNode;return n},i.selection.prototype.model=function(){var t=this.view();return t?t.model:null},i.selection.prototype.directives=function(t){return arguments.length?this.property("__d3_directives__",t):this.node().__d3_directives__};var Me={use:function(t){return e.isObject(t)?t.install(this):t(this),this},addComponent:function(t,e){var n=P(t,e);return this.components.set(t,n),n},addDirective:function(t,e){var n=be(e);return this.directives.set(t,n),n},mount:function(t,n){if(D(this))Nt("already mounted");else if(we.call("component-mount",void 0,this,t),t=function(t){if(!t)return Nt("element not defined, pass an identifier or an HTMLElement object");var n=(e.isFunction(t.node)?t:i.select(t)).node();if(n)return n;Nt("could not find "+t+" element")}(t))return this.model=this.parent?this.parent.model.$child(this.model):O(this.model),j(this,t,n)}},Ae={attr:Rt,html:Ft,value:Bt,on:{mount:function(t){var e=this.arg||"click",n=this.expression;this.on(this.sel,e+"."+this.uid,function(e){var r=t.$child();r.$event=e,n.eval(r)}),this.bindDestroy(t)},destroy:function(){var t=this.arg||"click";this.on(this.sel,t+"."+this.uid,null)}},for:{create:function(t){var e=[];return t.trim().split(" ").forEach(function(t){t&&e.push(t)}),3!==e.length||"in"!=e[1]?Nt('d3-for directive requires "item in expression" template, got "'+t+'"'):(this.itemName=e[0],this.itemClass="for"+this.uid,e[2])},preMount:function(){return!0},mount:function(t){if(this.creator=this.el,this.el=this.creator.parentNode,i.select(this.creator).remove(),this.el)return t},refresh:function(t,n){if(e.isArray(n)){var r=void 0,i=this.creator,o=i.tagName+"."+this.itemClass,a=this.itemName,s=this.sel,u=s.selectAll(o),l=u.filter(function(){return r=this.__d3_view__.model[a],n.indexOf(r)>-1}).data(n),c=u.filter(function(){return r=this.__d3_view__.model[a],-1===n.indexOf(r)}),d=P("forView",Me),f=s.view(),h=void 0,p=void 0,m=void 0,g=void 0;(this.transition(c)||c).style("opacity",0).remove(),l.enter().append(function(){return p=i.cloneNode(!0),m=f.select(p),f.transitionDuration(m)>0&&m.style("opacity",0),p}).classed(this.itemClass,!0).each(function(t,e){(h={index:e})[a]=t,d({model:h,parent:f}).mount(this,function(t){n[e]=t.model[a],(g=t.transition())&&g.style("opacity",1)})}).merge(l).each(function(t){this.__d3_view__.model[a]=t})}}},if:{mount:function(t){var e=this.sel;return this.display=e.style("display"),this.display&&"none"!==this.display||(this.display="block"),t},refresh:function(t,e){var n=this.sel,r=this.passes?this.transition(n):null;e?n.style("display",this.display):r||n.style("display","none"),r&&(e?r.style("opacity",1):r.style("opacity",0).on("end",function(){return n.style("display","none")}))}}};if(e.inBrowser){new MutationObserver(function(t){t.forEach(function(t){var e=t.removedNodes,n=void 0;if(e&&e.length)for(var r=0;r<e.length;++r)(n=i.select(e[r])).view()&&(n.selectAll("*").each(R),R.call(e[r]))})}).observe(document.documentElement,{childList:!0,subtree:!0})}var ze=T(n.map(),Ae),Oe=function(t){return P("view",Me,ze)(t)},Se=function(t){Dt.readyCallbacks.push(t),"complete"!==document.readyState?(document.addEventListener("DOMContentLoaded",F),window.addEventListener("load",F)):L()},$e={logger:e.logger},Pe=function(t){$e.logger.warn("[d3-form] "+t)},Ce=n.map({disabled:"disabled",readonly:"readOnly",required:"required"}),Te={inputData:function(t,n){var r=this.model;return n||(n={}),n.id=n.id||r.uid,r.data=n,t.attr("id",n.id),n.classes&&t.classed(n.classes,!0),function(t,n,r){var i,o,a;if(e.isObject(r))for(o in r)i=r[o],e.isObject(i)&&("d3-"===o.substring(0,3)?(a=o.replace("-","_"),n.$set(a,i),i=a):i=JSON.stringify(i)),t.attr(o,i||"")}(t,r,n.attributes),Ce.each(function(r,i){var o=n[i];o&&(e.isString(o)?t.attr("d3-attr-"+i,o):t.property(r,!0))}),n},wrap:function(t){var e=this,n=t;return e.model.$formExtensions.forEach(function(r){n=r(e,n,t)||n}),n},wrapTemplate:function(t,e){var n=document.createElement("div"),r=i.select(n).html(e).select("slot");if(!r.size())return Pe("template does not provide a slot element"),t;var o=i.select(r.node().parentNode);return t.nodes().forEach(function(t){o.insert(function(){return t},"slot")}),r.remove(),i.selectAll(n.children)}},je=e.assign({},Te,{model:{value:null,error:"",isDirty:null,changed:!1,srOnly:!1,placeholder:"",showError:{reactOn:["error","isDirty"],get:function(){return!!this.error&&this.isDirty}},$validate:function(){}},inputData:function(t,e){if(!(e=Te.inputData.call(this,t,e)).name)return Pe("Input field without a name");t.attr("name",e.name),e.placeholder=e.placeholder||e.label||e.name;var n=this.model;return n.form.inputs[e.name]=n,n.name=e.name,n.$on("value",function(){null===n.isDirty?n.isDirty=!1:(n.isDirty=!0,n.changed=!0),n.form.$change()}),e}}),De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ne={text:"input",email:"input",password:"input",checkbox:"input",number:"input",date:"input",url:"input","datetime-local":"input"},qe=e.assign({},Te,{render:function(t){var e=t?t.tag||"fieldset":"fieldset",n=this.createElement(e);return t=this.inputData(n,t),W.call(this,n)}}),Re={get:function(t){var n=this.all.slice(0);if(e.isObject(t))for(var r in t)n.push(function(t,e){return{set:function(e,n){n[t]},validate:function(t,n){return e(t,n)}}}(r,t[r]));return n},set:function(t,e){var n=t.model;n._view=t,n.validators.forEach(function(t){return t.set(e,n.data)}),n.$on("value.validate",this.validate),n.$validate=this.validate},validate:function(){for(var t,e,n=this._view,r=this.validators,i=this.value,o=n.sel.attr("id")===this.data.id?n.sel:n.sel.select("#"+this.data.id),a=0;a<r.length;++a)if(t=r[a],e=t.validate(o,i)){!0===e&&(e="");break}this.error=e||""},all:[{set:function(t,n){var r=n.required;e.isString(r)?t.attr("d3-required",r):t.property("required",r||!1)},validate:function(t,e){if(t.property("required")){if(!e)return"required";if(""===e)return!0}}},{set:function(t,n){var r=n.minLength;e.isString(r)?t.attr("d3-attr-minlength",r):void 0!==r&&t.attr("minlength",r)},validate:function(t,e){var n=+t.attr("minlength");if(n==n&&n>0&&e.length<n)return"too short - "+n+" characters or more expected"}},{set:function(t,n){var r=n.maxLength;e.isString(r)?t.attr("d3-attr-maxlength",r):void 0!==r&&t.attr("maxlength",r)},validate:function(t,e){var n=+t.attr("maxlength");if(n==n&&n>0&&e&&e.length>n)return"too long - "+n+" characters or less expected"}},{set:function(t,n){var r=n.minimum;e.isString(r)?t.attr("d3-attr-min",r):void 0!==r&&t.attr("min",r)},validate:function(t,e){var n=Y(t);if(n&&+e<n[0])return"must be greater or equal "+n[0]}},{set:function(t,n){var r=n.maximum;e.isString(r)?t.attr("d3-attr-max",r):void 0!==r&&t.attr("max",r)},validate:function(t,e){var n=Y(t);if(n&&+e>n[1])return"must be less or equal "+n[1]}}]},Fe=["checkbox","radio"],Le=e.assign({},je,{render:function(t){var e=this.createElement("input");return t=this.inputData(e,t),e.attr("type",t.type||"text").attr("d3-value","value"),-1===Fe.indexOf(e.attr("type"))&&e.attr("placeholder",t.placeholder),Re.set(this,e),this.wrap(e)}}),We=e.assign({},je,{render:function(t){var e=this.createElement("textarea");return t=this.inputData(e,t),e.attr("placeholder",t.placeholder).attr("d3-value","value"),Re.set(this,e),this.wrap(e)}}),Xe=e.assign({},je,{model:e.assign({options:[],$optionLabel:function(){return e.isArray(this.option)?this.option[1]||this.option[0]:this.option},$optionValue:function(){return e.isArray(this.option)?this.option[0]:this.option}},je.model),render:function(t){var e=this.createElement("select");return t=this.inputData(e,t),e.attr("d3-value","value").attr("placeholder",t.placeholder).append("option").attr("d3-for","option in options").attr("d3-html","$optionLabel()").attr("d3-attr-value","$optionValue()"),Re.set(this,e),this.wrap(e)}}),Ye=e.assign({},Te,{render:function(t){var e=t?t.tag||"button":"button",n=this.createElement(e);t=this.inputData(n,t);var r=this.model;return r.type=t.type||"submit",t.endpoint&&(r.endpoint=t.endpoint),r.$submit=function(){r.actions.submit.call(r,i.event)},t.submit||(t.submit="$submit()"),n.attr("type",r.type).attr("name",r.name).attr("d3-on-click",t.submit).html(t.label||"submit"),this.wrap(n)}}),He={default:function(t){this.message(t)},redirect:function(t){window.location.href=t.redirectTo||"/"}},Ie={submit:function(t){var n=this.form,r=e.assign({},Be,this.endpoint);t&&(t.preventDefault(),t.stopPropagation());var i=$e.fetch,o=n.$inputData(),a={};if(i)if(r.url){if("application/json"===r.contentType)a.headers={"Content-Type":r.contentType},a.body=JSON.stringify(o);else{a.body=new FormData;for(var s in o)a.body.set(s,o[s])}n.$setSubmit()?(a.method=r.method,i(r.url,a).then(function(t){n.$setSubmitDone();var e=(t.headers.get("content-type")||"").split(";")[0];"application/json"===e?t.json().then(function(e){n.$response(e,t.status,t.headers)}):Pe("Cannot load content type '"+e+"'")},function(){n.$setSubmitDone()})):n.$setSubmitDone()}else Pe("No url, cannot submit");else Pe("fetch provider not available, cannot submit")}},Be={contentType:"application/json",method:"post"},Ve={props:["schema","values"],components:{"d3-form-fieldset":qe,"d3-form-input":Le,"d3-form-textarea":We,"d3-form-select":Xe,"d3-form-submit":Ye},model:{formSubmitted:!1,formPending:!1,$isValid:function(t){var e=void 0,n=!0;for(var r in this.inputs)e=this.inputs[r],t&&(e.isDirty=!0),e.$validate(),e.error&&(n=!1);return n},$setSubmit:function(){return this.formSubmitted=!0,this.formPending=!0,this.$isValid(!0)},$setSubmitDone:function(){this.formPending=!1},$inputData:function(){var t,e=this.inputs,n={};for(var r in e)((t=e[r].value)||Le.changed)&&(n[r]=t);return n},$response:function(t,e,n){if(e<300)if(this.data.resultHandler){var r=He[this.data.resultHandler];r?r.call(this,t,e,n):Pe("Could not find "+this.data.resultHandler+" result handler")}else He.default.call(this,t,e,n);else this.$responseError(t,e,n)},$responseError:function(t){t.level="error",this.$message(t)}},render:function(t){function n(t){t=Te.inputData.call(o,i,t),r.validators=Re.get(t.validators);for(var n in Ie){var a=t[n];e.isString(a)&&(a=o.model.$get(a)),r.actions[n]=a||Ie[n]}return W.call(o,i),i}var r=this.model,i=this.createElement("form").attr("novalidate",""),o=this;r.$formExtensions=this.root.$formExtensions||[],r.inputs={},r.actions={},r.form=r;var a=t.schema;if(t.values&&(a.values=t.values),e.isString(a)){return(0,$e.fetch)(a,{method:"GET"}).then(function(t){if(200===t.status)return t.json().then(n);Pe("Could not load form from "+a+": status "+t.status)})}return n(a)},childrenMounted:function(){var t=this.model,e=t.data.values;e&&Object.keys(e).forEach(function(n){var r=t.inputs[n];r&&(r.value=e[n])})}},Ge={install:function(t){t.addComponent("d3form",Ve),t.$formExtensions=[];for(var e in t.providers)$e[e]=t.providers[e]},actions:Ie,responses:He},Ue={input:["inputGroup","label","formGroup"],checkbox:["formCheck"],textarea:["label","formGroup"],select:["label","formGroup"],submit:["submit"],wrappers:{label:function(t,e){var n=t.model.data;return t.wrapTemplate(e,function(t){var e=t.label||t.name;return"<label for="+t.id+' class="control-label" d3-class="[srOnly ? \'sr-only\' : null]">'+e+"</label>\n<slot></slot>"}(n))},formGroup:function(t,e,n){var r=t.model.data,i=void 0!==r.size?r.size:t.model.form.data.size,o=i?"form-control form-control-"+i:"form-control";return n.classed(o,!0).attr("d3-class","["+(r.required||!1)+' ? "form-control-required" : null, showError ? "form-control-danger" : null]'),t.wrapTemplate(e,'<div class="form-group" d3-class=\'showError ? "has-danger" : null\'>\n<slot></slot>\n<p d3-if="showError" class="text-danger error-block" d3-html="error"></p>\n</div>')},inputGroup:function(t,e,n){var r=t.model.data.group;if(!r)return e;var i="g"+n.attr("id");return n.attr("aria-describedby",i),t.wrapTemplate(e,function(t,e){return'<div class="input-group" :class="bootstrapStatus()">\n<span class="input-group-addon" id="'+t+'">'+r+"</span>\n<slot></slot>\n</div>"}(i))},formCheck:function(t,e,n){var r=t.model.data;return n.classed("form-check-input",!0),t.wrapTemplate(e,'<div class="form-check">\n<label class="form-check-label">\n<slot></slot>\n'+r.label+"\n</label>\n</div>")},submit:function(t,e,n){var r=t.model.data.theme||"primary";return n.classed("btn",!0).classed("btn-"+r,!0),t.wrapTemplate(e,'<div class="form-group">\n<slot></slot>\n</div>')}}},Ke={install:function(t){if(!t.$formExtensions)return Pe("form bootstrap requires the form plugin installed first!");t.$formExtensions.push(H)}},Je="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ze=function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t,e){!function(t){function e(t){return t}function n(t,e){for(var n=0,r=e.length,i=new Array(r);n<r;++n)i[n]=t[e[n]];return i}function r(t){function e(e,n,r,i){for(;r<i;){var o=r+i>>>1;n<t(e[o])?i=o:r=o+1}return r}return e.right=e,e.left=function(e,n,r,i){for(;r<i;){var o=r+i>>>1;t(e[o])<n?r=o+1:i=o}return r},e}function i(t){function e(t,e,r){for(var i=r-e,o=1+(i>>>1);--o>0;)n(t,o,i,e);return t}function n(e,n,r,i){for(var o,a=e[--i+n],s=t(a);(o=n<<1)<=r&&(o<r&&t(e[i+o])>t(e[i+o+1])&&o++,!(s<=t(e[i+o])));)e[i+n]=e[i+o],n=o;e[i+n]=a}return e.sort=function(t,e,r){for(var i,o=r-e;--o>0;)i=t[e],t[e]=t[e+o],t[e+o]=i,n(t,1,o,e);return t},e}function o(t){var e=i(t);return function(n,r,i,o){var a,s,u,l=new Array(o=Math.min(i-r,o));for(s=0;s<o;++s)l[s]=n[r++];if(e(l,0,o),r<i){a=t(l[0]);do{t(u=n[r])>a&&(l[0]=u,a=t(e(l,0,o)[0]))}while(++r<i)}return l}}function a(t){return function(e,n,r){for(var i=n+1;i<r;++i){for(var o=i,a=e[i],s=t(a);o>n&&t(e[o-1])>s;--o)e[o]=e[o-1];e[o]=a}return e}}function s(t){function e(r,i,o){return(o-i<x?n:function(n,r,i){var o,a=(i-r)/6|0,s=r+a,u=i-1-a,l=r+i-1>>1,c=l-a,d=l+a,f=n[s],h=t(f),p=n[c],m=t(p),g=n[l],v=t(g),y=n[d],b=t(y),x=n[u],w=t(x);h>m&&(o=f,f=p,p=o,o=h,h=m,m=o);b>w&&(o=y,y=x,x=o,o=b,b=w,w=o);h>v&&(o=f,f=g,g=o,o=h,h=v,v=o);m>v&&(o=p,p=g,g=o,o=m,m=v,v=o);h>b&&(o=f,f=y,y=o,o=h,h=b,b=o);v>b&&(o=g,g=y,y=o,o=v,v=b,b=o);m>w&&(o=p,p=x,x=o,o=m,m=w,w=o);m>v&&(o=p,p=g,g=o,o=m,m=v,v=o);b>w&&(o=y,y=x,x=o,o=b,b=w,w=o);var k=p,E=m,_=y,M=b;n[s]=f,n[c]=n[r],n[l]=g,n[d]=n[i-1],n[u]=x;var A=r+1,z=i-2,O=E<=M&&E>=M;if(O)for($=A;$<=z;++$){P=n[$];if((C=t(P))<E)$!==A&&(n[$]=n[A],n[A]=P),++A;else if(C>E)for(;;){if(!((T=t(n[z]))>E)){if(T<E){n[$]=n[A],n[A++]=n[z],n[z--]=P;break}n[$]=n[z],n[z--]=P;break}z--}}else for($=A;$<=z;$++){P=n[$];if((C=t(P))<E)$!==A&&(n[$]=n[A],n[A]=P),++A;else if(C>M)for(;;){if(!((T=t(n[z]))>M)){T<E?(n[$]=n[A],n[A++]=n[z],n[z--]=P):(n[$]=n[z],n[z--]=P);break}if(--z<$)break}}if(n[r]=n[A-1],n[A-1]=k,n[i-1]=n[z+1],n[z+1]=_,e(n,r,A-1),e(n,z+2,i),O)return n;if(A<s&&z>u){for(var S;(S=t(n[A]))<=E&&S>=E;)++A;for(;(T=t(n[z]))<=M&&T>=M;)--z;for(var $=A;$<=z;$++){var P=n[$],C=t(P);if(C<=E&&C>=E)$!==A&&(n[$]=n[A],n[A]=P),A++;else if(C<=M&&C>=M)for(;;){var T;if(!((T=t(n[z]))<=M&&T>=M)){T<E?(n[$]=n[A],n[A++]=n[z],n[z--]=P):(n[$]=n[z],n[z--]=P);break}if(--z<$)break}}}return e(n,A,z+1)})(r,i,o)}var n=a(t);return e}function u(t){for(var e=new Array(t),n=-1;++n<t;)e[n]=0;return e}function l(t){return[0,t.length]}function c(){return null}function d(){return 0}function f(t){return t+1}function h(t){return t-1}function p(t){return function(e,n){return e+ +t(n)}}function m(t){return function(e,n){return e-t(n)}}function g(){function t(t){var e=u,n=t.length;return n&&(a=a.concat(t),k=_(k,u+=n),A.forEach(function(r){r(t,e,n)})),r}var r={add:t,remove:function(){for(var t=v(u,u),e=[],n=0,r=0;n<u;++n)k[n]?t[n]=r++:e.push(n);E.forEach(function(t){t(0,[],e)}),z.forEach(function(e){e(t)});for(var i,n=0,r=0;n<u;++n)(i=k[n])&&(n!==r&&(k[r]=i,a[r]=a[n]),++r);for(a.length=r;u>r;)k[--u]=0},dimension:function(t){function r(e,r,i){F=e.map(t),L=I(function(t){for(var e=v(t,t),n=-1;++n<t;)e[n]=n;return e}(i),0,i),F=n(F,L);var o,a=B(F),s=a[0],l=a[1];if(W)for(o=0;o<i;++o)W(F[o],o)||(k[L[o]+r]|=Y);else{for(o=0;o<s;++o)k[L[o]+r]|=Y;for(o=l;o<i;++o)k[L[o]+r]|=Y}if(!r)return q=F,R=L,U=s,void(K=l);var c=q,d=R,f=0,h=0;for(q=new Array(u),R=v(u,u),o=0;f<r&&h<i;++o)c[f]<F[h]?(q[o]=c[f],R[o]=d[f++]):(q[o]=F[h],R[o]=L[h++]+r);for(;f<r;++f,++o)q[o]=c[f],R[o]=d[f];for(;h<i;++h,++o)q[o]=F[h],R[o]=L[h]+r;a=B(q),U=a[0],K=a[1]}function w(t,e,n){V.forEach(function(t){t(F,L,e,n)}),F=L=null}function O(t){for(var e,n=0,r=0;n<u;++n)k[e=R[n]]&&(n!==r&&(q[r]=q[n]),R[r]=t[e],++r);for(q.length=r;r<u;)R[r++]=0;var i=B(q);U=i[0],K=i[1]}function S(t){var e=t[0],n=t[1];if(W)return W=null,j(function(t,r){return e<=r&&r<n}),U=e,K=n,X;var r,i,o,a=[],s=[];if(e<U)for(r=e,i=Math.min(U,n);r<i;++r)k[o=R[r]]^=Y,a.push(o);else if(e>U)for(r=U,i=Math.min(e,K);r<i;++r)k[o=R[r]]^=Y,s.push(o);if(n>K)for(r=Math.max(e,K),i=n;r<i;++r)k[o=R[r]]^=Y,a.push(o);else if(n<K)for(r=Math.max(U,n),i=K;r<i;++r)k[o=R[r]]^=Y,s.push(o);return U=e,K=n,E.forEach(function(t){t(Y,a,s)}),X}function $(t){return S((B=function(t,e){return function(n){var r=n.length;return[t.left(n,e,0,r),t.right(n,e,0,r)]}}(b,t))(q))}function P(t){return S((B=function(t,e){var n=e[0],r=e[1];return function(e){var i=e.length;return[t.left(e,n,0,i),t.left(e,r,0,i)]}}(b,t))(q))}function C(){return S((B=l)(q))}function T(t){return B=l,j(W=t),U=0,K=u,X}function j(t){var e,n,r,i=[],o=[];for(e=0;e<u;++e)!(k[n=R[e]]&Y)^!!(r=t(q[e],e))&&(r?(k[n]&=H,i.push(n)):(k[n]|=Y,o.push(n)));E.forEach(function(t){t(Y,i,o)})}function D(t){function n(e,n,r,i){function o(){++X===W&&(A=M(A,L<<=1),C=M(C,L),W=y(L))}var d,f,h,p,m,x,w=P,A=v(X,W),z=D,O=F,S=X,$=0,T=0;for(U&&(z=O=c),P=new Array(X),X=0,C=S>1?_(C,u):v(u,W),S&&(h=(f=w[0]).key);T<i&&!((p=t(e[T]))>=p);)++T;for(;T<i;){for(f&&h<=p?(m=f,x=h,A[$]=X,(f=w[++$])&&(h=f.key)):(m={key:p,value:O()},x=p),P[X]=m;!(p>x||(C[d=n[T]+r]=X,k[d]&H||(m.value=z(m.value,a[d])),++T>=i));)p=t(e[T]);o()}for(;$<S;)P[A[$]=X]=w[$++],o();if(X>$)for($=0;$<r;++$)C[$]=A[C[$]];d=E.indexOf(I),X>1?(I=s,B=g):(!X&&K&&(X=1,P=[{key:null,value:O()}]),1===X?(I=l,B=b):(I=c,B=c),C=null),E[d]=I}function r(){if(X>1){for(var t=X,e=P,n=v(t,t),r=0,i=0;r<u;++r)k[r]&&(n[C[i]=C[r]]=1,++i);for(P=[],X=0,r=0;r<t;++r)n[r]&&(n[r]=X++,P.push(e[r]));if(X>1)for(r=0;r<i;++r)C[r]=n[C[r]];else C=null;E[E.indexOf(I)]=X>1?(B=g,I=s):1===X?(B=b,I=l):B=I=c}else if(1===X){if(K)return;for(r=0;r<u;++r)if(k[r])return;P=[],X=0,E[E.indexOf(I)]=I=B=c}}function s(t,e,n){if(t!==Y&&!U){var r,i,o,s;for(r=0,o=e.length;r<o;++r)k[i=e[r]]&H||((s=P[C[i]]).value=D(s.value,a[i]));for(r=0,o=n.length;r<o;++r)(k[i=n[r]]&H)===t&&((s=P[C[i]]).value=N(s.value,a[i]))}}function l(t,e,n){if(t!==Y&&!U){var r,i,o,s=P[0];for(r=0,o=e.length;r<o;++r)k[i=e[r]]&H||(s.value=D(s.value,a[i]));for(r=0,o=n.length;r<o;++r)(k[i=n[r]]&H)===t&&(s.value=N(s.value,a[i]))}}function g(){var t,e;for(t=0;t<X;++t)P[t].value=F();for(t=0;t<u;++t)k[t]&H||((e=P[C[t]]).value=D(e.value,a[t]))}function b(){var t,e=P[0];for(e.value=F(),t=0;t<u;++t)k[t]&H||(e.value=D(e.value,a[t]))}function x(){return U&&(B(),U=!1),P}function w(t,e,n){return D=t,N=e,F=n,U=!0,$}function A(){return w(f,h,d)}function O(t){function e(e){return t(e.value)}return T=o(e),j=i(e),$}function S(){var t=E.indexOf(I);return t>=0&&E.splice(t,1),(t=V.indexOf(n))>=0&&V.splice(t,1),(t=z.indexOf(r))>=0&&z.splice(t,1),$}var $={top:function(t){var e=T(x(),0,P.length,t);return j.sort(e,0,e.length)},all:x,reduce:w,reduceCount:A,reduceSum:function(t){return w(p(t),m(t),d)},order:O,orderNatural:function(){return O(e)},size:function(){return X},dispose:S,remove:S};G.push($);var P,C,T,j,D,N,F,L=8,W=y(L),X=0,I=c,B=c,U=!0,K=t===c;return arguments.length<1&&(t=e),E.push(I),V.push(n),z.push(r),n(q,R,0,u),A().orderNatural()}function N(){G.forEach(function(t){t.dispose()});var t=A.indexOf(r);return t>=0&&A.splice(t,1),(t=A.indexOf(w))>=0&&A.splice(t,1),(t=z.indexOf(O))>=0&&z.splice(t,1),g&=H,C()}var q,R,F,L,W,X={filter:function(t){return null==t?C():Array.isArray(t)?P(t):"function"==typeof t?T(t):$(t)},filterExact:$,filterRange:P,filterFunction:T,filterAll:C,top:function(t){for(var e,n=[],r=K;--r>=U&&t>0;)k[e=R[r]]||(n.push(a[e]),--t);return n},bottom:function(t){for(var e,n=[],r=U;r<K&&t>0;)k[e=R[r]]||(n.push(a[e]),--t),r++;return n},group:D,groupAll:function(){var t=D(c),e=t.all;return delete t.all,delete t.top,delete t.order,delete t.orderNatural,delete t.size,t.value=function(){return e()[0].value},t},dispose:N,remove:N},Y=~g&-~g,H=~Y,I=s(function(t){return F[t]}),B=l,V=[],G=[],U=0,K=0;return A.unshift(r),A.push(w),z.push(O),g|=Y,(x>=32?!Y:g&-(1<<x))&&(k=M(k,x<<=1)),r(a,0,u),w(0,0,u),X},groupAll:function(){function t(t,e){var n;if(!v)for(n=e;n<u;++n)k[n]||(o=s(o,a[n]))}function e(t,e,n){var r,i,u;if(!v){for(r=0,u=e.length;r<u;++r)k[i=e[r]]||(o=s(o,a[i]));for(r=0,u=n.length;r<u;++r)k[i=n[r]]===t&&(o=l(o,a[i]))}}function n(t,e,n){return s=t,l=e,c=n,v=!0,g}function r(){return n(f,h,d)}function i(){var n=E.indexOf(e);return n>=0&&E.splice(n),(n=A.indexOf(t))>=0&&A.splice(n),g}var o,s,l,c,g={reduce:n,reduceCount:r,reduceSum:function(t){return n(p(t),m(t),d)},value:function(){return v&&(function(){var t;for(o=c(),t=0;t<u;++t)k[t]||(o=s(o,a[t]))}(),v=!1),o},dispose:i,remove:i},v=!0;return E.push(e),A.push(t),t(0,0),r()},size:function(){return u}},a=[],u=0,g=0,x=8,k=w(0),E=[],A=[],z=[];return arguments.length?t(arguments[0]):r}function v(t,e){return(e<257?w:e<65537?k:E)(t)}function y(t){return 8===t?256:16===t?65536:4294967296}g.version="1.3.12",g.permute=n;var b=g.bisect=r(e);b.by=r;(g.heap=i(e)).by=i;(g.heapselect=o(e)).by=o;(g.insertionsort=a(e)).by=a;(g.quicksort=s(e)).by=s;var x=32,w=u,k=u,E=u,_=function(t,e){for(var n=t.length;n<e;)t[n++]=0;return t},M=function(t,e){if(e>32)throw new Error("invalid array width!");return t};"undefined"!=typeof Uint8Array&&(w=function(t){return new Uint8Array(t)},k=function(t){return new Uint16Array(t)},E=function(t){return new Uint32Array(t)},_=function(t,e){if(t.length>=e)return t;var n=new t.constructor(e);return n.set(t),n},M=function(t,e){var n;switch(e){case 16:n=k(t.length);break;case 32:n=E(t.length);break;default:throw new Error("invalid array width!")}return n.set(t),n}),t.crossfilter=g}(e||Je)}).crossfilter,Qe=function(t){return function(e){return e[t]}};I.prototype={constructor:I,dataFrame:function(){return this},size:function(){return this.data.length},new:function(t){return e.isArray(t)?new I(t,null,this.store):new I(this._inner,t)},cf:function(){return this._inner.cf||(this._inner.cf=Ze(this.data)),this._inner.cf},dimension:function(t,e,n){1===arguments.length&&(n=!0);var r=this.dimensions[t];if(r){if(n)return r;r.dispose()}return e||(e=Qe(t)),this.dimensions[t]=this.cf().dimension(e),this.dimensions[t]},sortby:function(t,e){return this.new(this.dimension(t).top(e||1/0))},pivot:function(t,e,n,r){function i(i){var o=void 0,a=void 0;return function(s,u){return o=""+u[e],a=i*u[n],s[t]=u[t],o in s?s[o]+=a:s[o]=a,r in s?s[r]+=a:s[r]=a,s}}var o=this.dimension(t).group();return r||(r="total"),this.new(o.reduce(i(1),i(-1),Object).all().map(function(t){return t.value}))},add:function(){},map:function(t){return this.new(this.data.map(t))}};var tn={schema:{type:"object",description:"array of data",properties:{data:{type:"array",description:"array of data"}}},initialise:function(t){this._data=t.data},getConfig:function(t){return e.isArray(t)?{data:t}:e.isObject(t)&&e.isArray(t.data)?t:void 0},getData:function(){return this.asFrame(this._data)}},en=function(t){Dt.logger.warn("[d3-data-source] "+t)},nn=["http","https","ws","wss"],rn=n.set(["text/plain","text/csv","application/vnd.ms-excel"]),on={schema:{type:"object",description:"Remote data resource",properties:{url:{type:"string",description:"url for fetching data"}}},getConfig:function(t){return function(t){return e.isString(t)&&nn.indexOf(t.split("://")[0])>-1}(t)?{url:t}:e.isObject(t)&&t.url?t:void 0},initialise:function(t){this.url=t.url},getData:function(){var t=Dt.fetch,e=this;return t?t(this.url).then(B).then(function(t){return e.asFrame(t)}):(en("fetch provider not available, cannot submit"),[])}},an={schema:{type:"object",description:"Composite data source for combining data together",properties:{source:{type:"array",description:"Array of data sources keys",item:{type:"string"}},expression:{type:"string",description:"expression to evaluate, must return a data frame or a Promise"}}},initialise:function(t){this.source=t.source,this.expression=t.expression?fe(t.expression):null},getConfig:function(t){if(e.isObject(t)&&t.source)return e.isArray(t.source)||(t.source=[t.source]),t},getData:function(t){var n=this.store,r=this.source,i=this.expression,o=this;return Promise.all(r.map(function(e){return n.getData(e,t)})).then(function(a){var s=void 0;if(1===a.length?s=a[0]:o.config.merge?s=o.mergeFrames(a):(s=new V(n),a.forEach(function(t,e){s.frames.set(r[e],t)})),i){var u=n.model.$child(e.assign({},t,{frame:s}));s=i.eval(u)}return e.isPromise(s)?s.then(function(t){return o.asFrame(t)}):o.asFrame(s)})},mergeFrames:function(t){return t[0]}};V.prototype={new:function(t){return new I(t,this.store)},dataFrame:function(){for(var t=this.frames.values(),e=0;e<t.length;++e)if("dataframe"===t[e].type)return t[e]}};var sn={schema:{type:"object",description:"Expression to evaluate by the data store",properties:{expression:{type:"string",description:"expression to evaluate, must return a data frame or a Promise"}}},initialise:function(t){this.expression=fe(t.expression)},getConfig:function(t){if(e.isObject(t)&&t.expression)return t},getData:function(t){var n=this,r=this.store.model.$child(t),i=this.expression.eval(r);return e.isPromise(i)?i.then(function(t){return n.asFrame(t)}):n.asFrame(i)}},un=function(t){function e(t){return i.validate(t)?function(e){return n(e,t)}:i.logError()}var n=t.transform,r=t.schema||{},i=Dt.jsonValidator?Dt.jsonValidator(t.schema):ln;return r.type||(r.type="object"),e.schema=r,e},ln={validate:function(){return!0}},cn=un({schema:{description:"The filter transform removes objects from a data frame based on a provided filter expression",properties:{expr:{type:"string"}},required:["expr"]},transform:function(t,e){var n=fe(e.expr);return t.data.reduce(function(e,r,i){return n.safeEval({d:r,index:i,frame:t})&&e.push(r),e},[])}}),dn=function(t,e){Dt.logger.warn("[d3-visualize] "+t),e&&Dt.logger.error(e.stack)},fn=n.map({count:G,max:s.max,min:s.min,sum:s.sum,mean:s.mean,median:s.median,variance:s.variance,deviation:s.deviation}),hn=n.map({count:function(t){return t+1},sum:function(t,e){return t+e},max:Math.max,min:Math.min}),pn={dataSource:null,size:{width:null,height:"70%"}};pn.dateFormat="%d-%b-%y";var mn={date:function(t){return u.utcParse(t.dateFormat||pn.dateFormat)},number:function(){return parseFloat}},gn=un({shema:{description:"map a field values into another type",properties:{fields:{type:"object"},dateFormat:{type:"string"}},required:["fields"]},transform:function(t,r){var i=[],o=void 0,a=void 0;return n.map(r.fields).each(function(t,n){e.isString(t)&&(t={type:t}),(a=mn[t.type])?i.push([n,a(t)]):dn("Cannot convert field "+n+" to type "+t.type)}),i.length&&(t=t.map(function(t){for(o=0;o<i.length;++o)t[i[o][0]]=i[o][1](t[i[o][0]]);return t})),t}}),vn=function(t,e,n){return void 0!==n&&(t=Math.min(t,n)),void 0===e?t:Math.max(t,e)},yn=un({shema:{description:"Create moving average series from existing one. The new series override the existing one unless the as array is provided",properties:{method:{type:"string"},alpha:{type:"number"},period:{type:"number"},fields:{type:"array",items:{type:"string"}},as:{type:"array",items:{type:"string"}}},required:["fields"]},transform:function(t,e){var n=e.as||[],r=e.method||"ema",i=void 0,o=void 0,a=void 0;e.fields.forEach(function(s,u){if(i=n[u]||s,"sma"===r){var l=Math.max(e.period||10,1),c=[],d=[];t.data.forEach(function(t,e){o=t[s],c.length===l&&(o-=d.splice(0,1)[0]),d.push(o),e&&(o+=c[c.length-1]),c.push(o),t[i]=o/c.length})}else{var f=vn(e.alpha||.5,1-.999999,.999999);t.data.forEach(function(t,e){o=t[s],a=e?f*a+(1-f)*o:o,t[i]=a})}})}}),bn=un({schema:{description:"Group entries which are below a given aggregate cutoff",properties:{field:{type:"string"},cutoff:{type:"number"}},required:["field","cutoff"]},transform:function(t,e){var n=Qe(e.field),r=s.sum(t.data,n),i=[],o=0;return t.dimension(e.field).bottom(1/0).reduce(function(t,a){return(o+=n(a))/r<e.cutoff?i.push(a):i?(i.push(a),(a={label:"other",children:i})[e.field]=o,i=null,t.push(a)):t.push(a),t},[])}}),xn=un({schema:{description:"Perfrom a difference for a group of fields along a dimension. It is possible to perform a difference for different groups",properties:{dimension:{type:"string"},period:{type:"integer",minimum:1},fields:{type:"array",items:{type:"string"}},as:{type:"array",items:{type:"string"}},groupby:{type:"string"}},required:["dimension","fields"]},transform:function(t,n){function r(t){var r=t.dimension(n.dimension),s=n.fields.reduce(function(t,e){return t[e]=0,t},{}),u=[],l=void 0,c=void 0;r.top(1/0).forEach(function(t,r){l=e.assign({},t),u.push(t),c=r>o?u.splice(0,1)[0]:s,n.fields.forEach(function(e,n){t[i[n]||e]=t[e]-c[e]}),a.push(l)})}var i=n.as||[],o=n.period||1,a=[];if(n.groupby){var s=t.dimension(n.groupby);s.group().all().forEach(function(e){return r(t.new(s.filterAll().filter(e.key).top(1/0)))})}else r(t.new());return a}}),wn=e.assign(n.map({filter:cn,aggregate:function(t){var n=t.fields,r=t.ops,i=t.as,o=t.groupby;return n||r?e.isArray(n)?(r||(r="count"),e.isString(r)&&(r=function(t,e){var n=new Array(t);return n.fill(e),n}(n.length,r)),e.isArray(r)?(r.length<n.length&&dn("Aggregate transforms expects an ops array with same length as fields"),i||(i=[]),e.isArray(i)?function(t){var e,a,s=[];return o?function(t){var e=void 0,a=void 0,s=void 0,u=n.map(function(t,e){return a=r[e],s=hn.get("count"),a&&((s=hn.get(a))||(s=hn.get("count"),dn("Operation "+a+" is not supported, use count"))),{field:t,as:i[e]||t,op:s}});return t.dimension(o).group().reduce(function(t,n){return u.reduce(function(t,r){return e=0,r.as in t&&(e=t[r.as]),t[r.as]=r.op(e,n[r.field]),t},t)},null,Object).all().map(function(t){return t.value[o]=t.key,t.value})}(t):(n.forEach(function(n,o){e=r[o],a=G,e&&((a=fn.get(e))||(a=G,dn("Operation "+r[o]+" is not supported, use count"))),s.push({label:i[o]||n,data:a(t.data,function(t){return t[n]})})}),s)}:dn("Aggregate transform expects an array of as fields")):dn("Aggregate transform expects an array of ops")):dn("Aggregate transforms expect an array of fields"):function(t){var e=void 0;return t.data.reduce(function(t,n){for(e in n)e in t?t[e]+=1:t[e]=1;return t},{})}},mapfields:gn,timeseries:function(t){var e=t.sortby,n=t.groupby;return e||dn('timeseries transform requires a "sortby" entry'),function(t){if(e){if(n){var r,i=t.dimension(n),o=i.group().top(1/0),a=t.new([]);return o.forEach(function(n){r=t.new(i.filterExact(n.key).top(1/0)).dimension(e).group().top(1/0),a.series.set(n.key,t.new(r).dimension("key").top(1/0))}),a}return t.new(t.dimension(e).top(1/0))}return t}},crossfilter:function(t){var n=t.fields,r=t.query;return e.isArray(n)?e.isArray(r)?r.length!=n.length?dn("crossfilter transform expects an query array with same length as fields"):function(t){var i=void 0,o=void 0;return n.forEach(function(n,a){o=r[a],e.isString(o)&&(o=t.store.eval(o)),i=t.dimension(n).filterAll(),o&&i.filter(o)}),i?t.new(i.top(1/0)):t}:dn("crossfilter transform expects an array of query"):dn("crossfilter transform expects an array of fields")},movingaverage:yn,groupsmall:bn,diff:xn}),{add:function(t,e){this.set(t,un(e))}}),kn=o.dispatch("init","data","remove"),En={schema:{properties:{}},getConfig:function(){},initialise:function(){},getData:function(){},addTransforms:function(t){var n=this,r=void 0;t&&(e.isArray(t)||(t=[t]),t.forEach(function(t){(r=wn.get(t.type))?n.transforms.push(r(t)):dn('Transform type "'+t.type+'" not known')}))},asFrame:function(t){return t&&!e.isArray(t)&&t.constructor!==I&&(t=[t]),e.isArray(t)&&(t=new I(t=t.map(function(t){return t.constructor!==Object&&(t={data:t}),t}),this.store)),function(t,e){return e?U(t,e.slice()):t}(t,this.transforms)}},_n=e.assign(n.map(),{events:kn,add:function(t,n){function r(n,r){!function(t,n,r,i){var o=i.dataName(e.pop(r,"name")),a=[];Object.defineProperties(t,{name:{get:function(){return o}},store:{get:function(){return i}},type:{get:function(){return n}},transforms:{get:function(){return a}},config:{get:function(){return r}}}),t.initialise(r),t.addTransforms(e.pop(r,"transforms")),i.sources.set(o,t),kn.call("init",void 0,t)}(this,t,n,r)}return r.prototype=e.assign({},En,n),r.prototype.constructor=r,this.set(t,r),r},create:function(t,e){for(var n,r=this.values(),i=0;i<r.length;++i)if(n=r[i].prototype.getConfig(t))return new r[i](n,e)}});_n.add("array",tn),_n.add("remote",on),_n.add("composite",an),_n.add("expression",sn),K.prototype={size:function(){return this.sources.size()},addSources:function(t){if(e.isString(t)&&(t={source:t}),e.isArray(t)){var n=this;return t.map(function(t){return _n.create(t,n)})}if(t)return _n.create(t,this)},addTransforms:function(t){e.assign(this.transforms,t)},source:function(t,e){if(1===arguments.length)return this.sources.get(t);if(null===e){var n=this.sources.get(t);return this.sources.remove(t),kn.call("remove",this,n),n}return this.sources.set(t,e),this},clearCache:function(){this.sources.each(function(t){delete t.cachedFrame})},getData:function(t,n){var r=this.sources.get(t);if(!r)throw new Error("Data source "+t+" not available");if(r.cachedFrame)return Promise.resolve(r.cachedFrame);var i=r.getData(n);return e.isPromise(i)||(i=Promise.resolve(i)),i.then(function(t){return r.config.cache&&(r.cachedFrame=t),r.lastFrame=t,kn.call("data",r.store,r,t),t})},eval:function(t,e){var n=this.model.$child(e);return n.dataStore=this,fe(t).safeEval(n)},onData:function(t,e){var n=this,r=t.split(".")[0],i=this.sources.get(r);i&&i.lastFrame&&e(i.lastFrame),kn.on("data."+t,function(t,i){t.store===n&&t.name===r&&e(i)})},dataName:function(t){if(this.dataCount++,t)return""+t;return this.source("default")?"source"+this.dataCount:"default"}};var Mn=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},An=400,zn="75%",On=["visual","container"],Sn={live:[],types:{},papers:{},options:pn,schema:{title:"Visualize Specification Language",type:"object",definitions:{size:{oneOf:[{type:"number",description:"size in pixels",minimum:0},{type:"string",description:"Size as a percentage"}]}}},events:o.dispatch("before-init","after-init","resize","before-draw","after-draw")},$n={initialise:function(){},draw:function(){},redraw:function(t){if(this.drawing){var e=this,n="after-draw."+this.toString();Sn.events.on(n,function(){Sn.events.on(n,null),e.redraw(t)})}else this.drawing=this.draw(t);return this.drawing},destroy:function(){},toString:function(){return this.visualType+"-"+this.model.uid},getModel:function(t){t||(t=this.visualType);var n=this.model[t];if(!n&&t in pn){var r=e.pop(this.options,t),i=this;this.visualParent?n=this.visualParent.getModel(t).$child(r):(n=this.model.$new(pn[t])).$update(r),this.model[t]=n,n.$on(function(){return i.redraw(!1)})}return n},idname:function(t){return t||(t=this.visualType),t+"-"+this.model.uid},modelProperty:function(t,e){var n=this.getModel()[t];return void 0===n?e[t]:n},dim:function(t,e,n,r){return vn(J(t,e),n,r)},pop:function(t){if(t){var e=t.live.indexOf(this);e>-1&&t.live.splice(e,1)}},getVisualSchema:function(t){var n=this.options.visuals?this.options.visuals[t]:null,r=this.visualParent;if(r&&e.isString(n)?(t=n,n=r.getVisualSchema(t)):r&&!n&&(n=r.getVisualSchema(t)),e.isObject(n))return et(n)}},Pn=function(t,n){function r(e,n,r,i){Object.defineProperties(this,{visualType:{get:function(){return t}},isViz:{get:function(){return-1===On.indexOf(t)}},visualRoot:{get:function(){return this.visualParent?this.visualParent.visualRoot:this}}}),this.visualParent=r,this.model=r?r.model.$new():i||O(),this.options=n||{},this.drawing=!1,Sn.events.call("before-init",void 0,this),this.initialise(e),Sn.events.call("after-init",void 0,this)}var i=e.pop(n,"schema");return i&&(Sn.options[t]=nt(i),Sn.schema.definitions[t]={type:"object",properties:e.assign({data:{$ref:"#/definitions/data"}},i)}),r.prototype=e.assign({},Ut,$n,n),r.prototype.constructor=r,Sn.types[t]=r,r},Cn=Pn("visual",{schema:{render:{type:"string",enum:["canvas","svg"],default:"svg"},width:{description:"Width of the visual",$refs:"#/definitions/size"},height:{description:"Height of the visual",$refs:"#/definitions/size",default:"70%"}},initialise:function(t){if(!t)throw new Error("HTMLElement required by visual group");if(this.visualParent&&"container"!==this.visualParent.visualType)throw new Error("Visual parent can be a container only");this.select(t).select(".paper").node()||this.select(t).append("div").classed("paper",!0),Object.defineProperties(this,{element:{get:function(){return t}},paperElement:{get:function(){return this.sel.select(".paper")}},sel:{get:function(){return this.select(t)}},size:{get:function(){return[this.width,this.height]}}}),this.sel.classed("d3-visual",!0),this.layers=[],this.drawCount=0,Sn.live.push(this),t.__visual__=this,this.visualParent&&this.visualParent.live.push(this)},activate:function(){this.layers.forEach(function(t){return t.activate()})},deactivate:function(){this.layers.forEach(function(t){return t.deactivate()})},getVisual:function(){return this},draw:function(t){if(this.drawing)return dn(this.toString()+" already drawing"),this.drawing;this.drawCount?(this.drawCount++,this.clear()):(this.drawCount=1,this.fit());var e=this;return Sn.events.call("before-draw",void 0,this),Promise.all(this.layers.map(function(e){return e.redraw(t)})).then(function(){delete e.drawing,Sn.events.call("after-draw",void 0,e)},function(t){delete e.drawing,dn("Could not draw "+e.toString()+": "+t,t)})},clear:function(){},addVisual:function(t){var n=e.pop(t,"type"),r=Sn.types[n];if(r)return new r(this.element,t,this);dn('Cannot add visual "'+n+'", not available')},fit:function(){return this.resize(null,!0),this},resize:function(t,e){t||(t=Z(this.element.parentNode||this.element,this.getModel()));var n=this.size;return(e||n[0]!==t.width||n[1]!==t.height)&&(e||jt('Resizing "'+this.toString()+'"'),this.width=t.width,this.height=t.height,this.paperElement.style("height",this.height+"px"),Sn.events.call("resize",void 0,this),e||this.draw(!1)),this},paper:function(){var t=this.__paper,e=this.getModel().render;if(t&&t.paperType===e)return t;var n=Sn.papers[e];if(!n)throw new Error("Unknown paper "+e);return t=new n(this),this.__paper=t,t},getPaperGroup:function(t){return this.paper().group(t)},destroy:function(){this.pop(this.visualParent),this.pop(Sn)}});if(e.inBrowser){new MutationObserver(function(t){t.forEach(function(t){var e=t.removedNodes;e&&e.length&&e.forEach(function(t){t.querySelectorAll&&(t.__visual__?rt.call(t):i.select(t).selectAll(".d3-visual").each(rt))})})}).observe(document.documentElement,{childList:!0,subtree:!0})}var Tn=function(t){Dt.visualPlugins&&(!function(t){var n=void 0,r=void 0;Object.keys(t).forEach(function(i){n=t[i].options,r=t[i].prototype,n&&(Sn.options[i]=n),r&&e.assign(jn,r)})}(Dt.visualPlugins),Dt.visualPlugins=null);for(var n=[{},jn,Dn],r=1;r<arguments.length;++r)n.push(arguments[r]);return Pn(t,e.assign.apply(void 0,n))},jn={$:null,initialise:function(t){var n=this.visualParent;if(void 0!==this.options.active?this.active=e.pop(this.options,"active"):this.active=!0,n){if(!n.layers)throw new Error("visual parent of "+this.visualType+" does not have layers")}else this.visualParent=n=new Cn(t,this.options,null,this.model),this.model=n.model.$new(),this.options={};n.layers.push(this)},paper:function(){if(this.paperType){if(!this._paper){var t=Sn.papers[this.paperType];if(!t)throw new Error("Unknown paper "+this.paperType);this._paper=new t(this)}return this._paper}return this.visualParent.paper()},activate:function(t){return this.active||(this.active=!0,this.group().transition(this.model.uid).on("end",function(){t&&t()}).style("opacity",1)),this},deactivate:function(t){return this.active&&(this.active=!1,this.group().transition(this.model.uid).on("end",function(){t&&t()}).style("opacity",0)),this},getVisual:function(){return this.visualParent.getVisual()},group:function(t){var e=this.visualType+"-"+this.model.uid,n=this.visualParent.getPaperGroup(e);return t&&t!==this.visualType?this.paper().childGroup(n,t):n},translate:function(t,n){return e.isFunction(t)?function(e){return"translate("+(t(e)||0)+", "+(n(e)||0)+")"}:"translate("+t+", "+n+")"},getD3:function(t,e){return this.$[""+t+e[0].toUpperCase()+e.substring(1)]},displayError:function(){}},Dn={draw:function(t){var e=this;if(this.drawing)return dn(this.toString()+" already drawing"),this.drawing;var n=this,r=this.doDraw;if(this.paper().size(this.boundingBox(!0)),this.active){if(Sn.events.call("before-draw",void 0,this),!1!==t||!this._drawArgs)return Promise.all([this.requires?Dt.require.apply(void 0,this.requires):[],this.getData()]).then(function(t){delete n.drawing;var i=t[1];i&&(e.$=t[0],e.frame=i,r.apply(n),Sn.events.call("after-draw",void 0,n))},function(t){delete n.drawing,dn("Could not draw "+n.toString()+": "+t,t),e.displayError(t)});delete n.drawing,r.apply(n,this._drawArgs),Sn.events.call("after-draw",void 0,n)}}},Nn={initialise:function(){},transition:function(){},size:function(t){return this.sel.attr("width",t.width).attr("height",t.height),this},group:function(t,e){return this.childGroup(this.sel,t,e)},childGroup:function(t,e,n){e||(e="main");var r=t.selectAll("."+e).data([0]).enter().append("g").classed(e,!0);return n&&r.attr("transform",n).merge().attr("transform",n),t.select("."+e)},dim:function(t){return t}};it("svg",{initialise:function(t,e){e||t.model.uid;var n=t.paperElement.select("svg#"+e);return n.size()||(n=t.paperElement.append("svg").attr("id",e).classed(t.visualType,!0).style("position","absolute")),n.node()}}),it("div",{initialise:function(t){var e=t.model.uid,n=t.visualParent,r=n.paperElement.select("div#"+e);return r.size()||(r=n.paperElement.append("div").attr("id",e).classed(n.visualType,!0).style("position","absolute")),r.node()},size:function(t){return this.sel.style("width",t.width+"px").style("height",t.height+"px"),this},childGroup:function(t,e){return e||(e="main"),t.selectAll("."+e).data([0]).enter().append("div").classed(e,!0),t.select("."+e)}});jn.getScale=function(t){e.isString(t)&&(t={type:t});return function(t,n){return(n.$events?n.$events.keys():Object.keys(n)).forEach(function(r){e.isFunction(t[r])&&t[r](n[r])}),t}(this.getD3("scale",t.type)(),t)},pn.menu={display:!1,height:"8%",maxHeight:50,minHeight:20},Sn.events.on("after-init.menu",function(t){if("visual"===t.visualType){t.getModel("menu").display&&(t.menu=t.sel.insert("nav",":first-child").classed("d3-nav navbar p-1",!0),t.menu.append("h4").classed("title",!0))}}),Sn.events.on("before-draw.menu",function(t){t&&t.menu&&function(t){var e=t.getModel("menu"),n=t.dim(e.height,t.height,e.minHeight,e.maxHeight);t.menu.style("height",n+"px")}(t)}),e.assign(Sn.schema.definitions,{data:{type:"array",items:{$ref:"#/definitions/dataSource"}},dataSource:{oneOf:_n.values().map(function(t){var e=t.prototype.schema;return e.properties.transforms={$ref:"#/definitions/transforms"},e})}}),jn.getData=function(){var t=this.model.data;{if(t)return this.dataStore.getData(t,{$visual:this});dn("Visual "+this.visualType+" without data name, cannot get data")}},jn.getContext=function(t){return this.dataStore.model.$child(t)},Sn.events.on("before-init.data",function(t){t.isViz&&(t.data=e.pop(t.options,"data"))}),Sn.events.on("after-init.data",function(t){Object.defineProperties(t,{dataStore:{get:function(){return t.model.root.dataStore}}}),t.isViz?function(t){var n=t.dataStore,r=e.pop(t,"data");r&&(e.isString(r)&&(r={source:r}),r.name||(r.name=t.model.uid),(r=n.addSources(r))?t.model.$set("data",r.name):dn("Could not create data source "+r.name))}(t):function(t){var n=t.dataStore,r=e.pop(t.options,"data");n||(n=new K(t.getModel("dataContext")),t.model.root.dataStore=n),n.addSources(r)}(t)});var qn=n.map(),Rn=function(t,e){var n=qn.get(t);return n||(n=c.format(t),qn.set(t,n)),2==arguments.length?n(e):n},Fn=n.map(),Ln=function(t,e){var n=Fn.get(t);return n||(n=u.timeFormat(t),Fn.set(t,n)),2==arguments.length?n(e):n};if(Sn.options.dataContext={$format:Rn,$formatTime:Ln},jn.format=function(t){var e=this.dataStore.eval(t);if(e)return e;try{return Rn(t)}catch(e){return Ln(t)}},Sn.options.font={size:"3%",minSize:10,maxSize:20,stroke:"#333",family:null},jn.font=function(t,e){e=e||this.getModel("font");var n=this.getModel(),r=this.dim(e.size,t.height,e.minSize,e.maxSize);return n.fontSizeMultiplier&&(r*=n.fontSizeMultiplier),r},pn.resizeDelay||(pn.resizeDelay=200),e.inBrowser){var Wn=Lt(function(){Sn.live.forEach(function(t){return t.resize()})},pn.resizeDelay);i.select(window).on("resize.visuals",Wn)}pn.title={text:null,size:"3%",minSize:15,maxSize:25,offset:["10%",0]},Sn.events.on("before-init.title",function(t){var n=t.options.title;e.isString(n)&&(t.options.title={text:n})}),Sn.events.on("after-draw.title",function(t){var e=t.getModel("title"),n=t;if("visual"===n.visualType)delete n.__title;else{if(!t.isViz)return;n=t.visualParent}if(e.text)if(n.menu&&!n.__title)n.__title=e,function(t,e){var n=function(t){return+t.substring(0,t.length-2)}(t.menu.style("height")),r=e.maxSize?Math.min(n-4,e.maxSize):n-4,i=t.dim(e.size,t.width,e.minSize,r);t.menu.select(".title").html(e.text).style("font-size",i+"px").style("line-height",n+"px")}(n,e);else if(t.isViz){var r=t.boundingBox(!0),i=t.getModel("font"),o=e.stroke||i.stroke,a=t.font(r,e),s=t.group().selectAll("text.chartitle").data([e.text]),u=t.dim(e.offset[0],r.vizHeight),l=t.dim(e.offset[1],r.vizWidth),c=t.translate(r.margin.left+r.innerWidth/2+l,u);s.enter().append("text").classed("chartitle",!0).attr("transform",c).style("text-anchor","middle").style("font-size",a).style("fill",o).text(function(t){return t}).merge(s).transition().attr("transform",c).style("font-size",a).style("fill",o).text(function(t){return t})}});var Xn=["top","bottom","left","right"],Yn=["left","right"];pn.margin={top:20,bottom:20,left:20,right:20},pn.padding={top:0,bottom:0,left:0,right:0},jn.boundingBox=function(t){if(t&&st(this),!this.__boundingBox){var e=this.visualParent.width,n=this.visualParent.height,r=at(this.getModel("padding"),e,n),i=e-r.left-r.right,o=n-r.top-r.bottom,a=at(this.getModel("margin"),i,o),s=Xn.reduce(function(t,e){return t[e]=a[e]+r[e],t},{});this.__boundingBox={margin:a,padding:r,total:s,width:e,height:n,vizWidth:i,vizHeight:o,innerWidth:e-s.left-s.right,innerHeight:n-s.top-s.bottom,$nomargins:ut}}return this.__boundingBox},Sn.events.on("after-init.margin",function(t){t.margin=ot("margin",t),t.padding=ot("padding",t)}),Sn.events.on("before-draw.margin",function(t){t.isViz&&st(t)});var Hn={ticks:5,tickSize:6,tickSizeOuter:null,rotate:null,ancor:"end",format:null,timeFormat:"%Y-%m-%d",stroke:"#333",hide:null,title:null,titleRotate:null,titleOffset:.7};Sn.options.xAxis=e.assign({location:"bottom"},Hn),Sn.options.yAxis=e.assign({location:"left"},Hn),jn.getAxis=function(t,e){return this.getD3("axis",t)(e)},jn.xAxis1=function(t,e,n,r){var i=this.getModel("xAxis"),o=this._axis(t,e,i,r),a=this.group("x-axis");return this.applyTransform(a,this.translateAxis(t,n)),ct(a.transition(this.transition("x-axis")).call(o),i,e),i.title&&this.axisTitle(a,t,e,n,i),a},jn.yAxis1=function(t,e,n,r){var i=this.getModel("yAxis"),o=this._axis(t,e,i,r),a=this.group("y-axis");return this.applyTransform(a,this.translateAxis(t,n)),ct(a.transition(this.transition("x-axis")).call(o),i,e),i.title&&this.axisTitle(a,t,e,n,i),a},jn.axisTitle=function(t,e,n,r,i){var o=t.selectAll("text.title").data([i.title]),a=i.titleRotate||0,s=0,u=0;a||"right"!==e&&"left"!==e||(a=-90),"left"==e&&(s=-i.titleOffset*r.margin.left,u=r.innerHeight/2);var l="translate("+s+","+u+") rotate("+a+")",c=this.font(r);o.enter().append("text").classed("title",!0).attr("transform",l).style("text-anchor","middle").style("font-size",c).style("fill",i.stroke).text(function(t){return t}).merge(o).transition().attr("transform",l).style("font-size",c).style("fill",i.stroke).text(function(t){return t})},jn.translateAxis=function(t,e){return"top"===t||"left"===t?this.translate(e.margin.left,e.margin.top):"bottom"===t?this.translate(e.margin.left,e.margin.top+e.innerHeight):this.translate(e.margin.left+e.innerWidth,e.margin.top)},jn._axis=function(t,n,r,i){var o=this.getAxis(t,n).tickSize(r.tickSize);return null!==r.tickSizeOuter&&o.tickSizeOuter(r.tickSizeOuter),e.isDate(i)?o.tickFormat(u.timeFormat(r.timeFormat)):null!==r.format&&o.tickFormat(this.format(r.format)),o.ticks(r.ticks)},jn.getSymbol=function(t){return this.$.symbol().type(this.getD3("symbol",t))},jn.getCurve=function(t){return this.getD3("curve",t)},jn.getStack=function(){var t=this.getModel();if(t.stack){var e=this.$.stack();return t.stackOrder&&e.order(this.getD3("stack",t.stackOrder)),t.stackOffset&&e.offset(this.getD3("stack",t.stackOffset)),e}};var In=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t},Bn="\\s*([+-]?\\d+)\\s*",Vn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Gn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Un=/^#([0-9a-f]{3})$/,Kn=/^#([0-9a-f]{6})$/,Jn=new RegExp("^rgb\\("+[Bn,Bn,Bn]+"\\)$"),Zn=new RegExp("^rgb\\("+[Gn,Gn,Gn]+"\\)$"),Qn=new RegExp("^rgba\\("+[Bn,Bn,Bn,Vn]+"\\)$"),tr=new RegExp("^rgba\\("+[Gn,Gn,Gn,Vn]+"\\)$"),er=new RegExp("^hsl\\("+[Vn,Gn,Gn]+"\\)$"),nr=new RegExp("^hsla\\("+[Vn,Gn,Gn,Vn]+"\\)$"),rr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};In(ft,ht,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}}),In(vt,function(t,e,n,r){return 1===arguments.length?gt(t):new vt(t,e,n,null==r?1:r)},dt(ft,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new vt(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new vt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}})),In(bt,function(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof bt)return new bt(t.h,t.s,t.l,t.opacity);if(t instanceof ft||(t=ht(t)),!t)return new bt;if(t instanceof bt)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new bt(a,s,u,t.opacity)}(t):new bt(t,e,n,null==r?1:r)},dt(ft,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new bt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new bt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new vt(xt(t>=240?t-240:t+120,i,r),xt(t,i,r),xt(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var ir=Math.PI/180,or=180/Math.PI,ar=.95047,sr=1,ur=1.08883,lr=4/29,cr=6/29,dr=3*cr*cr,fr=cr*cr*cr;In(kt,function(t,e,n,r){return 1===arguments.length?wt(t):new kt(t,e,n,null==r?1:r)},dt(ft,{brighter:function(t){return new kt(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new kt(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return t=sr*_t(t),e=ar*_t(e),n=ur*_t(n),new vt(Mt(3.2404542*e-1.5371385*t-.4985314*n),Mt(-.969266*e+1.8760108*t+.041556*n),Mt(.0556434*e-.2040259*t+1.0572252*n),this.opacity)}})),In(zt,function(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof zt)return new zt(t.h,t.c,t.l,t.opacity);t instanceof kt||(t=wt(t));var e=Math.atan2(t.b,t.a)*or;return new zt(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}(t):new zt(t,e,n,null==r?1:r)},dt(ft,{brighter:function(t){return new zt(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new zt(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return wt(this).rgb()}}));var hr=-.14861,pr=1.78277,mr=-.29227,gr=-.90649,vr=1.97294,yr=vr*gr,br=vr*pr,xr=pr*mr-gr*hr;In(Ot,function(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof Ot)return new Ot(t.h,t.s,t.l,t.opacity);t instanceof vt||(t=gt(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(xr*r+yr*e-br*n)/(xr+yr-br),o=r-i,a=(vr*(n-i)-mr*o)/gr,s=Math.sqrt(a*a+o*o)/(vr*i*(1-i)),u=s?Math.atan2(a,o)*or-120:NaN;return new Ot(u<0?u+360:u,s,i,t.opacity)}(t):new Ot(t,e,n,null==r?1:r)},dt(ft,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Ot(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Ot(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*ir,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new vt(255*(e+n*(hr*r+pr*i)),255*(e+n*(mr*r+gr*i)),255*(e+n*(vr*r)),this.opacity)}}));var wr=n.map();pn.color={scale:"cool",scaleMinPoints:6,scaleOffset:0,stroke:"#333",strokeOpacity:1,fillOpacity:1},wr.set("viridis",function(t){return t.scaleSequential(t.interpolateViridis)}),wr.set("inferno",function(t){return t.scaleSequential(t.interpolateInferno)}),wr.set("magma",function(t){return t.scaleSequential(t.interpolateMagma)}),wr.set("plasma",function(t){return t.scaleSequential(t.interpolatePlasma)}),wr.set("warm",function(t){return t.scaleSequential(t.interpolateWarm)}),wr.set("cool",function(t){return t.scaleSequential(t.interpolateCool)}),wr.set("rainbow",function(t){return t.scaleSequential(t.interpolateRainbow)}),wr.set("cubehelix",function(t){return t.scaleSequential(t.interpolateCubehelixDefault)}),jn.getColorScale=function(t){return wr.get(t)(this.$)},jn.colors=function(t,n){var r=this.getModel("color"),i=!1,o=void 0,a=void 0;if(e.isArray(r.scale))a=this.getScale("ordinal").range(r.scale);else{if(!(o=this.getColorScale(r.scale)))throw new Error("Unknown scale "+r.scale);e.isObject(o)||(o={scale:o}),void 0===o.minPoints&&(o.minPoints=r.scaleMinPoints),a=o.scale,i=o.reversed}if(e.isFunction(a.interpolator)){var u=r.scaleOffset,l=t+u,c=Math.max(l,o.minPoints),d=i?[c-1,0]:[0,c-1];a.domain(d);var f=void 0;return s.range(u,Math.min(l,c)).map(function(t){return f=ht(a(t)),f.opacity=n,f})}var h=a.range().slice();i&&h.reverse();for(var p=void 0,m=void 0,g=void 0,v=0;v<r.scaleOffset;++v)h.push(h.shift());return s.range(t).map(function(){return p=h.shift(),m=ht(p),g=ht(p),m.opacity=n,h.push(""+g.brighter(.2)),m})},jn.fill=function(t){function e(t,e){return i[e]}var n=this.getModel("color"),r=this.modelProperty("fillOpacity",n),i=this.colors(t.length,r);return e.colors=i,e},jn.stroke=function(t){function e(t,e){return i[e]}var n=this.getModel("color"),r=this.modelProperty("strokeOpacity",n),i=this.colors(t.length,r);return e.colors=i,e},jn.linearGradient=function(t,e,n,r){var i=this.paper().sel,o=i.select("defs");o.node()||(o=i.append("defs"));var a=o.selectAll("#"+r).data([0]),s=ht(t);s.opacity=.1,a.enter().append("linearGradient").attr("id",r).attr("x1","0%").attr("y1","0%").attr("x2","vertical"===n?"0%":"100%").attr("y2","vertical"===n?"100%":"0%");var u=o.select("#"+r).selectAll("stop").data([{offset:"0%",color:t},{offset:"100%",color:s}]);return u.enter().append("stop").merge(u).attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}),"url(#"+r+")"},pn.legend={location:"top-right",orient:"vertical",fontSize:"3%",title:"",titleWidth:"20%",labelFormat:null,titleMinWidth:30,titleMaxWidth:60,minFontSize:10,maxFontSize:20,offset:[10,10],shapeWidth:15,shapeHeight:15,hide:300},jn.getLegend=function(t){return this.getD3("legend",t)},jn.legend=function(t,n){var r=this.getModel(),i=this.getModel("legend"),o=this.getModel("font"),a=e.pop(t,"type")||r.legendType,s=Math.max(n.vizHeight,n.vizWidth),u=this.dim(i.fontSize,s,i.minFontSize,i.maxFontSize),l=this.getLegend(a);if(i.location){if(!l)return dn("Could not load legend "+a);if(l=l().orient(i.orient),i.title&&(l.title(i.title),i.titleWidth)){var c=this.dim(i.titleWidth,s,i.titleMinWidth,i.titleMaxWidth);l.titleWidth(c)}i.labelFormat&&l.labelFormat(i.labelFormat),l.shapeWidth(i.shapeWidth).shapeHeight(i.shapeHeight);for(var d in t)l[d](t[d]);var f=this.group("legend").style("font-size",u+"px").html("").call(l),h=f.node().getBBox(),p=kr.get(i.location).call(this,h,n,i),m=this.translate(p.x,p.y);f.selectAll("text").style("fill",i.stroke||o.stroke),this.applyTransform(f,m),i.hide&&(s<i.hide?f.style("opacity",0):f.style("opacity",1))}};var kr=n.map({top:function(t,e,n){var r=this.dim(n.offset[1],e.vizHeight);return{x:e.margin.left+(e.innerWidth-t.width)/2,y:r}},bottom:function(t,e,n){var r=this.dim(n.offset[1],e.vizHeight);return{x:e.margin.left+(e.innerWidth-t.width)/2,y:e.vizHeight-t.height-r}},right:function(t,e,n){var r=this.dim(n.offset[0],e.vizWidth);return{x:e.vizWidth-t.width-r,y:e.margin.top+(e.innerHeight-t.height)/2}},left:function(t,e,n){var r=this.dim(n.offset[0],e.vizWidth);return{x:e.margin.left-r,y:e.margin.top+(e.innerHeight-t.height)/2}},"top-left":function(t,e,n){var r=this.dim(n.offset[0],e.vizWidth),i=this.dim(n.offset[1],e.vizHeight);return{x:e.margin.left+(e.innerWidth-t.width)/2+r,y:i}},"top-right":function(t,e,n){var r=this.dim(n.offset[0],e.vizWidth),i=this.dim(n.offset[1],e.vizHeight);return{x:e.vizWidth-t.width-r,y:i}},"bottom-left":function(t,e,n){var r=this.dim(n.offset[0],e.vizWidth),i=this.dim(n.offset[1],e.vizHeight);return{x:t.width+r,y:e.vizHeight-t.height-i}},"bottom-right":function(t,e,n){var r=this.dim(n.offset[0],e.vizWidth),i=this.dim(n.offset[1],e.vizHeight);return{x:e.vizWidth-t.width-r,y:e.vizHeight-t.height-i}}}),Er=function(t){return function(){return t}},_r=function(t){return e.isFunction(t)?t:Er(t)},Mr=function(t){return t},Ar=n.map({darker:function(){function t(t,e){var n=t.getModel("mouse"),r=ht(e.style("fill")),i=r.darker(n.darkerFactor);e.node().__mouse_over__.fill=r,e.style("fill",i)}return t.out=function(t,e){var n=e.node().__mouse_over__.fill;n&&e.style("fill",n)},t}(),fill:function(){function t(t,e){var n=t.getModel("mouse"),r=ht(e.style("fill"));e.node().__mouse_over__.fill=r,e.transition().style("fill",n.fillColor)}return t.out=function(t,e){var n=e.node().__mouse_over__.fill;n&&e.transition().style("fill",n)},t}()});Sn.options.mouse={over:["darker"],darkerFactor:.5,fillColor:"#addd8e"},jn.mouseOver=function(){var t=this,e=this.getModel("mouse");return function(n,r){this.__mouse_over__||(this.__mouse_over__={});var i=t.select(this),o=void 0;e.over.forEach(function(e){(o=Ar.get(e))?o(t,i,n,r):dn("Unknown mouse strategy "+e)})}},jn.mouseOut=function(){var t=this,e=this.getModel("mouse");return function(n,r){this.__mouse_over__||(this.__mouse_over__={});var i=t.select(this),o=void 0;e.over.forEach(function(e){(o=Ar.get(e))?o.out(t,i,n,r):dn("Unknown mouse strategy "+e)})}},Sn.options.tooltip={location:"top",offset:[10,10],html:""},e.inBrowser?jn.tooltip=function(){function t(){return null===u&&(u=i.select(document.body).append("div").classed("d3-tooltip",!0).style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box").node(),l=i.select(document.body).append("svg").style("opacity",0).style("pointer-events","none").node().createSVGPoint()),i.select(u)}function e(){}function r(t){for(;null==t.getScreenCTM&&null==t.parentNode;)t=t.parentNode;var e={},n=t.getScreenCTM(),r=t.getBBox(),i=r.width,o=r.height,a=r.x,s=r.y;return l.x=a,l.y=s,e.nw=l.matrixTransform(n),l.x+=i,e.ne=l.matrixTransform(n),l.y+=o,e.se=l.matrixTransform(n),l.x-=i,e.sw=l.matrixTransform(n),l.y-=o/2,e.w=l.matrixTransform(n),l.x+=i,e.e=l.matrixTransform(n),l.x-=i/2,l.y-=o/2,e.n=l.matrixTransform(n),l.y+=o,e.s=l.matrixTransform(n),e}var o=_r("top"),a=_r([0,0]),s=_r(" "),u=null,l=null,c=n.map({top:function(t,e){var n=r(t);return{left:n.n.x-u.offsetWidth/2,top:n.n.y-u.offsetHeight-e[1]}},bottom:function(t,e,n){return{top:e.total.left+(e.innerWidth-t.width)/2,left:e.height-t.height-n.offsetY}},right:function(t,e){var n=r(t);return{left:n.e.x+e[0],top:n.e.y-u.offsetHeight/2}},left:function(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}},"top-left":function(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}},"top-right":function(t,e,n){return{x:e.width-t.width-n.offsetX,y:n.offsetY}},"bottom-left":function(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}},"bottom-right":function(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}}}),d=c.keys();return e.show=function(n){var r,i=Array.prototype.slice.call(arguments),u=t(),l=s.apply(this,i)||"",f=a.apply(this,i),h=o.apply(this,i),p=document.documentElement.scrollTop||document.body.scrollTop,m=document.documentElement.scrollLeft||document.body.scrollLeft;u.html(l).style("opacity",1).style("pointer-events","all");for(var g=d.length;g--;)u.classed(d[g],!1);return r=c.get(h).call(this,n,f),u.classed(h,!0).style("top",r.top+p+"px").style("left",r.left+m+"px"),e},e.hide=function(){return t().style("opacity",0).style("pointer-events","none"),e},e.location=function(t){return arguments.length?(o=null===t?t:_r(t),e):o},e.html=function(t){return arguments.length?(s=null===t?t:_r(t),e):s},e.offset=function(t){return arguments.length?(a=null==t?t:_r(t),e):a},e}():jn.tooltip=Mr,Ar.set("tooltip",function(){function t(t,e,n,r){var i=t.tooltipHtml(e,n,r);if(i){var o=t.getModel("tooltip");t.tooltip.location(o.location).offset(o.offset).html(i).show(e.node())}}return t.out=function(t){t.tooltip.hide()},t}()),jn.tooltipHtml=function(t,e,n){var r=this.getModel("tooltip");if(r.html)return this.dataStore.eval(r.html,{d:e,index:n,model:this.getModel()})},Sn.options.expand={location:"top-right",expandText:"expand",collapseText:"collapse",height:15,width:15,radius:3,offset:[0,0],stroke:"#adadad",fill:"#fff",fillOver:"#e6e6e6",textColor:"#111"},Sn.events.on("after-draw.expand",function(t){function e(){t.select(this).select("rect.button").attr("fill",r.fill)}var n=t.visualParent;if(t.isViz&&!(n.layers.length<=1)){var r=t.getModel("expand");if(t.__expanded||r.location&&function(t){return t.left||t.right||t.top||t.bottom}(t.getModel("padding"))){var i=t.getModel("font"),o=t.boundingBox(),a=t.group("expand"),s=a.node(),u=Math.floor(.8*Math.min(r.width,r.height)),l=t.__expanded?r.collapseText:r.expandText,c=!1;a.select("rect").size()||(c=!0,a.attr("cursor","pointer").on("mouseover",function(){t.select(this).select("rect.button").attr("fill",r.fillOver)}).on("mouseout",e),a.append("rect").classed("button",!0).attr("x",0).attr("y",0).attr("rx",r.radius).attr("ry",r.radius).attr("width",r.width).attr("height",r.height).attr("stroke",r.stroke).attr("fill",r.fill).attr("cursor","pointer"),a.append("text").attr("x",r.width/2).attr("y",r.height/2).attr("fill",r.textColor).attr("font-family",r.fontFamily||i.family).attr("text-anchor","middle").attr("alignment-baseline","middle").attr("font-size",u),a.append("rect").classed("placeholder",!0).attr("x",0).attr("y",0).attr("rx",r.radius).attr("ry",r.radius).attr("width",r.width).attr("height",r.height).attr("stroke","none").attr("fill","transparent").on("click",function(){var r=t.getModel("padding");if(e.call(this),t.__expanded){var i=t.__expanded.padding;delete t.__expanded,n.activate(),Xn.forEach(function(t){i[t]&&(r[t]=i[t])})}else t.__expanded={padding:Xn.reduce(function(t,e){return r[e]&&(t[e]=r[e],r[e]=0),t},{})},n.deactivate(),t.activate();n.redraw(!1)})),a.select("text").text(function(){return l});var d=kr.get(r.location).call(t,s.getBBox(),o,r);c||(a=a.transition(t.transition("expand"))),a.attr("transform",t.translate(d.x,d.y))}}}),Sn.options.transition={duration:250,delay:0,ease:null},jn.transition=function(t){var e=this.idname(t),n=this.getModel("transition");return l.transition(e).duration(n.duration)},jn.applyTransform=function(t,e){t.attr("transform")||t.attr("transform",e),t.transition().attr("transform",e)},jn.brushX=function(){return this.$.brushX()},jn.brushY=function(){return this.$.brushY()},jn.brush=function(){return this.$.brush()};var zr=Pn("container",{initialise:function(){this.live=[],this.visualParent&&this.visualParent.live.push(this)},draw:function(t){if(this.drawing)return dn(this.toString()+" already drawing"),this.drawing;var e=this;return Sn.events.call("before-draw",void 0,e),Promise.all(this.live.map(function(e){return e.redraw(t)})).then(function(){delete e.drawing,Sn.events.call("after-draw",void 0,e)})},destroy:function(){this.pop(this.visualParent)}}),Or={props:["schema","datasource","plugins","options"],render:function(t,n,r){var i=this,o=this.select(r).html();return this.getSchema(t.schema,function(r){return e.isObject(r)||(r={}),r=e.assign({},t.options,r),i.build(r,o,n)})},getSchema:function(t,n){var r=this.model.visual;if(r&&r!==this.model&&e.isString(t)){var i=r.getVisualSchema(t);i&&(t=i)}return e.isString(t)?this.json(t).then(n).catch(function(e){dn("Could not reach "+t+": "+e,e)}):n(t)},build:function(){}},Sr=e.assign({},Or,{build:function(t,e,n){var r=this.model,i=this.createElement("div"),o=r.root;return n.class&&i.attr("class",n.class),t.visuals||(t.visuals={}),r.visual=new zr(i.node(),t,r.visual,r.visual?null:r.$new()),o.visualDashboard||(o.visualDashboard=r.visual),i.html(e)}}),$r=e.assign({},Or,{build:function(t,n,r){var i,o=this.createElement("div"),a=t.type||"visual",s=this.model,u=e.pop(t,"visualDrawOnMount"),l={};return r.class&&o.attr("class",r.class),"visual"===a?(i=e.pop(t,"layers"),l=t):l.visual=e.pop(t,"visual")||{},void 0!==u&&(s.visualDrawOnMount=u),s.visual=new Cn(o.node(),l,s.visual,s.visual?null:s.$new()),"visual"!==a?s.visual.addVisual(t):i&&i.forEach(function(t){return s.visual.addVisual(t)}),o},mounted:function(){!1!==this.model.visualDrawOnMount&&this.model.visual.redraw()}}),Pr={install:function(t){t.addComponent("dashboard",Sr),t.addComponent("visual",$r)}},Cr=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},Tr=function(t,e){var n=t[0],r=(t[1]-n)/e,i=Math.floor(Math.log10(r)),o=Math.pow(10,i);r/o>5&&(o*=10);var a=(o*=.1)*Math.ceil(r/o),s=o*Math.floor(n/o);return[s,s+e*a]},jr=function(t,e,n){return.299*(t=ht(t)).r+.587*t.g+.114*t.b>186?n||"#000":e||"#fff"},Dr=function(t,e,n){e=_r(e),t.each(function(t,r){var o=i.select(this),a=parseFloat(o.attr("dy"))||0,s=e(t,r),u=o.text().split("\n"),l=void 0,c=void 0,d=void 0,f=o.text(null).append("tspan").attr("x",0).attr("dy",a+"em");u.forEach(function(t,e){for(d=[],c=t.split(/\s+/).reverse(),e&&(f=o.append("tspan").attr("x",0).attr("dy",1.2+a+"em"));l=c.pop();)d.push(l),f.text(d.join(" ")),f.node().getComputedTextLength()>s&&d.length>1&&(d.pop(),f.text(d.join(" ")),d=[l],f=o.append("tspan").attr("x",0).attr("dy",1.2+a+"em").text(l))}),n&&o.selectAll("tspan").each(n)})},Nr=["linear","log","time"];e.assign(Sn.schema.definitions,{curve:{type:"string",description:"curve type for line and area charts",default:"natural",enum:["basis","basisClosed","basisOpen","bundle","cardinal","cardinalClosed","cardinalOpen","catmullRom","catmullRomClosed","catmullRomOpen","linear","linearClosed","monotoneX","monotoneY","natural","step","stepAfter","stepBefore"]},stack:{type:"object",properties:{order:{type:"string",enum:["ascending","descending","insideOut","none","reverse"],default:"none"},offset:{type:"string",enum:["diverging","expand","none","silhouette","wiggle"],default:"none"}}}});var qr={lineWidth:{type:"number",default:1},curve:{$ref:"#/definitions/curve"},cornerRadius:{type:"number",default:0,minimum:0,description:"corner radius in pixels"},x:{type:"string",description:"data accessor for the x coordinate",default:"x"},y:{type:"string",description:"data accessor for the y coordinate",default:"y"},scaleX:{type:"string",description:"scale for the x coordinate",enum:Nr,default:"linear"},scaleY:{type:"string",description:"scale for the y coordinate",enum:Nr,default:"linear"},axisX:{type:"boolean",description:"draw x axis",default:!1},axisY:{type:"boolean",description:"draw y axis",default:!1},groupby:{type:"string",description:"Group data by a given dimension"},stack:{$ref:"#/definitions/stack"},gradient:{type:"boolean",description:"Gradient to zero opacity",default:!1},lineDarken:{type:"number",description:"Darken line color",minimum:0,maximum:1,default:.2}},Rr={center:"middle",top:"hanging",bottom:"baseline",outside:"baseline"},Fr={center:function(t,e){return e/2},top:function(t,e,n){return n},bottom:function(t,e,n){return e-n},outside:function(t,e,n){return-n}};Tn("barchart",{requires:["d3-scale","d3-axis","d3-svg-legend"],schema:{x:qr.x,y:qr.y,orientation:{type:"string",enum:["vertical","orizontal"],default:"vertical"},groupby:qr.groupby,stack:qr.stack,waffle:{type:"boolean",description:"ability to draw a waffle chart"},normalize:{type:"boolean"},lineWidth:qr.lineWidth,cornerRadius:qr.cornerRadius,axisX:qr.axisX,axisY:qr.axisY,scaleY:qr.scaleY,sortby:{type:"string",enum:["x","y"]},label:{type:"string",description:"expression for label text"},scaleX:{type:"object",default:{type:"band",padding:.2},properties:{type:{type:"string"},padding:{type:"number"}}}},options:{labelLocation:"center",labelOffset:10,labelWidth:.7,valueformat:".1f",legendType:"color",legendLabel:"label"},doDraw:function(){var t=this.getModel(),e=this.frame,n=e.data,r=this.boundingBox(),i=this.group(),o=this.group("chart"),a=t.x,s=t.y,u=t.groupby,l="vertical"===t.orientation?new St(this):new $t(this),c=void 0,d=!1;if(this.applyTransform(i,this.translate(r.padding.left,r.padding.top)),this.applyTransform(o,this.translate(r.margin.left,r.margin.top)),u&&(c=e.dimension(u).group().top(1/0).map(function(t){return t.key}).sort()).length<=1&&(c=null),c){var f=e.pivot(a,u,s);"y"===t.sortby&&(f=f.sortby("total")),n=f.data,l.sz.domain(c).range(this.fill(c).colors),t.stack&&(t.normalize&&(n=this.normalize(f)),d=!0)}else l.sz.domain([s]).range(this.fill([s]).colors),d=!0;var h=n.map(function(t){return t[a]});l.sx.domain(h),d||!c?l.stacked(o,n,c):l.grouped(o,n,c),l.axis(h),l.legend(c)}});var Lr={init:function(t){this.viz=t,this.model=t.getModel(),this.box=t.boundingBox(),this.sx=t.getScale(this.model.scaleX),this.sy=t.getScale(this.model.scaleY),this.sz=t.getScale("ordinal")},legend:function(t){t&&this.viz.legend({type:"color",scale:this.sz},this.box)},stacked:function(t,e,n){function r(t){return h(t[1-_])-h(t[_])}function i(t){return f(t.data[m])}function o(t){return h(t[_])}function a(t){return t.forEach(function(e){e.key=t.key,e.value=e.data[t.key]}),t}function u(t,e){var n=k(t,e)+x(t,e)/2,r=E(t,e)+P(t,w(t,e),T);return v.translate(n,r)}function l(t){return jr(p(t.key),"#fff",A.stroke)}function c(t,e){return v.dataStore.eval(z,{d:t,index:e})}var d=this.viz.getModel("color"),f=this.sx,h=this.sy,p=this.sz,m=this.model.x,g=this.model.y,v=this.viz,y=this.model.cornerRadius,b=t.selectAll(".group"),x=void 0,w=void 0,k=void 0,E=void 0,_=void 0,M=void 0;if(n?this.sy.domain([0,s.max(e,function(t){return t.total})]).nice():(this.sy.domain([0,s.max(e,function(t){return t[g]})]).nice(),n=[this.model.y]),this.vertical?(k=i,E=o,x=f.bandwidth,w=r,_=1):(k=o,E=i,x=r,w=f.bandwidth,_=0),e=v.getStack().keys(n)(e),(b=b.data(e)).exit().transition().style("opacity",0).remove(),(M=b.enter().append("g").classed("group",!0).attr("fill",function(t){return p(t.key)}).merge(b).attr("fill",function(t){return p(t.key)}).attr("stroke",v.modelProperty("stroke",d)).attr("stroke-opacity",v.modelProperty("strokeOpacity",d)).selectAll("rect").data(a)).enter().append("rect").attr("x",k).attr("y",E).attr("height",w).attr("width",x).attr("rx",y).attr("ry",y).on("mouseover",v.mouseOver()).on("mouseout",v.mouseOut()).merge(M).transition().attr("x",k).attr("y",E).attr("height",w).attr("width",x),M.exit().transition().style("opacity",0).remove(),this.model.label){var A=v.getModel("font"),z=this.model.label,O=v.font(this.box)+"px",S=t.selectAll(".labels").data(e),$=this.vertical?Rr[this.model.labelLocation]||"baseline":"middle",P=Fr[this.model.labelLocation],C=this.model.labelWidth,T=this.model.labelOffset;(M=S.enter().append("g").classed("labels",!0).merge(S).selectAll("text").data(a)).enter().append("text").classed("label",!0).attr("transform",u).style("fill",l).style("font-size",O).text(c).merge(M).text(c).style("font-size",O).call(Dr,function(t){return C*x(t)},function(){v.select(this).attr("alignment-baseline",$).attr("text-anchor","middle")}).transition(v.transition("text")).attr("transform",u).style("fill",l)}},grouped:function(t,e,n){function r(t){return u(t[d])}function i(t){return l(t.value)}function o(t){return l(0)-l(t.value)}var a=this.viz.getModel("color"),u=this.sx,l=this.sy,c=this.sz,d=this.model.x,f=this.viz,h=this.model.cornerRadius,p=u.paddingInner(),m=f.getScale("band").domain(n).paddingInner(.5*p),g=t.selectAll(".group"),v=void 0,y=void 0,b=void 0,x=void 0;l.domain([0,s.max(e,function(t){return n.reduce(function(e,n){return Math.max(e,t[n])},0)})]).nice(),this.vertical?(m.rangeRound([0,u.bandwidth()]),b=r,v=m.bandwidth,y=o):(b=r,y=m.bandwidth,v=o),(g=g.data(e)).exit().remove(),(x=g.enter().append("g").classed("group",!0).attr("transform",function(t){return f.translate(b(t),0)}).merge(g).attr("transform",function(t){return f.translate(b(t),0)}).selectAll("rect").data(function(t){return n.map(function(e){return{key:e,value:t[e]}})})).exit().transition().style("opacity",0).remove(),x.enter().append("rect").attr("x",function(t){return m(t.key)}).attr("y",i).attr("rx",h).attr("ry",h).attr("height",y).attr("width",v).attr("stroke-width",this.model.lineWidth).attr("stroke",a.stroke).attr("stroke-opacity",0).attr("fill",function(t){return c(t.key)}).on("mouseover",f.mouseOver()).on("mouseout",f.mouseOut()).merge(x).transition(f.transition("rect")).attr("x",function(t){return m(t.key)}).attr("y",i).attr("height",y).attr("width",v).attr("stroke",a.stroke).attr("stroke-opacity",a.strokeOpacity).attr("fill",function(t){return c(t.key)}),x.exit().remove()}};St.prototype=e.assign({},Lr,{axis:function(t){this.model.axisX&&this.viz.xAxis1(!0===this.model.axisX?"bottom":this.model.axisX,this.sx,this.box,t[0]),this.model.axisY&&this.viz.yAxis1(!0===this.model.axisY?"left":this.model.axisY,this.sy,this.box)}}),$t.prototype=e.assign({},Lr,{axis:function(t){this.model.axisX&&this.viz.xAxis1(!0===this.model.axisX?"left":this.model.axisX,this.sx,this.box,t[0]),this.model.axisY&&this.viz.yAxis1(!0===this.model.axisY?"bottom":this.model.axisY,this.sy,this.box)}});var Wr=function(){function t(t){var s=!1,u=void 0,l=void 0,c=void 0;return e&&(l=t.dimension(e).group().top(1/0).map(function(t){return t.key}).sort()).length<=1&&(l=null),l?(t=t.pivot(n,e,r),i&&(t=t.sortby("total")),u=t.data,o&&(a&&(u=function(t){return t}(u)),u=o.keys(l)(u),s=!0)):(u=t.data,l=[r]),s||(u=l.map(function(t,e){return c=u.map(function(e){return c=[0,e[t]],c.data=e,c}),c.index=e,c.key=t,c})),new Pt(u,n,r,s)}var e=null,n="x",r="y",i=!1,o=null,a=!1;return t.groupby=function(n){return arguments.length?(e=n,t):e},t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t.normalize=function(e){return arguments.length?(a=e,t):a},t.stack=function(e){return arguments.length?(o=e,t):o},t};Pt.prototype={rangeX:function(){return this.range(this.x)},rangeY:function(){return this.range()},range:function(t){function e(t){return t[0]}function n(t){return t[1]}function r(e){return e.data[t]}var i=void 0,o=void 0;return o=t?this.data.reduce(function(t,e){return i=s.extent(e,r),t.push(i[0]),t.push(i[1]),t},[]):this.data.reduce(function(t,r){return i=s.extent(r,e),t.push(i[0]),t.push(i[1]),i=s.extent(r,n),t.push(i[0]),t.push(i[1]),t},[]),s.extent(o)}},Tn("linechart",{requires:["d3-scale","d3-shape","d3-axis","d3-svg-legend"],schema:{lineWidth:qr.lineWidth,curve:qr.curve,x:qr.x,y:qr.y,scaleX:qr.scaleX,scaleY:qr.scaleY,groupby:qr.groupby,axisX:qr.axisX,axisY:qr.axisY},doDraw:function(){function t(t,e){return m[e]}var n=this.getModel(),r=this.frame,i=n.x,o=n.y,a=this.boundingBox(),s=Wr().groupby(n.groupby).x(i).y(o)(r),u=s.rangeX(),l=s.rangeY(),c=this.getScale(n.scaleX).domain(u).rangeRound([0,a.innerWidth]),d=this.getScale(n.scaleY).domain(l).rangeRound([a.innerHeight,0]).nice(),f=this.group(),h=this.group("chart"),p=h.selectAll(".line").data(s.data),m=this.stroke(s.data).colors,g=0,v=this.$.line().x(function(t){return c(t.data[i])+g}).y(function(t){return d(t[1])}).curve(this.getCurve(n.curve));this.applyTransform(f,this.translate(a.padding.left,a.padding.top)),this.applyTransform(h,this.translate(a.margin.left,a.margin.top)),e.isFunction(c.bandwidth)&&(c.domain(s.data[0].map(function(t){return t.data[i]})),g=c.bandwidth()/2),p.enter().append("path").attr("class","line").attr("fill","none").attr("stroke",t).attr("stroke-width",n.lineWidth).attr("d",v).merge(p).transition().attr("stroke",t).attr("stroke-width",n.lineWidth).attr("d",v),p.exit().transition().style("opacity",0).remove(),n.axisX&&this.xAxis1(!0===n.axisX?"bottom":n.axisX,c,a),n.axisY&&this.yAxis1(!0===n.axisY?"left":n.axisY,d,a),s.data.length>1&&this.legend({type:"color",scale:this.getScale("ordinal").range(m).domain(s.data.map(function(t){return t.key}))},a)}}),Tn("areachart",{requires:["d3-scale","d3-shape","d3-axis","d3-svg-legend"],schema:{lineWidth:qr.lineWidth,curve:qr.curve,x:qr.x,y:qr.y,scaleX:qr.scaleX,scaleY:qr.scaleY,groupby:qr.groupby,axisX:qr.axisX,axisY:qr.axisY,stack:qr.stack,gradient:qr.gradient,lineDarken:qr.lineDarken},doDraw:function(){function t(t){return h(t.data[a])}function e(t){return p(t[0])}function n(t){return p(t[1])}var r=this,i=this.frame,o=this.getModel(),a=o.x,s=o.y,u=this.getModel("color"),l=this.boundingBox(),c=Wr().groupby(o.groupby).stack(this.getStack()).x(a).y(s)(i),d=c.rangeX(),f=c.rangeY(),h=this.getScale(o.scaleX).domain(d).rangeRound([0,l.innerWidth]),p=this.getScale(o.scaleY).domain(f).rangeRound([l.innerHeight,0]).nice(),m=this.group(),g=this.group("chart"),v=g.selectAll(".areagroup").data(c.data),y=this.colors(c.data.length),b=o.gradient?y.map(function(t,e){return r.linearGradient(t,l,"vertical","fill"+r.model.uid+"-"+e)}):y,x=this.getCurve(o.curve);this.applyTransform(m,this.translate(l.padding.left,l.padding.top)),this.applyTransform(g,this.translate(l.margin.left,l.margin.top)),v.exit().transition().style("opacity",0).remove();var w=v.enter().append("g").classed("areagroup",!0).merge(v).selectAll("path").data(function(i){var a=r.$.area().curve(x).x(t).y1(n).y0(e),s=r.$.line().curve(x).x(t).y(n),u=ht(y[i.index]);return[{type:"area",data:i,draw:a(i),stroke:"none",fill:b[i.index]},{type:"line",data:i,draw:s(i),fill:"none",stroke:u.darker(o.lineDarken)}]});w.enter().append("path").attr("class",function(t){return t.type}).attr("fill",function(t){return t.fill}).attr("stroke",function(t){return t.stroke}).attr("d",function(t){return t.draw}).merge(w).transition(this.transition("area")).attr("d",function(t){return t.draw}).attr("fill",function(t){return t.fill}).attr("stroke",function(t){return t.stroke}).attr("fill-opacity",u.fillOpacity).attr("stroke-width",o.lineWidth).attr("stroke-opacity",u.strokeOpacity),w.exit().transition().style("opacity",0).remove(),o.axisX&&this.xAxis1(!0===o.axisX?"bottom":o.axisX,h,l,d[0]),o.axisY&&this.yAxis1(!0===o.axisY?"left":o.axisY,p,l,f[0]),c.data.length>1&&this.legend({type:"color",scale:this.getScale("ordinal").range(y).domain(c.data.map(function(t){return t.key}))},l)},ticks:function(t,e){return Math.max(Math.floor(t/e),1)}});var Xr=Math.PI/180,Yr={proportionalData:function(t,e){return t.dimension(e).top(1/0)},total:function(t){function e(e){return n+=e[t],e[t]}var n=0;return e.total=function(){return n},e}};Tn("piechart",Yr,{requires:["d3-scale","d3-shape","d3-svg-legend"],schema:{field:{type:"string",default:"data"},label:{type:"string",default:"label"},startAngle:{description:"Overall start angle of the pie in degree",default:0,type:"number"},endAngle:{description:"Overall end angle of the pie in degree",default:360,type:"number"},sort:{type:"string",description:"sort data before visualizing",enum:["none","ascending","descending"],default:"none"},innerRadius:{description:"Inner radius for donuts",default:0,oneOf:[{type:"number",minimum:0},{type:"string"}]},padAngle:{description:"Angular separation between each adjacent arcs in degree",default:0,type:"number",minimum:0},cornerRadius:qr.cornerRadius,lineWidth:qr.lineWidth,center:{type:"string",description:"Expression which display information in the center of the pie chart. Should be used with innerRadius greater than 0"},centerFont:{description:"Center text font size and family",$ref:"#/definitions/font"}},doDraw:function(t){var e=this.getModel(),r=this.getModel("color"),i=e.field,o=this.boundingBox(),a=Math.min(o.innerWidth,o.innerHeight)/2,s=J(e.innerRadius,a),u=this.total(i),l=this.$.pie().padAngle(Xr*e.padAngle).startAngle(Xr*e.startAngle).endAngle(Xr*e.endAngle).value(u),d=this.$.arc().innerRadius(s).outerRadius(a).cornerRadius(e.cornerRadius),f=this.group(),h=this.group("chart"),p=l(this.proportionalData(t,i)),m=this.fill(p),g=h.selectAll(".slice").data(p);if(this.applyTransform(f,this.translate(o.padding.left,o.padding.top)),this.applyTransform(h,this.translate(o.margin.left+o.innerWidth/2,o.margin.top+o.innerHeight/2)),g.enter().append("path").attr("class","slice").attr("stroke",r.stroke).attr("stroke-opacity",0).attr("fill",m).attr("stroke-width",e.lineWidth).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(g).transition().attr("stroke",r.stroke).attr("stroke-opacity",r.strokeOpacity).attr("d",d).attr("fill",m),g.exit().transition().remove(),e.center){var v=n.map(p.reduce(function(t,e){return t[e.data.label]=e,t})),y=this.dataStore.eval(e.center,{total:u.total(),d:v});if(y){var b=this.getModel("font"),x=this.dim(e.centerFontSize,o.innerWidth),w=h.selectAll(".info").data([y]);w.enter().append("text").attr("class","info").attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-size",x+"px").style("fill-opacity",0).merge(w).text(y).style("fill-opacity",e.centerOpacity).style("fill",b.stroke).call(Dr,1.5*(s||a))}}if(e.legendType){u=u.total();var k=fe(e.legendLabel),E=c.format(e.fractionFormat),_=p.map(function(t,n){return k.eval({d:t,value:t.value,format:E,total:u,fraction:t.value/u,label:t.data[e.label]||n})});this.legend({scale:this.getScale("ordinal").domain(_).range(m.colors)},o)}}});Tn("pyramidchart",Yr,{requires:["d3-scale","d3-shape","d3-svg-legend"],options:{field:"data",label:"label",pad:.005,lineWidth:1,inverted:!1,funnel:!1,legendType:"color",invereted:!1,legendLabel:"label + ' - ' + format('.1%', fraction)"},doDraw:function(t){var e=this.getModel(),n=e.field,r=this.getModel("color"),i=this.boundingBox(),o=(e.funnel?function(){function t(t){var o=void 0,a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,f=0,h=0,p=t.length,m=new Array(p),g=new Array(p),v=r/p;for(o=0;o<p;++o)m[g[o]=o]=+e(t[o],o,t);for(g.sort(function(t,e){return Cr(m[t],m[e])}),l=m[g[0]],o=0;o<p;++o)a=g[o],u=m[a]/l,s=[[(c=i*u)/2,h+(d=f)],[-c/2,h+d],[-c/2,h+v-(f=r*(o===p-1?0:.5*n(u,o)))],[c/2,h+v-f]],h+=v,m[a]={index:o,value:m[a],fraction:u,points:s,data:t[a]};return m}var e=Mr,n=Er(0),r=1,i=1;return t.value=function(n){return arguments.length?(e="function"==typeof n?n:Er(+n),t):e},t.base=function(e){return arguments.length?(i=e,t):i},t.height=function(e){return arguments.length?(r=e,t):r},t.pad=function(e){return arguments.length?(n="function"==typeof e?e:Er(+e),t):n},t}():function(){function t(t){var o=void 0,a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,f=void 0,h=void 0,p=void 0,m=void 0,g=t.length,v=.5*i/r,y=new Array(g),b=new Array(g);for(o=0;o<g;++o)y[b[o]=o]=+e(t[o],o,t);for(b.sort(function(t,e){return Cr(y[t],y[e])}),h=y[b[0]],c=null,o=g-1;o>=0;--o)u=[],null===c?u.push([0,0]):(d=(f=c+p)*v,u.push([d,f]),u.push([-d,f])),a=b[o],s=g-o-1,l=y[a]/h,m=Math.sqrt(l),d=(f=(c=r*m)-(p=o?n(m,s):0))*v,u.push([-d,f]),u.push([d,f]),y[a]={index:s,value:y[a],fraction:l,points:u,data:t[a]};return y}var e=Mr,n=Er(0),r=1,i=1;return t.value=function(n){return arguments.length?(e="function"==typeof n?n:Er(+n),t):e},t.base=function(e){return arguments.length?(i=e,t):i},t.height=function(e){return arguments.length?(r=e,t):r},t.pad=function(e){return arguments.length?(n="function"==typeof e?e:Er(+e),t):n},t}()).pad(e.pad).value(function(t){return t[n]}),a=this.getScale("linear").rangeRound([0,i.innerWidth]),s=this.getScale("linear").rangeRound(e.inverted?[i.innerHeight,0]:[0,i.innerHeight]),u=t.new(o(this.proportionalData(t,n))).dimension("fraction").bottom(1/0),l=this.$.symbol().type(function(t){return function(t){return{draw:function(e){t.forEach(function(t,n){n?e.lineTo(t[0],t[1]):e.moveTo(t[0],t[1])}),e.closePath()}}}(t.points.map(function(t){return[a(t[0]),s(t[1])]}))}).size(1),c=this.fill(u),d=this.group(),f=this.group("chart"),h=f.style("shape-rendering","crispEdges").selectAll(".segment").data(u);if(this.applyTransform(d,this.translate(i.padding.left,i.padding.top)),this.applyTransform(f,this.translate(i.margin.left+i.innerWidth/2,i.margin.top)),h.enter().append("path").attr("class","segment").attr("stroke",r.stroke).attr("stroke-opacity",0).attr("fill",c).attr("stroke-width",e.lineWidth).attr("d",l).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(h).transition().attr("stroke",r.stroke).attr("stroke-opacity",r.strokeOpacity).attr("d",l).attr("fill",c),h.exit().remove(),e.legendType){var p=fe(e.legendLabel),m=this,g=u.map(function(t,n){return p.eval(m.getContext({d:t,value:t.value,fraction:t.fraction,label:t.data[e.label]||n}))});this.legend({scale:this.getScale("ordinal").domain(g).range(c.colors)},i)}}});Tn("treemap",{requires:["d3-scale","d3-hierarchy"],options:{label:"label",field:"data",padding:2,tile:"resquarify",format:","},doDraw:function(t,e){function n(t){return[t]}function r(t){var e=void 0;return t.map(function(t){return(e=t.children)&&(t._children=r(e),delete t.children),t})}var i=this,o=this.getModel(),a=this.getModel("font"),s=this.boundingBox(),u=Qe(o.label),l=Qe(o.field),d=c.format(o.format),f=e.hierarchy(function(t){return t={children:r(t)},t[o.label]="root",t}(t.data)).sum(l).sort(function(t,e){return e.value-t.value}).eachBefore(function(t){t.parent?(t.data._counter=t.parent.data._counter,t.parent.data._counter++):t.data._counter=0}),h=e.treemap().tile(function(t,e,n,r){return n.substring(0,e.length)!==e&&(n=""+e+n[0].toUpperCase()+n.substring(1)),r?t[n]:t[n]()}(e,"treemap",o.tile,!0)).size([s.innerWidth,s.innerHeight]).round(!0).padding(o.padding),p=this.fill(f.children).colors,m=this.group().attr("transform",this.translate(s.total.left,s.total.top)).style("shape-rendering","crispEdges"),g=h(f).leaves(),v=m.selectAll("g").data(g),y=this;this.paper().size(s),v.exit().remove();var b=(v=v.enter().append("g").attr("transform",function(t){return i.translate(t.x0,t.y0)}).merge(v).attr("transform",function(t){return i.translate(t.x0,t.y0)})).selectAll("rect").data(n);b.enter().append("rect").attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}).attr("fill",function(t){return p[t.data._counter]}).attr("stroke","none").on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(b).transition().attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}).attr("fill",function(t){return p[t.data._counter]}),(b=v.selectAll("text").data(n)).enter().append("text").style("fill",function(t){return jr(p[t.data._counter],"#fff",a.stroke)}).selectAll("tspan").data(function(t){var e=y.font({height:Math.min(t.x1-t.x0,t.y1-t.y0)}),n=u(t.data).split(/(?=[A-Z][^A-Z])/g);return n.push(d(t.value)),n.map(function(t){return{size:e,text:t}})}).enter().append("tspan").style("font-size",function(t){return t.size}).attr("x",4).attr("y",function(t,e){return 1.5*t.size+1.2*e*t.size}).text(function(t){return t.text})}}),Tn("text",{options:{label:"label",data:"data",text:'label + " " + data',sizeReduction:.7},doDraw:function(t){function e(t,e){return n.translate((e+.5)*c,0)}var n=this,r=this.getModel(),i=this.getModel("font"),o=this.boundingBox(),a=this.font(o),s=this.group(),u=this.group("chart"),l=u.selectAll("text").data(t.data),c=o.innerWidth/t.data.length,d=.4*c,f=this.dataStore,h=this.modelProperty("stroke",i);this.applyTransform(s,this.translate(o.padding.left,o.padding.top)),this.applyTransform(u,this.translate(o.margin.left,o.margin.top+o.innerHeight/2)),l.enter().append("text").attr("transform",e).attr("text-anchor","middle").attr("alignment-baseline","middle").style("fill",h).merge(l).attr("transform",e).text(function(t){return f.eval(r.text,t)}).style("fill",h).call(Dr,d,function(t,e){var i=a;e&&(i=r.sizeReduction*a),n.select(this).attr("font-size",i+"px")}),s.exit().remove()}}),Tn("heatmap",{requires:["d3-scale","d3-axis","d3-svg-legend"],options:{shape:"square",layout:"heatmap",buckets:10,pad:.005,x:"x",y:"y",z:"data",label:null,axisX:!0,axisY:!0,reverseColors:!0,tableColors:null},doDraw:function(t){function e(t){return t.data[r.label]}function n(t){return jr(t.color,"#fff",o.stroke)}var r=this.getModel(),i=this.getModel("color"),o=this.getModel("font"),a=r.layout,u=this.boundingBox(),l=s.extent(t.data,Qe(r.z));l[0]<0&&"punchcard"===a&&(a="heatmap");var c=this.heatmap(a,t,u,l),d=(u.innerWidth-c.width)/2,f=(u.innerHeight-c.height)/2,h=this.getSymbol(r.shape).size(function(t){return t.size*t.size}),p=this.group(),m=this.group("chart"),g=m.selectAll(".shape").data(c.data);if(this.applyTransform(p,this.translate(u.padding.left,u.padding.top)),this.applyTransform(m,this.translate(u.margin.left+d,u.margin.top+f)),s.range[0]<0&&"punchcard"===a&&(a="heatmap"),g.enter().append("path").classed("shape",!0).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).attr("fill",function(t){return t.color}).attr("fill-opacity",0).attr("stroke-opacity",0).attr("stroke",i.stroke).attr("d",h).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(g).transition(this.transition()).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).attr("fill-opacity",i.fillOpacity).attr("fill",function(t){return t.color}).attr("stroke-opacity",i.strokeOpacity).attr("stroke",i.stroke).attr("d",h),r.label&&"heatmap"===a){var v=this.font(u)+"px",y=m.selectAll(".labels").data(c.data);y.enter().append("text").classed("labels",!0).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).style("text-anchor","middle").style("alignment-baseline","middle").style("fill",n).style("font-size",v).text(e).merge(y).text(e).style("font-size",v).call(Dr,Math.ceil(.8*c.size)).transition(this.transition("text")).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).style("fill",n)}var b={innerWidth:c.width,innerHeight:c.height,margin:{top:u.margin.top+f,left:u.margin.left+d}};r.axisX&&this.xAxis1(!0===r.axisX?"bottom":r.axisX,c.scaleX,b),r.axisY&&this.yAxis1(!0===r.axisY?"left":r.axisY,c.scaleY,b),"heatmap"===a?this.legend({type:"color",shape:r.shape,scale:c.colors},u):"punchcard"===a&&this.legend({type:"size",shape:r.shape,scale:c.sizes},u)},heatmap:function(t,e,r,i){var o=this.getModel(),a=o.pad,u=o.x,l=o.y,c=o.z,d=e.dimension(o.x).group().size(),f=e.dimension(o.y).group().size(),h=Math.min(o.buckets,d*f),p=(1-a*(d+1))*r.innerWidth/d,m=(1-a*(f+1))*r.innerHeight/f,g=[],v=[],y=[],b=n.map(),x=n.map(),w=void 0,k=void 0,E=void 0,_=void 0,M=void 0,A=void 0,z=void 0,O=void 0,S=void 0,$=void 0;if(p<m?(O=p,S=r.innerWidth,$=f*(O+(a*=S))+a):(O=m,$=r.innerHeight,S=d*(O+(a*=$))+a),i=Tr(i,h),"heatmap"===t){var P=this.fill(s.range(h)).colors;o.reverseColors&&(P=P.reverse()),A=this.getScale("quantile").range(P).domain(i),z=function(){return 1}}else{var C=this.colors(1)[0];A=function(){return C},z=this.getScale("quantile").range(s.range(h).map(function(t){return(t+1)/h})).domain(i)}return e.data.forEach(function(t){w=t[u],k=t[l],E=t[c],b.has(w)||(b.set(w,v.length),v.push(w)),x.has(k)||(x.set(k,y.length),y.push(k)),_=b.get(w),M=x.get(k),g.push({i:_,j:M,x:a+O/2+_*(O+a),y:a+O/2+M*(O+a),color:A(E),size:O*z(E),data:t})}),{data:g,size:O,width:S,height:$,scaleX:this.getScale("band").domain(v).range([0,S]),scaleY:this.getScale("band").domain(y).range([0,$]),colors:A,sizes:z}}}),jn.getGeoProjection=function(t){return this.getD3("geo",t)()},Tn("geochart",{requires:["d3-scale","d3-geo","topojson","d3-geo-projection","d3-svg-legend"],schema:{geometry:{type:"string",description:"The geometry to visualize from the topojson geometry objects",default:"countries"},geoKey:{type:"string",default:"id"},dataKey:{type:"string",default:"id"},dataLabelKey:{type:"string",default:"label"},dataValueKey:{type:"string",default:"value"},neighbors:{type:"boolean",default:!1},buckets:{type:"number",default:10},choroplethScale:{type:"string",default:"quantile"},boundGeometry:{type:"string"},boundScaleFactor:{type:"number",default:.9},projection:{type:"string",default:"kavrayskiy7"},graticule:{type:"boolean",default:!1},leaflet:{type:"boolean",default:!1},scale:{type:"number",default:200}},doDraw:function(){var t=function(t){var e={};return"frameCollection"===t.type?t.frames.each(function(t){"Topology"===t.type?e.topology=t:"dataframe"===t.type&&(e.data=t.data)}):"Topology"===t.type&&(e.topology=t),e}(this.frame);if(!t.topology)return dn("Topojson data not available - cannot draw topology");this._geoPath||this.createGeoPath(t),this.update(t)},update:function(t){var n=this.getModel(),r=this.getModel("color"),i=this.boundingBox(),o=this.group(),a=this.group("geo"),u=this._geoPath,l=function(t,n,r){var i=r.geoKey,o=r.dataKey,a={},u=void 0,l=void 0,c=void 0;if(!n.topology)return dn("No topology object available");var d=n.topology.objects[r.geometry];if(!d)return dn("Topology object "+r.geometry+" is not available");var f=r.neighbors?t.neighbors(d.geometries):null;return u=t.feature(n.topology,d).features,n.data&&(a=n.data.reduce(function(t,e){return t[e[o]]=e,t},{})),u=u.map(function(t){return c=t.properties,l=t[i]||c[i],{id:l,type:t.type,geometry:t.geometry,data:e.assign({},c,a[l])}}),f&&u.forEach(function(t,e){t.neighbors=f[e],t.rank=s.max(t.neighbors,function(t){return u[t].rank})+1|0}),u}(this.$,t,n);if(!l){var c=Object.keys(t.topology.objects).map(function(t){return'"'+t+'"'}).join(", ");return dn('Could not find *geometry* "'+n.geometry+'" in ['+c+"] - cannot draw geochart")}o.transition(this.transition("group0")).attr("transform",this.translate(i.padding.left,i.padding.top)),a.transition(this.transition("group1")).attr("transform",this.translate(i.margin.left,i.margin.top));var d=a.selectAll(".geometry").data(l),f=this.choropleth(l,i);this.center(t),d.enter().append("path").attr("class","geometry").attr("d",u).style("fill","none").style("stroke",this.modelProperty("stroke",r)).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(d).transition(this.transition("geometry")).attr("d",u).style("stroke",this.modelProperty("stroke",r)).style("fill",f).style("fill-opacity",r.fillOpacity),d.exit().remove()},createGeoPath:function(t){var e,n=this.getModel(),r=this.getGeoProjection(n.projection).scale(n.scale),i=this.$,o=i.geoPath().projection(r),a=this;if(this._geoPath=o,this.center(t),n.leaflet){var s="leaflet-"+n.uid,u=this.paper();this.visualParent.paper.append("div").attr("id",s),(e=new i.Map(s,{center:[37.8,-96.9],zoom:4}).addLayer(new i.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"))).getPanes().overlayPane.appendChild(u.element),r=i.transform({point:function(t,n){var r=e.latLngToLayerPoint(new i.LatLng(n,t));this.stream.point(r.x,r.y)}}),e.on("viewreset",function(){return a.update(t)})}return o},center:function(t){var e=this.getModel();if(e.boundGeometry){var n=this._geoPath,r=n.projection(),i=this.boundingBox(),o=t.topology.objects[e.boundGeometry],a=o?this.$.feature(t.topology,o).features:null;if(!a)return dn('Could not find *boundGeometry* "'+e.boundGeometry+'" for centering - skip centering geochart');r.scale(1).translate([0,0]);var s=n.bounds(a[0]),u=s[0],l=s[1],c=(l[0]-u[0])/i.innerWidth,d=(l[1]-u[1])/i.innerHeight,f=Math.round(e.boundScaleFactor/Math.max(c,d)),h=[(i.innerWidth-f*(l[0]+u[0]))/2,(i.innerHeight-f*(l[1]+u[1]))/2];r.scale(f).translate(h)}},choropleth:function(t,e){var n=this.getModel(),r=n.dataLabelKey,i=n.dataValueKey,o=void 0,a=void 0,u=void 0,l=void 0;return n.neighbors?(o=Qe("rank"),l=(a=s.extent(t,o))[1]+1):(o=function(t){return t.data[i]},l=Math.min(n.buckets,t.length),a=Tr(s.extent(t,o),l)),u=this.getScale(n.choroplethScale).range(this.colors(l).reverse()).domain(a),this.legend({type:"color",scale:u},e),function(t){return t.label=t.data[r]||t.id,t.value=o(t),t.color=u(t.value),t.color}}});var Hr=["K","M","G"].map(function(t,e){return{symbol:t,size:1<<10*(e+1)}}).reverse(),Ir={props:["url"],render:function(t,e,n){var r=this,i=this,o=this.select(n).html();return Dt.require("marked").then(function(e){if(t.url)return r.fetchText(t.url).then(function(t){return t=e(t),i.viewElement('<div class="doc">'+t+"</div>")});var n=e(o);return i.viewElement('<div class="doc">'+n+"</div>")})}},Br=u.timeFormat("%d %b %Y, %H:%M"),Vr=["system","arch","processor","cpus","python"],Gr={model:function(){return{info:[]}},render:function(){var t=this.model;return t.dataStore.onData("benchmarks.info",function(e){t.info=function(t){var e=new Date(t.date),n=[{label:"date",value:Br(e)}];return Vr.forEach(function(e){n.push({label:e,value:t[e]})}),n}(e.data[0])}),this.viewElement('<div class="card">\n<dic class="card-body">\n<dl class="row" d3-for="entry in info">\n    <dt class="col-sm-4" d3-html="entry.label"></dt>\n    <dd class="col-sm-8" d3-html="entry.value"></dd>\n</dl>\n</div>\n</div>')}};e.inBrowser&&window.development&&Dt.setDebug(!0),wr.set("redyellowblue",function(t){return t.scaleSequential(d.interpolateRdBu)}),e.assign(Sn.options.dataContext,{$binaryFormat:function(t){var e=c.format(t);return function(t){for(var n=0;n<Hr.length;++n)if(t>=Hr[n].size)return t/=Hr[n].size,e(t)+Hr[n].symbol+"B";return e(t)+"B"}}}),t.start=function(){Se(function(){Ct().mount("body")})},t.appView=Ct,Object.defineProperty(t,"__esModule",{value:!0})});