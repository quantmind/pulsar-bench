!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-let"),require("d3-view"),require("d3-collection"),require("d3-dsv"),require("d3-dispatch"),require("d3-array"),require("d3-time-format"),require("d3-transition"),require("d3-selection"),require("d3-format"),require("d3-scale-chromatic")):"function"==typeof define&&define.amd?define(["exports","d3-let","d3-view","d3-collection","d3-dsv","d3-dispatch","d3-array","d3-time-format","d3-transition","d3-selection","d3-format","d3-scale-chromatic"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,i,r,a,o,s,l,u,d,c){"use strict";function f(t,n){!e.isArray(t)&&arguments.length||(t={store:n,data:t||[],dimensions:{}}),Object.defineProperties(this,{_inner:{get:function(){return t}},store:{get:function(){return t.store}},data:{get:function(){return t.data}},dimensions:{get:function(){return t.dimensions}},type:{get:function(){return"dataframe"}}})}function h(t){var e=(t.headers.get("content-type")||"").split(";")[0];return ot.has(e)?t.text().then(r.csvParse):"text/tab-separated-values"===e?t.text().then(r.tsvParse):"application/json"===e?t.json():(rt("Cannot load content type '"+e+"'"),[])}function p(t){this.frames=i.map(),Object.defineProperties(this,{store:{get:function(){return t}},type:{get:function(){return"frameCollection"}}})}function g(t,e){return t.reduce(function(t,n){return void 0!==e(n)&&(t+=1),t},0)}function m(t,n,i){if(e.isArray(i)?t=t.new(i):i&&(t=i),n.length){var r=n.splice(0,1)[0],a=r?r(t):null;return e.isPromise(a)?a.then(function(e){return m(t,n,e)}):m(t,n,a)}return t}function v(t){var r=i.map();Object.defineProperties(this,{sources:{get:function(){return r}}}),this.transforms=e.assign({},zt),this.dataCount=0,this.model=t&&e.isFunction(t.$child)?t:n.viewModel(t)}function y(t,e){return"string"==typeof t&&t.indexOf("%")===t.length-1?_t(.01*parseFloat(t)*e):+t}function x(t,e){var n={width:e.width,height:e.height};return n.width||(n.width=function(t){var e=b(t,"width");if(e)return function(t){var e=t.getBoundingClientRect().width,n=u.select(t),i=w(n.style("padding-left")),r=w(n.style("padding-right"));return e-i-r}(e)}(t),n.width?n.widthElement=function(t){return b(t,"width")}(t):n.width=Ot),n.height||(n.height=function(t){var e=b(t,"width");if(e)return function(t){var e=t.getBoundingClientRect().height,n=u.select(t),i=w(n.style("padding-top")),r=w(n.style("padding-bottom"));return e-i-r}(e)}(t),n.height?n.heightElement=function(t){return b(t,"height")}(t):n.height=Pt),n.height=xt(y(n.height,n.width),void 0,window.innerHeight),n}function b(t,e){for(var n=t.node?t.node():t;n&&"BODY"!==n.tagName;){if(n.getBoundingClientRect()[e])return n;n=n.parentNode}}function w(t){return t&&"px"==t.substring(t.length-2)?+t.substring(0,t.length-2):0}function k(t){if(e.isArray(t))return t.map(k);if(e.isObject(t)){var n={};for(var i in t)n[i]=k(t[i]);return n}return t}function z(t){var e={},n=void 0,i=void 0,r=void 0;for(r in t)(i=t[r]).$ref&&(i=function(t){var e=t.split("/");return Tt.schema.definitions[e[e.length-1]]||{}}(i.$ref)),n=i.default,e[r]=void 0===n?null:n;return e}function M(){var t=this.__visual__;t?(t.destroy(),n.viewDebug('Removed "'+t.toString()+'" from DOM, '+Tt.live.length+" live visuals left")):ht("d3-visual without __visual__ object")}function S(t,i){function r(e,n){var i=this.initialise(e,n);Object.defineProperties(this,{element:{get:function(){return i}},sel:{get:function(){return this.select(i)}},paperType:{get:function(){return t}}})}return r.prototype=e.assign({},n.viewBase,Ft,i),Tt.papers[t]=r,r}function A(t,n){var i=n.options[t];void 0===i||e.isObject(i)||(n.options[t]=E(i||0))}function _(t,e,n){return Xt.reduce(function(i,r){return i[r]=y(t[r],Vt.indexOf(r)>-1?e:n),i},{})}function O(t){delete t.__boundingBox,e.isArray(t.layers)&&t.layers.forEach(O)}function P(){return{width:this.innerWidth,height:this.innerHeight,margin:E(0),padding:E(0),total:E(0),innerWidth:this.innerWidth,innerHeight:this.innerHeight,$nomargins:this.$nomargins}}function E(t){return{left:t,right:t,top:t,bottom:t}}function T(t,e,n){t.select("path.domain").attr("stroke",e.stroke);var i=t.selectAll("text").attr("fill",e.stroke);if(e.hide){var r=n.range();Math.abs(r[0]-r[r.length-1])<e.hide?t.style("opacity",0):t.style("opacity",1)}e.rotate&&i.attr("transform","rotate("+e.rotate+")").style("text-anchor",e.ancor)}function W(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function C(){}function j(t){var e;return t=(t+"").trim().toLowerCase(),(e=Zt.exec(t))?(e=parseInt(e[1],16),new F(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1)):(e=Jt.exec(t))?q(parseInt(e[1],16)):(e=Qt.exec(t))?new F(e[1],e[2],e[3],1):(e=te.exec(t))?new F(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=ee.exec(t))?$(e[1],e[2],e[3],e[4]):(e=ne.exec(t))?$(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=ie.exec(t))?H(e[1],e[2]/100,e[3]/100,1):(e=re.exec(t))?H(e[1],e[2]/100,e[3]/100,e[4]):ae.hasOwnProperty(t)?q(ae[t]):"transparent"===t?new F(NaN,NaN,NaN,0):null}function q(t){return new F(t>>16&255,t>>8&255,255&t,1)}function $(t,e,n,i){return i<=0&&(t=e=n=NaN),new F(t,e,n,i)}function D(t){return t instanceof C||(t=j(t)),t?(t=t.rgb(),new F(t.r,t.g,t.b,t.opacity)):new F}function F(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function H(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new R(t,e,n,i)}function R(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function Y(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function N(t){if(t instanceof B)return new B(t.l,t.a,t.b,t.opacity);if(t instanceof I){var e=t.h*oe;return new B(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof F||(t=D(t));var n=G(t.r),i=G(t.g),r=G(t.b),a=X((.4124564*n+.3575761*i+.1804375*r)/le),o=X((.2126729*n+.7151522*i+.072175*r)/ue);return new B(116*o-16,500*(a-o),200*(o-X((.0193339*n+.119192*i+.9503041*r)/de)),t.opacity)}function B(t,e,n,i){this.l=+t,this.a=+e,this.b=+n,this.opacity=+i}function X(t){return t>pe?Math.pow(t,1/3):t/he+ce}function V(t){return t>fe?t*t*t:he*(t-ce)}function L(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function G(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function I(t,e,n,i){this.h=+t,this.c=+e,this.l=+n,this.opacity=+i}function U(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function K(t){this.vertical=!0,this.init(t),this.sx.rangeRound([0,this.box.innerWidth]),this.sy.rangeRound([this.box.innerHeight,0])}function Z(t){this.init(t),this.sx.rangeRound([0,this.box.innerHeight]),this.sy.rangeRound([0,this.box.innerWidth])}function J(t,e,n,i){this.data=t,this.stacked=i,this.x=e,this.y=n}function Q(){var t=n.view({components:{marked:Ge,info:Ke}}).use(n.viewForms).use(n.viewBootstrapForms).use(Ce);return n.viewEvents.on("component-mounted",function(t){"d3form"===t.name&&t.model.$on(function(){})}),t}var tt="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},et=function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t,e){!function(t){function e(t){return t}function n(t,e){for(var n=0,i=e.length,r=new Array(i);n<i;++n)r[n]=t[e[n]];return r}function i(t){function e(e,n,i,r){for(;i<r;){var a=i+r>>>1;n<t(e[a])?r=a:i=a+1}return i}return e.right=e,e.left=function(e,n,i,r){for(;i<r;){var a=i+r>>>1;t(e[a])<n?i=a+1:r=a}return i},e}function r(t){function e(t,e,i){for(var r=i-e,a=1+(r>>>1);--a>0;)n(t,a,r,e);return t}function n(e,n,i,r){for(var a,o=e[--r+n],s=t(o);(a=n<<1)<=i&&(a<i&&t(e[r+a])>t(e[r+a+1])&&a++,!(s<=t(e[r+a])));)e[r+n]=e[r+a],n=a;e[r+n]=o}return e.sort=function(t,e,i){for(var r,a=i-e;--a>0;)r=t[e],t[e]=t[e+a],t[e+a]=r,n(t,1,a,e);return t},e}function a(t){var e=r(t);return function(n,i,r,a){var o,s,l,u=new Array(a=Math.min(r-i,a));for(s=0;s<a;++s)u[s]=n[i++];if(e(u,0,a),i<r){o=t(u[0]);do{t(l=n[i])>o&&(u[0]=l,o=t(e(u,0,a)[0]))}while(++i<r)}return u}}function o(t){return function(e,n,i){for(var r=n+1;r<i;++r){for(var a=r,o=e[r],s=t(o);a>n&&t(e[a-1])>s;--a)e[a]=e[a-1];e[a]=o}return e}}function s(t){function e(i,r,a){return(a-r<b?n:function(n,i,r){var a,o=(r-i)/6|0,s=i+o,l=r-1-o,u=i+r-1>>1,d=u-o,c=u+o,f=n[s],h=t(f),p=n[d],g=t(p),m=n[u],v=t(m),y=n[c],x=t(y),b=n[l],w=t(b);h>g&&(a=f,f=p,p=a,a=h,h=g,g=a);x>w&&(a=y,y=b,b=a,a=x,x=w,w=a);h>v&&(a=f,f=m,m=a,a=h,h=v,v=a);g>v&&(a=p,p=m,m=a,a=g,g=v,v=a);h>x&&(a=f,f=y,y=a,a=h,h=x,x=a);v>x&&(a=m,m=y,y=a,a=v,v=x,x=a);g>w&&(a=p,p=b,b=a,a=g,g=w,w=a);g>v&&(a=p,p=m,m=a,a=g,g=v,v=a);x>w&&(a=y,y=b,b=a,a=x,x=w,w=a);var k=p,z=g,M=y,S=x;n[s]=f,n[d]=n[i],n[u]=m,n[c]=n[r-1],n[l]=b;var A=i+1,_=r-2,O=z<=S&&z>=S;if(O)for(E=A;E<=_;++E){T=n[E];if((W=t(T))<z)E!==A&&(n[E]=n[A],n[A]=T),++A;else if(W>z)for(;;){if(!((C=t(n[_]))>z)){if(C<z){n[E]=n[A],n[A++]=n[_],n[_--]=T;break}n[E]=n[_],n[_--]=T;break}_--}}else for(E=A;E<=_;E++){T=n[E];if((W=t(T))<z)E!==A&&(n[E]=n[A],n[A]=T),++A;else if(W>S)for(;;){if(!((C=t(n[_]))>S)){C<z?(n[E]=n[A],n[A++]=n[_],n[_--]=T):(n[E]=n[_],n[_--]=T);break}if(--_<E)break}}if(n[i]=n[A-1],n[A-1]=k,n[r-1]=n[_+1],n[_+1]=M,e(n,i,A-1),e(n,_+2,r),O)return n;if(A<s&&_>l){for(var P;(P=t(n[A]))<=z&&P>=z;)++A;for(;(C=t(n[_]))<=S&&C>=S;)--_;for(var E=A;E<=_;E++){var T=n[E],W=t(T);if(W<=z&&W>=z)E!==A&&(n[E]=n[A],n[A]=T),A++;else if(W<=S&&W>=S)for(;;){var C;if(!((C=t(n[_]))<=S&&C>=S)){C<z?(n[E]=n[A],n[A++]=n[_],n[_--]=T):(n[E]=n[_],n[_--]=T);break}if(--_<E)break}}}return e(n,A,_+1)})(i,r,a)}var n=o(t);return e}function l(t){for(var e=new Array(t),n=-1;++n<t;)e[n]=0;return e}function u(t){return[0,t.length]}function d(){return null}function c(){return 0}function f(t){return t+1}function h(t){return t-1}function p(t){return function(e,n){return e+ +t(n)}}function g(t){return function(e,n){return e-t(n)}}function m(){function t(t){var e=l,n=t.length;return n&&(o=o.concat(t),k=M(k,l+=n),A.forEach(function(i){i(t,e,n)})),i}var i={add:t,remove:function(){for(var t=v(l,l),e=[],n=0,i=0;n<l;++n)k[n]?t[n]=i++:e.push(n);z.forEach(function(t){t(0,[],e)}),_.forEach(function(e){e(t)});for(var r,n=0,i=0;n<l;++n)(r=k[n])&&(n!==i&&(k[i]=r,o[i]=o[n]),++i);for(o.length=i;l>i;)k[--l]=0},dimension:function(t){function i(e,i,r){H=e.map(t),R=V(function(t){for(var e=v(t,t),n=-1;++n<t;)e[n]=n;return e}(r),0,r),H=n(H,R);var a,o=L(H),s=o[0],u=o[1];if(Y)for(a=0;a<r;++a)Y(H[a],a)||(k[R[a]+i]|=B);else{for(a=0;a<s;++a)k[R[a]+i]|=B;for(a=u;a<r;++a)k[R[a]+i]|=B}if(!i)return D=H,F=R,U=s,void(K=u);var d=D,c=F,f=0,h=0;for(D=new Array(l),F=v(l,l),a=0;f<i&&h<r;++a)d[f]<H[h]?(D[a]=d[f],F[a]=c[f++]):(D[a]=H[h],F[a]=R[h++]+i);for(;f<i;++f,++a)D[a]=d[f],F[a]=c[f];for(;h<r;++h,++a)D[a]=H[h],F[a]=R[h]+i;o=L(D),U=o[0],K=o[1]}function w(t,e,n){G.forEach(function(t){t(H,R,e,n)}),H=R=null}function O(t){for(var e,n=0,i=0;n<l;++n)k[e=F[n]]&&(n!==i&&(D[i]=D[n]),F[i]=t[e],++i);for(D.length=i;i<l;)F[i++]=0;var r=L(D);U=r[0],K=r[1]}function P(t){var e=t[0],n=t[1];if(Y)return Y=null,j(function(t,i){return e<=i&&i<n}),U=e,K=n,N;var i,r,a,o=[],s=[];if(e<U)for(i=e,r=Math.min(U,n);i<r;++i)k[a=F[i]]^=B,o.push(a);else if(e>U)for(i=U,r=Math.min(e,K);i<r;++i)k[a=F[i]]^=B,s.push(a);if(n>K)for(i=Math.max(e,K),r=n;i<r;++i)k[a=F[i]]^=B,o.push(a);else if(n<K)for(i=Math.max(U,n),r=K;i<r;++i)k[a=F[i]]^=B,s.push(a);return U=e,K=n,z.forEach(function(t){t(B,o,s)}),N}function E(t){return P((L=function(t,e){return function(n){var i=n.length;return[t.left(n,e,0,i),t.right(n,e,0,i)]}}(x,t))(D))}function T(t){return P((L=function(t,e){var n=e[0],i=e[1];return function(e){var r=e.length;return[t.left(e,n,0,r),t.left(e,i,0,r)]}}(x,t))(D))}function W(){return P((L=u)(D))}function C(t){return L=u,j(Y=t),U=0,K=l,N}function j(t){var e,n,i,r=[],a=[];for(e=0;e<l;++e)!(k[n=F[e]]&B)^!!(i=t(D[e],e))&&(i?(k[n]&=X,r.push(n)):(k[n]|=B,a.push(n)));z.forEach(function(t){t(B,r,a)})}function q(t){function n(e,n,i,r){function a(){++N===Y&&(A=S(A,R<<=1),W=S(W,R),Y=y(R))}var c,f,h,p,g,b,w=T,A=v(N,Y),_=q,O=H,P=N,E=0,C=0;for(U&&(_=O=d),T=new Array(N),N=0,W=P>1?M(W,l):v(l,Y),P&&(h=(f=w[0]).key);C<r&&!((p=t(e[C]))>=p);)++C;for(;C<r;){for(f&&h<=p?(g=f,b=h,A[E]=N,(f=w[++E])&&(h=f.key)):(g={key:p,value:O()},b=p),T[N]=g;!(p>b||(W[c=n[C]+i]=N,k[c]&X||(g.value=_(g.value,o[c])),++C>=r));)p=t(e[C]);a()}for(;E<P;)T[A[E]=N]=w[E++],a();if(N>E)for(E=0;E<i;++E)W[E]=A[W[E]];c=z.indexOf(V),N>1?(V=s,L=m):(!N&&K&&(N=1,T=[{key:null,value:O()}]),1===N?(V=u,L=x):(V=d,L=d),W=null),z[c]=V}function i(){if(N>1){for(var t=N,e=T,n=v(t,t),i=0,r=0;i<l;++i)k[i]&&(n[W[r]=W[i]]=1,++r);for(T=[],N=0,i=0;i<t;++i)n[i]&&(n[i]=N++,T.push(e[i]));if(N>1)for(i=0;i<r;++i)W[i]=n[W[i]];else W=null;z[z.indexOf(V)]=N>1?(L=m,V=s):1===N?(L=x,V=u):L=V=d}else if(1===N){if(K)return;for(i=0;i<l;++i)if(k[i])return;T=[],N=0,z[z.indexOf(V)]=V=L=d}}function s(t,e,n){if(t!==B&&!U){var i,r,a,s;for(i=0,a=e.length;i<a;++i)k[r=e[i]]&X||((s=T[W[r]]).value=q(s.value,o[r]));for(i=0,a=n.length;i<a;++i)(k[r=n[i]]&X)===t&&((s=T[W[r]]).value=$(s.value,o[r]))}}function u(t,e,n){if(t!==B&&!U){var i,r,a,s=T[0];for(i=0,a=e.length;i<a;++i)k[r=e[i]]&X||(s.value=q(s.value,o[r]));for(i=0,a=n.length;i<a;++i)(k[r=n[i]]&X)===t&&(s.value=$(s.value,o[r]))}}function m(){var t,e;for(t=0;t<N;++t)T[t].value=H();for(t=0;t<l;++t)k[t]&X||((e=T[W[t]]).value=q(e.value,o[t]))}function x(){var t,e=T[0];for(e.value=H(),t=0;t<l;++t)k[t]&X||(e.value=q(e.value,o[t]))}function b(){return U&&(L(),U=!1),T}function w(t,e,n){return q=t,$=e,H=n,U=!0,E}function A(){return w(f,h,c)}function O(t){function e(e){return t(e.value)}return C=a(e),j=r(e),E}function P(){var t=z.indexOf(V);return t>=0&&z.splice(t,1),(t=G.indexOf(n))>=0&&G.splice(t,1),(t=_.indexOf(i))>=0&&_.splice(t,1),E}var E={top:function(t){var e=C(b(),0,T.length,t);return j.sort(e,0,e.length)},all:b,reduce:w,reduceCount:A,reduceSum:function(t){return w(p(t),g(t),c)},order:O,orderNatural:function(){return O(e)},size:function(){return N},dispose:P,remove:P};I.push(E);var T,W,C,j,q,$,H,R=8,Y=y(R),N=0,V=d,L=d,U=!0,K=t===d;return arguments.length<1&&(t=e),z.push(V),G.push(n),_.push(i),n(D,F,0,l),A().orderNatural()}function $(){I.forEach(function(t){t.dispose()});var t=A.indexOf(i);return t>=0&&A.splice(t,1),(t=A.indexOf(w))>=0&&A.splice(t,1),(t=_.indexOf(O))>=0&&_.splice(t,1),m&=X,W()}var D,F,H,R,Y,N={filter:function(t){return null==t?W():Array.isArray(t)?T(t):"function"==typeof t?C(t):E(t)},filterExact:E,filterRange:T,filterFunction:C,filterAll:W,top:function(t){for(var e,n=[],i=K;--i>=U&&t>0;)k[e=F[i]]||(n.push(o[e]),--t);return n},bottom:function(t){for(var e,n=[],i=U;i<K&&t>0;)k[e=F[i]]||(n.push(o[e]),--t),i++;return n},group:q,groupAll:function(){var t=q(d),e=t.all;return delete t.all,delete t.top,delete t.order,delete t.orderNatural,delete t.size,t.value=function(){return e()[0].value},t},dispose:$,remove:$},B=~m&-~m,X=~B,V=s(function(t){return H[t]}),L=u,G=[],I=[],U=0,K=0;return A.unshift(i),A.push(w),_.push(O),m|=B,(b>=32?!B:m&-(1<<b))&&(k=S(k,b<<=1)),i(o,0,l),w(0,0,l),N},groupAll:function(){function t(t,e){var n;if(!v)for(n=e;n<l;++n)k[n]||(a=s(a,o[n]))}function e(t,e,n){var i,r,l;if(!v){for(i=0,l=e.length;i<l;++i)k[r=e[i]]||(a=s(a,o[r]));for(i=0,l=n.length;i<l;++i)k[r=n[i]]===t&&(a=u(a,o[r]))}}function n(t,e,n){return s=t,u=e,d=n,v=!0,m}function i(){return n(f,h,c)}function r(){var n=z.indexOf(e);return n>=0&&z.splice(n),(n=A.indexOf(t))>=0&&A.splice(n),m}var a,s,u,d,m={reduce:n,reduceCount:i,reduceSum:function(t){return n(p(t),g(t),c)},value:function(){return v&&(function(){var t;for(a=d(),t=0;t<l;++t)k[t]||(a=s(a,o[t]))}(),v=!1),a},dispose:r,remove:r},v=!0;return z.push(e),A.push(t),t(0,0),i()},size:function(){return l}},o=[],l=0,m=0,b=8,k=w(0),z=[],A=[],_=[];return arguments.length?t(arguments[0]):i}function v(t,e){return(e<257?w:e<65537?k:z)(t)}function y(t){return 8===t?256:16===t?65536:4294967296}m.version="1.3.12",m.permute=n;var x=m.bisect=i(e);x.by=i;(m.heap=r(e)).by=r;(m.heapselect=a(e)).by=a;(m.insertionsort=o(e)).by=o;(m.quicksort=s(e)).by=s;var b=32,w=l,k=l,z=l,M=function(t,e){for(var n=t.length;n<e;)t[n++]=0;return t},S=function(t,e){if(e>32)throw new Error("invalid array width!");return t};"undefined"!=typeof Uint8Array&&(w=function(t){return new Uint8Array(t)},k=function(t){return new Uint16Array(t)},z=function(t){return new Uint32Array(t)},M=function(t,e){if(t.length>=e)return t;var n=new t.constructor(e);return n.set(t),n},S=function(t,e){var n;switch(e){case 16:n=k(t.length);break;case 32:n=z(t.length);break;default:throw new Error("invalid array width!")}return n.set(t),n}),t.crossfilter=m}(e||tt)}).crossfilter,nt=function(t){return function(e){return e[t]}};f.prototype={constructor:f,dataFrame:function(){return this},size:function(){return this.data.length},new:function(t){return e.isArray(t)?new f(t,null,this.store):new f(this._inner,t)},cf:function(){return this._inner.cf||(this._inner.cf=et(this.data)),this._inner.cf},dimension:function(t,e,n){1===arguments.length&&(n=!0);var i=this.dimensions[t];if(i){if(n)return i;i.dispose()}return e||(e=nt(t)),this.dimensions[t]=this.cf().dimension(e),this.dimensions[t]},sortby:function(t,e){return this.new(this.dimension(t).top(e||1/0))},pivot:function(t,e,n,i){function r(r){var a=void 0,o=void 0;return function(s,l){return a=""+l[e],o=r*l[n],s[t]=l[t],a in s?s[a]+=o:s[a]=o,i in s?s[i]+=o:s[i]=o,s}}var a=this.dimension(t).group();return i||(i="total"),this.new(a.reduce(r(1),r(-1),Object).all().map(function(t){return t.value}))},add:function(){},map:function(t){return this.new(this.data.map(t))}};var it={schema:{type:"object",description:"array of data",properties:{data:{type:"array",description:"array of data"}}},initialise:function(t){this._data=t.data},getConfig:function(t){return e.isArray(t)?{data:t}:e.isObject(t)&&e.isArray(t.data)?t:void 0},getData:function(){return this.asFrame(this._data)}},rt=function(t){n.viewProviders.logger.warn("[d3-data-source] "+t)},at=["http","https","ws","wss"],ot=i.set(["text/plain","text/csv","application/vnd.ms-excel"]),st={schema:{type:"object",description:"Remote data resource",properties:{url:{type:"string",description:"url for fetching data"}}},getConfig:function(t){return function(t){return e.isString(t)&&at.indexOf(t.split("://")[0])>-1}(t)?{url:t}:e.isObject(t)&&t.url?t:void 0},initialise:function(t){this.url=t.url},getData:function(){var t=n.viewProviders.fetch,e=this;return t?t(this.url).then(h).then(function(t){return e.asFrame(t)}):(rt("fetch provider not available, cannot submit"),[])}},lt={schema:{type:"object",description:"Composite data source for combining data together",properties:{source:{type:"array",description:"Array of data sources keys",item:{type:"string"}},expression:{type:"string",description:"expression to evaluate, must return a data frame or a Promise"}}},initialise:function(t){this.source=t.source,this.expression=t.expression?n.viewExpression(t.expression):null},getConfig:function(t){if(e.isObject(t)&&t.source)return e.isArray(t.source)||(t.source=[t.source]),t},getData:function(t){var n=this.store,i=this.source,r=this.expression,a=this;return Promise.all(i.map(function(e){return n.getData(e,t)})).then(function(o){var s=void 0;if(1===o.length?s=o[0]:a.config.merge?s=a.mergeFrames(o):(s=new p(n),o.forEach(function(t,e){s.frames.set(i[e],t)})),r){var l=n.model.$child(e.assign({},t,{frame:s}));s=r.eval(l)}return e.isPromise(s)?s.then(function(t){return a.asFrame(t)}):a.asFrame(s)})},mergeFrames:function(t){return t[0]}};p.prototype={new:function(t){return new f(t,this.store)},dataFrame:function(){for(var t=this.frames.values(),e=0;e<t.length;++e)if("dataframe"===t[e].type)return t[e]}};var ut={schema:{type:"object",description:"Expression to evaluate by the data store",properties:{expression:{type:"string",description:"expression to evaluate, must return a data frame or a Promise"}}},initialise:function(t){this.expression=n.viewExpression(t.expression)},getConfig:function(t){if(e.isObject(t)&&t.expression)return t},getData:function(t){var n=this,i=this.store.model.$child(t),r=this.expression.eval(i);return e.isPromise(r)?r.then(function(t){return n.asFrame(t)}):n.asFrame(r)}},dt=function(t){function e(t){return a.validate(t)?function(e){return i(e,t)}:a.logError()}var i=t.transform,r=t.schema||{},a=n.viewProviders.jsonValidator?n.viewProviders.jsonValidator(t.schema):ct;return r.type||(r.type="object"),e.schema=r,e},ct={validate:function(){return!0}},ft=dt({schema:{description:"The filter transform removes objects from a data frame based on a provided filter expression",properties:{expr:{type:"string"}},required:["expr"]},transform:function(t,e){var i=n.viewExpression(e.expr);return t.data.reduce(function(e,n,r){return i.safeEval({d:n,index:r,frame:t})&&e.push(n),e},[])}}),ht=function(t,e){n.viewProviders.logger.warn("[d3-visualize] "+t),e&&n.viewProviders.logger.error(e.stack)},pt=i.map({count:g,max:o.max,min:o.min,sum:o.sum,mean:o.mean,median:o.median,variance:o.variance,deviation:o.deviation}),gt=i.map({count:function(t){return t+1},sum:function(t,e){return t+e},max:Math.max,min:Math.min}),mt={dataSource:null,size:{width:null,height:"70%"}};mt.dateFormat="%d-%b-%y";var vt={date:function(t){return s.utcParse(t.dateFormat||mt.dateFormat)},number:function(){return parseFloat}},yt=dt({shema:{description:"map a field values into another type",properties:{fields:{type:"object"},dateFormat:{type:"string"}},required:["fields"]},transform:function(t,n){var r=[],a=void 0,o=void 0;return i.map(n.fields).each(function(t,n){e.isString(t)&&(t={type:t}),(o=vt[t.type])?r.push([n,o(t)]):ht("Cannot convert field "+n+" to type "+t.type)}),r.length&&(t=t.map(function(t){for(a=0;a<r.length;++a)t[r[a][0]]=r[a][1](t[r[a][0]]);return t})),t}}),xt=function(t,e,n){return void 0!==n&&(t=Math.min(t,n)),void 0===e?t:Math.max(t,e)},bt=dt({shema:{description:"Create moving average series from existing one. The new series override the existing one unless the as array is provided",properties:{method:{type:"string"},alpha:{type:"number"},period:{type:"number"},fields:{type:"array",items:{type:"string"}},as:{type:"array",items:{type:"string"}}},required:["fields"]},transform:function(t,e){var n=e.as||[],i=e.method||"ema",r=void 0,a=void 0,o=void 0;e.fields.forEach(function(s,l){if(r=n[l]||s,"sma"===i){var u=Math.max(e.period||10,1),d=[],c=[];t.data.forEach(function(t,e){a=t[s],d.length===u&&(a-=c.splice(0,1)[0]),c.push(a),e&&(a+=d[d.length-1]),d.push(a),t[r]=a/d.length})}else{var f=xt(e.alpha||.5,1-.999999,.999999);t.data.forEach(function(t,e){a=t[s],o=e?f*o+(1-f)*a:a,t[r]=o})}})}}),wt=dt({schema:{description:"Group entries which are below a given aggregate cutoff",properties:{field:{type:"string"},cutoff:{type:"number"}},required:["field","cutoff"]},transform:function(t,e){var n=nt(e.field),i=o.sum(t.data,n),r=[],a=0;return t.dimension(e.field).bottom(1/0).reduce(function(t,o){return(a+=n(o))/i<e.cutoff?r.push(o):r?(r.push(o),(o={label:"other",children:r})[e.field]=a,r=null,t.push(o)):t.push(o),t},[])}}),kt=dt({schema:{description:"Perfrom a difference for a group of fields along a dimension. It is possible to perform a difference for different groups",properties:{dimension:{type:"string"},period:{type:"integer",minimum:1},fields:{type:"array",items:{type:"string"}},as:{type:"array",items:{type:"string"}},groupby:{type:"string"}},required:["dimension","fields"]},transform:function(t,n){function i(t){var i=t.dimension(n.dimension),s=n.fields.reduce(function(t,e){return t[e]=0,t},{}),l=[],u=void 0,d=void 0;i.top(1/0).forEach(function(t,i){u=e.assign({},t),l.push(t),d=i>a?l.splice(0,1)[0]:s,n.fields.forEach(function(e,n){t[r[n]||e]=t[e]-d[e]}),o.push(u)})}var r=n.as||[],a=n.period||1,o=[];if(n.groupby){var s=t.dimension(n.groupby);s.group().all().forEach(function(e){return i(t.new(s.filterAll().filter(e.key).top(1/0)))})}else i(t.new());return o}}),zt=e.assign(i.map({filter:ft,aggregate:function(t){var n=t.fields,i=t.ops,r=t.as,a=t.groupby;return n||i?e.isArray(n)?(i||(i="count"),e.isString(i)&&(i=function(t,e){var n=new Array(t);return n.fill(e),n}(n.length,i)),e.isArray(i)?(i.length<n.length&&ht("Aggregate transforms expects an ops array with same length as fields"),r||(r=[]),e.isArray(r)?function(t){var e,o,s=[];return a?function(t){var e=void 0,o=void 0,s=void 0,l=n.map(function(t,e){return o=i[e],s=gt.get("count"),o&&((s=gt.get(o))||(s=gt.get("count"),ht("Operation "+o+" is not supported, use count"))),{field:t,as:r[e]||t,op:s}});return t.dimension(a).group().reduce(function(t,n){return l.reduce(function(t,i){return e=0,i.as in t&&(e=t[i.as]),t[i.as]=i.op(e,n[i.field]),t},t)},null,Object).all().map(function(t){return t.value[a]=t.key,t.value})}(t):(n.forEach(function(n,a){e=i[a],o=g,e&&((o=pt.get(e))||(o=g,ht("Operation "+i[a]+" is not supported, use count"))),s.push({label:r[a]||n,data:o(t.data,function(t){return t[n]})})}),s)}:ht("Aggregate transform expects an array of as fields")):ht("Aggregate transform expects an array of ops")):ht("Aggregate transforms expect an array of fields"):function(t){var e=void 0;return t.data.reduce(function(t,n){for(e in n)e in t?t[e]+=1:t[e]=1;return t},{})}},mapfields:yt,timeseries:function(t){var e=t.sortby,n=t.groupby;return e||ht('timeseries transform requires a "sortby" entry'),function(t){if(e){if(n){var i,r=t.dimension(n),a=r.group().top(1/0),o=t.new([]);return a.forEach(function(n){i=t.new(r.filterExact(n.key).top(1/0)).dimension(e).group().top(1/0),o.series.set(n.key,t.new(i).dimension("key").top(1/0))}),o}return t.new(t.dimension(e).top(1/0))}return t}},crossfilter:function(t){var n=t.fields,i=t.query;return e.isArray(n)?e.isArray(i)?i.length!=n.length?ht("crossfilter transform expects an query array with same length as fields"):function(t){var r=void 0,a=void 0;return n.forEach(function(n,o){a=i[o],e.isString(a)&&(a=t.store.eval(a)),r=t.dimension(n).filterAll(),a&&r.filter(a)}),r?t.new(r.top(1/0)):t}:ht("crossfilter transform expects an array of query"):ht("crossfilter transform expects an array of fields")},movingaverage:bt,groupsmall:wt,diff:kt}),{add:function(t,e){this.set(t,dt(e))}}),Mt=a.dispatch("init","data"),St={schema:{properties:{}},getConfig:function(){},initialise:function(){},getData:function(){},addTransforms:function(t){var n=this,i=void 0;t&&(e.isArray(t)||(t=[t]),t.forEach(function(t){(i=zt.get(t.type))?n.transforms.push(i(t)):ht('Transform type "'+t.type+'" not known')}))},asFrame:function(t){return t&&!e.isArray(t)&&t.constructor!==f&&(t=[t]),e.isArray(t)&&(t=new f(t=t.map(function(t){return t.constructor!==Object&&(t={data:t}),t}),this.store)),function(t,e){return e?m(t,e.slice()):t}(t,this.transforms)}},At=e.assign(i.map(),{events:Mt,add:function(t,n){function i(n,i){!function(t,n,i,r){var a=r.dataName(e.pop(i,"name")),o=[];Object.defineProperties(t,{name:{get:function(){return a}},store:{get:function(){return r}},type:{get:function(){return n}},transforms:{get:function(){return o}},config:{get:function(){return i}}}),t.initialise(i),t.addTransforms(e.pop(i,"transforms")),r.sources.set(a,t),Mt.call("init",void 0,t)}(this,t,n,i)}return i.prototype=e.assign({},St,n),i.prototype.constructor=i,this.set(t,i),i},create:function(t,e){for(var n,i=this.values(),r=0;r<i.length;++r)if(n=i[r].prototype.getConfig(t))return new i[r](n,e)}});At.add("array",it),At.add("remote",st),At.add("composite",lt),At.add("expression",ut),v.prototype={size:function(){return this.sources.size()},addSources:function(t){if(e.isString(t)&&(t={source:t}),e.isArray(t)){var n=this;return t.map(function(t){return At.create(t,n)})}if(t)return At.create(t,this)},addTransforms:function(t){e.assign(this.transforms,t)},source:function(t,e){if(1===arguments.length)return this.sources.get(t);if(null===e){var n=this.sources.get(t);return this.sources.remove(t),n}return this.sources.set(t,e),this},clearCache:function(){this.sources.each(function(t){delete t.cachedFrame})},getData:function(t,n){var i=this.sources.get(t);if(!i)throw new Error("Data source "+t+" not available");if(i.cachedFrame)return Promise.resolve(i.cachedFrame);var r=i.getData(n);return e.isPromise(r)||(r=Promise.resolve(r)),r.then(function(t){return i.config.cache&&(i.cachedFrame=t),t})},eval:function(t,e){var i=this.model.$child(e);return i.dataStore=this,n.viewExpression(t).safeEval(i)},dataName:function(t){if(this.dataCount++,t)return""+t;return this.source("default")?"source"+this.dataCount:"default"}};var _t=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},Ot=400,Pt="75%",Et=["visual","container"],Tt={live:[],types:{},papers:{},options:mt,schema:{title:"Visualize Specification Language",type:"object",definitions:{size:{oneOf:[{type:"number",description:"size in pixels",minimum:0},{type:"string",description:"Size as a percentage"}]}}},events:a.dispatch("before-init","after-init","resize","before-draw","after-draw")},Wt={initialise:function(){},draw:function(){},redraw:function(t){if(this.drawing){var e=this,n="after-draw."+this.toString();Tt.events.on(n,function(){Tt.events.on(n,null),e.redraw(t)})}else this.drawing=this.draw(t);return this.drawing},destroy:function(){},toString:function(){return this.visualType+"-"+this.model.uid},getModel:function(t){t||(t=this.visualType);var n=this.model[t];if(!n&&t in mt){var i=e.pop(this.options,t),r=this;this.visualParent?n=this.visualParent.getModel(t).$child(i):(n=this.model.$new(mt[t])).$update(i),this.model[t]=n,n.$on(function(){return r.redraw(!1)})}return n},idname:function(t){return t||(t=this.visualType),t+"-"+this.model.uid},modelProperty:function(t,e){var n=this.getModel()[t];return void 0===n?e[t]:n},dim:function(t,e,n,i){return xt(y(t,e),n,i)},pop:function(t){if(t){var e=t.live.indexOf(this);e>-1&&t.live.splice(e,1)}},getVisualSchema:function(t){var n=this.options.visuals?this.options.visuals[t]:null,i=this.visualParent;if(i&&e.isString(n)?(t=n,n=i.getVisualSchema(t)):i&&!n&&(n=i.getVisualSchema(t)),e.isObject(n))return k(n)}},Ct=function(t,i){function r(e,i,r,a){Object.defineProperties(this,{visualType:{get:function(){return t}},isViz:{get:function(){return-1===Et.indexOf(t)}},visualRoot:{get:function(){return this.visualParent?this.visualParent.visualRoot:this}}}),this.visualParent=r,this.model=r?r.model.$new():a||n.viewModel(),this.options=i||{},this.drawing=!1,Tt.events.call("before-init",void 0,this),this.initialise(e),Tt.events.call("after-init",void 0,this)}var a=e.pop(i,"schema");return a&&(Tt.options[t]=z(a),Tt.schema.definitions[t]={type:"object",properties:e.assign({data:{$ref:"#/definitions/data"}},a)}),r.prototype=e.assign({},n.viewBase,Wt,i),r.prototype.constructor=r,Tt.types[t]=r,r},jt=Ct("visual",{schema:{render:{type:"string",enum:["canvas","svg"],default:"svg"},width:{description:"Width of the visual",$refs:"#/definitions/size"},height:{description:"Height of the visual",$refs:"#/definitions/size",default:"70%"}},initialise:function(t){if(!t)throw new Error("HTMLElement required by visual group");if(this.visualParent&&"container"!==this.visualParent.visualType)throw new Error("Visual parent can be a container only");this.select(t).select(".paper").node()||this.select(t).append("div").classed("paper",!0),Object.defineProperties(this,{element:{get:function(){return t}},paperElement:{get:function(){return this.sel.select(".paper")}},sel:{get:function(){return this.select(t)}},size:{get:function(){return[this.width,this.height]}}}),this.sel.classed("d3-visual",!0),this.layers=[],this.drawCount=0,Tt.live.push(this),t.__visual__=this,this.visualParent&&this.visualParent.live.push(this)},activate:function(){this.layers.forEach(function(t){return t.activate()})},deactivate:function(){this.layers.forEach(function(t){return t.deactivate()})},getVisual:function(){return this},draw:function(t){if(this.drawing)return ht(this.toString()+" already drawing"),this.drawing;this.drawCount?(this.drawCount++,this.clear()):(this.drawCount=1,this.fit());var e=this;return Tt.events.call("before-draw",void 0,this),Promise.all(this.layers.map(function(e){return e.redraw(t)})).then(function(){delete e.drawing,Tt.events.call("after-draw",void 0,e)},function(t){delete e.drawing,ht("Could not draw "+e.toString()+": "+t,t)})},clear:function(){},addVisual:function(t){var n=e.pop(t,"type"),i=Tt.types[n];if(i)return new i(this.element,t,this);ht('Cannot add visual "'+n+'", not available')},fit:function(){return this.resize(null,!0),this},resize:function(t,e){t||(t=x(this.element.parentNode||this.element,this.getModel()));var i=this.size;return(e||i[0]!==t.width||i[1]!==t.height)&&(e||n.viewDebug('Resizing "'+this.toString()+'"'),this.width=t.width,this.height=t.height,this.paperElement.style("height",this.height+"px"),Tt.events.call("resize",void 0,this),e||this.draw(!1)),this},paper:function(){var t=this.__paper,e=this.getModel().render;if(t&&t.paperType===e)return t;var n=Tt.papers[e];if(!n)throw new Error("Unknown paper "+e);return t=new n(this),this.__paper=t,t},getPaperGroup:function(t){return this.paper().group(t)},destroy:function(){this.pop(this.visualParent),this.pop(Tt)}});if(e.inBrowser){new MutationObserver(function(t){t.forEach(function(t){var e=t.removedNodes;e&&e.length&&e.forEach(function(t){t.querySelectorAll&&(t.__visual__?M.call(t):u.select(t).selectAll(".d3-visual").each(M))})})}).observe(document.documentElement,{childList:!0,subtree:!0})}var qt=function(t){n.viewProviders.visualPlugins&&(!function(t){var n=void 0,i=void 0;Object.keys(t).forEach(function(r){n=t[r].options,i=t[r].prototype,n&&(Tt.options[r]=n),i&&e.assign($t,i)})}(n.viewProviders.visualPlugins),n.viewProviders.visualPlugins=null);for(var i=[{},$t,Dt],r=1;r<arguments.length;++r)i.push(arguments[r]);return Ct(t,e.assign.apply(void 0,i))},$t={$:null,initialise:function(t){var n=this.visualParent;if(void 0!==this.options.active?this.active=e.pop(this.options,"active"):this.active=!0,n){if(!n.layers)throw new Error("visual parent of "+this.visualType+" does not have layers")}else this.visualParent=n=new jt(t,this.options,null,this.model),this.model=n.model.$new(),this.options={};n.layers.push(this)},paper:function(){return this.visualParent.paper()},activate:function(t){return this.active||(this.active=!0,this.group().transition(this.model.uid).on("end",function(){t&&t()}).style("opacity",1)),this},deactivate:function(t){return this.active&&(this.active=!1,this.group().transition(this.model.uid).on("end",function(){t&&t()}).style("opacity",0)),this},getVisual:function(){return this.visualParent.getVisual()},group:function(t){var e=this.visualType+"-"+this.model.uid,n=this.visualParent.getPaperGroup(e);return t&&t!==this.visualType?this.paper().childGroup(n,t):n},translate:function(t,n){return e.isFunction(t)?function(e){return"translate("+(t(e)||0)+", "+(n(e)||0)+")"}:"translate("+t+", "+n+")"},getD3:function(t,e){return this.$[""+t+e[0].toUpperCase()+e.substring(1)]},displayError:function(){}},Dt={draw:function(t){var e=this;if(this.drawing)return ht(this.toString()+" already drawing"),this.drawing;var i=this,r=this.doDraw;if(this.paper().size(this.boundingBox(!0)),this.active){if(Tt.events.call("before-draw",void 0,this),!1!==t||!this._drawArgs)return Promise.all([this.requires?n.viewProviders.require.apply(void 0,this.requires):[],this.getData()]).then(function(t){delete i.drawing;var n=t[1];n&&(e.$=t[0],e.frame=n,r.apply(i),Tt.events.call("after-draw",void 0,i))},function(t){delete i.drawing,ht("Could not draw "+i.toString()+": "+t,t),e.displayError(t)});delete i.drawing,r.apply(i,this._drawArgs),Tt.events.call("after-draw",void 0,i)}}},Ft={initialise:function(){},transition:function(){},size:function(t){return this.sel.attr("width",t.width).attr("height",t.height),this},group:function(t,e){return this.childGroup(this.sel,t,e)},childGroup:function(t,e,n){e||(e="main");var i=t.selectAll("."+e).data([0]).enter().append("g").classed(e,!0);return n&&i.attr("transform",n).merge().attr("transform",n),t.select("."+e)},dim:function(t){return t}};S("svg",{initialise:function(t,e){e||t.model.uid;var n=t.paperElement.select("svg#"+e);return n.size()||(n=t.paperElement.append("svg").attr("id",e).classed(t.visualType,!0).style("position","absolute")),n.node()}}),S("div",{initialise:function(t){var e=t.model.uid,n=t.visualParent,i=n.paperElement.select("div#"+e);return i.size()||(i=n.paperElement.append("div").attr("id",e).classed(n.visualType,!0).style("position","absolute")),i.node()},size:function(t){return this.sel.style("width",t.width+"px").style("height",t.height+"px"),this},childGroup:function(t,e){return e||(e="main"),t.selectAll("."+e).data([0]).enter().append("div").classed(e,!0),t.select("."+e)}});$t.getScale=function(t){e.isString(t)&&(t={type:t});return function(t,n){return(n.$events?n.$events.keys():Object.keys(n)).forEach(function(i){e.isFunction(t[i])&&t[i](n[i])}),t}(this.getD3("scale",t.type)(),t)},mt.menu={display:!1,height:"8%",maxHeight:50,minHeight:20},Tt.events.on("after-init.menu",function(t){if("visual"===t.visualType){t.getModel("menu").display&&(t.menu=t.sel.insert("nav",":first-child").classed("d3-nav navbar p-1",!0),t.menu.append("h4").classed("title",!0))}}),Tt.events.on("before-draw.menu",function(t){t&&t.menu&&function(t){var e=t.getModel("menu"),n=t.dim(e.height,t.height,e.minHeight,e.maxHeight);t.menu.style("height",n+"px")}(t)}),e.assign(Tt.schema.definitions,{data:{type:"array",items:{$ref:"#/definitions/dataSource"}},dataSource:{oneOf:At.values().map(function(t){var e=t.prototype.schema;return e.properties.transforms={$ref:"#/definitions/transforms"},e})}}),$t.getData=function(){var t=this.model.data;{if(t)return this.dataStore.getData(t,{$visual:this});ht("Visual "+this.visualType+" without data name, cannot get data")}},$t.getContext=function(t){return this.dataStore.model.$child(t)},Tt.events.on("before-init.data",function(t){t.isViz&&(t.data=e.pop(t.options,"data"))}),Tt.events.on("after-init.data",function(t){Object.defineProperties(t,{dataStore:{get:function(){return t.model.root.dataStore}}}),t.isViz?function(t){var n=t.dataStore,i=e.pop(t,"data");i&&(e.isString(i)&&(i={source:i}),i.name||(i.name=t.model.uid),(i=n.addSources(i))?t.model.$set("data",i.name):ht("Could not create data source "+i.name))}(t):function(t){var n=t.dataStore,i=e.pop(t.options,"data");n||(n=new v(t.getModel("dataContext")),t.model.root.dataStore=n),n.addSources(i)}(t)});var Ht=i.map(),Rt=function(t,e){var n=Ht.get(t);return n||(n=d.format(t),Ht.set(t,n)),2==arguments.length?n(e):n},Yt=i.map(),Nt=function(t,e){var n=Yt.get(t);return n||(n=s.timeFormat(t),Yt.set(t,n)),2==arguments.length?n(e):n};if(Tt.options.dataContext={$format:Rt,$formatTime:Nt},$t.format=function(t){var e=this.dataStore.eval(t);if(e)return e;try{return Rt(t)}catch(e){return Nt(t)}},Tt.options.font={size:"3%",minSize:10,maxSize:20,stroke:"#333",family:null},$t.font=function(t,e){e=e||this.getModel("font");var n=this.getModel(),i=this.dim(e.size,t.height,e.minSize,e.maxSize);return n.fontSizeMultiplier&&(i*=n.fontSizeMultiplier),i},mt.resizeDelay||(mt.resizeDelay=200),e.inBrowser){var Bt=n.viewDebounce(function(){Tt.live.forEach(function(t){return t.resize()})},mt.resizeDelay);u.select(window).on("resize.visuals",Bt)}mt.title={text:null,size:"3%",minSize:15,maxSize:25,offset:["10%",0]},Tt.events.on("before-init.title",function(t){var n=t.options.title;e.isString(n)&&(t.options.title={text:n})}),Tt.events.on("after-draw.title",function(t){var e=t.getModel("title"),n=t;if("visual"===n.visualType)delete n.__title;else{if(!t.isViz)return;n=t.visualParent}if(e.text)if(n.menu&&!n.__title)n.__title=e,function(t,e){var n=function(t){return+t.substring(0,t.length-2)}(t.menu.style("height")),i=e.maxSize?Math.min(n-4,e.maxSize):n-4,r=t.dim(e.size,t.width,e.minSize,i);t.menu.select(".title").html(e.text).style("font-size",r+"px").style("line-height",n+"px")}(n,e);else if(t.isViz){var i=t.boundingBox(!0),r=t.getModel("font"),a=e.stroke||r.stroke,o=t.font(i,e),s=t.group().selectAll("text.chartitle").data([e.text]),l=t.dim(e.offset[0],i.vizHeight),u=t.dim(e.offset[1],i.vizWidth),d=t.translate(i.margin.left+i.innerWidth/2+u,l);s.enter().append("text").classed("chartitle",!0).attr("transform",d).style("text-anchor","middle").style("font-size",o).style("fill",a).text(function(t){return t}).merge(s).transition().attr("transform",d).style("font-size",o).style("fill",a).text(function(t){return t})}});var Xt=["top","bottom","left","right"],Vt=["left","right"];mt.margin={top:20,bottom:20,left:20,right:20},mt.padding={top:0,bottom:0,left:0,right:0},$t.boundingBox=function(t){if(t&&O(this),!this.__boundingBox){var e=this.visualParent.width,n=this.visualParent.height,i=_(this.getModel("padding"),e,n),r=e-i.left-i.right,a=n-i.top-i.bottom,o=_(this.getModel("margin"),r,a),s=Xt.reduce(function(t,e){return t[e]=o[e]+i[e],t},{});this.__boundingBox={margin:o,padding:i,total:s,width:e,height:n,vizWidth:r,vizHeight:a,innerWidth:e-s.left-s.right,innerHeight:n-s.top-s.bottom,$nomargins:P}}return this.__boundingBox},Tt.events.on("after-init.margin",function(t){t.margin=A("margin",t),t.padding=A("padding",t)}),Tt.events.on("before-draw.margin",function(t){t.isViz&&O(t)});var Lt={ticks:5,tickSize:6,tickSizeOuter:null,rotate:null,ancor:"end",format:null,timeFormat:"%Y-%m-%d",stroke:"#333",hide:null,title:null,titleRotate:null,titleOffset:.7};Tt.options.xAxis=e.assign({location:"bottom"},Lt),Tt.options.yAxis=e.assign({location:"left"},Lt),$t.getAxis=function(t,e){return this.getD3("axis",t)(e)},$t.xAxis1=function(t,e,n,i){var r=this.getModel("xAxis"),a=this._axis(t,e,r,i),o=this.group("x-axis");return this.applyTransform(o,this.translateAxis(t,n)),T(o.transition(this.transition("x-axis")).call(a),r,e),r.title&&this.axisTitle(o,t,e,n,r),o},$t.yAxis1=function(t,e,n,i){var r=this.getModel("yAxis"),a=this._axis(t,e,r,i),o=this.group("y-axis");return this.applyTransform(o,this.translateAxis(t,n)),T(o.transition(this.transition("x-axis")).call(a),r,e),r.title&&this.axisTitle(o,t,e,n,r),o},$t.axisTitle=function(t,e,n,i,r){var a=t.selectAll("text.title").data([r.title]),o=r.titleRotate||0,s=0,l=0;o||"right"!==e&&"left"!==e||(o=-90),"left"==e&&(s=-r.titleOffset*i.margin.left,l=i.innerHeight/2);var u="translate("+s+","+l+") rotate("+o+")",d=this.font(i);a.enter().append("text").classed("title",!0).attr("transform",u).style("text-anchor","middle").style("font-size",d).style("fill",r.stroke).text(function(t){return t}).merge(a).transition().attr("transform",u).style("font-size",d).style("fill",r.stroke).text(function(t){return t})},$t.translateAxis=function(t,e){return"top"===t||"left"===t?this.translate(e.margin.left,e.margin.top):"bottom"===t?this.translate(e.margin.left,e.margin.top+e.innerHeight):this.translate(e.margin.left+e.innerWidth,e.margin.top)},$t._axis=function(t,n,i,r){var a=this.getAxis(t,n).tickSize(i.tickSize);return null!==i.tickSizeOuter&&a.tickSizeOuter(i.tickSizeOuter),e.isDate(r)?a.tickFormat(s.timeFormat(i.timeFormat)):null!==i.format&&a.tickFormat(this.format(i.format)),a.ticks(i.ticks)},$t.getSymbol=function(t){return this.$.symbol().type(this.getD3("symbol",t))},$t.getCurve=function(t){return this.getD3("curve",t)},$t.getStack=function(){var t=this.getModel();if(t.stack){var e=this.$.stack();return t.stackOrder&&e.order(this.getD3("stack",t.stackOrder)),t.stackOffset&&e.offset(this.getD3("stack",t.stackOffset)),e}};var Gt=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t},It="\\s*([+-]?\\d+)\\s*",Ut="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Kt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Zt=/^#([0-9a-f]{3})$/,Jt=/^#([0-9a-f]{6})$/,Qt=new RegExp("^rgb\\("+[It,It,It]+"\\)$"),te=new RegExp("^rgb\\("+[Kt,Kt,Kt]+"\\)$"),ee=new RegExp("^rgba\\("+[It,It,It,Ut]+"\\)$"),ne=new RegExp("^rgba\\("+[Kt,Kt,Kt,Ut]+"\\)$"),ie=new RegExp("^hsl\\("+[Ut,Kt,Kt]+"\\)$"),re=new RegExp("^hsla\\("+[Ut,Kt,Kt,Ut]+"\\)$"),ae={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Gt(C,j,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}}),Gt(F,function(t,e,n,i){return 1===arguments.length?D(t):new F(t,e,n,null==i?1:i)},W(C,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new F(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new F(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}})),Gt(R,function(t,e,n,i){return 1===arguments.length?function(t){if(t instanceof R)return new R(t.h,t.s,t.l,t.opacity);if(t instanceof C||(t=j(t)),!t)return new R;if(t instanceof R)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),a=Math.max(e,n,i),o=NaN,s=a-r,l=(a+r)/2;return s?(o=e===a?(n-i)/s+6*(n<i):n===a?(i-e)/s+2:(e-n)/s+4,s/=l<.5?a+r:2-a-r,o*=60):s=l>0&&l<1?0:o,new R(o,s,l,t.opacity)}(t):new R(t,e,n,null==i?1:i)},W(C,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new R(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new R(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new F(Y(t>=240?t-240:t+120,r,i),Y(t,r,i),Y(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var oe=Math.PI/180,se=180/Math.PI,le=.95047,ue=1,de=1.08883,ce=4/29,fe=6/29,he=3*fe*fe,pe=fe*fe*fe;Gt(B,function(t,e,n,i){return 1===arguments.length?N(t):new B(t,e,n,null==i?1:i)},W(C,{brighter:function(t){return new B(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new B(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return t=ue*V(t),e=le*V(e),n=de*V(n),new F(L(3.2404542*e-1.5371385*t-.4985314*n),L(-.969266*e+1.8760108*t+.041556*n),L(.0556434*e-.2040259*t+1.0572252*n),this.opacity)}})),Gt(I,function(t,e,n,i){return 1===arguments.length?function(t){if(t instanceof I)return new I(t.h,t.c,t.l,t.opacity);t instanceof B||(t=N(t));var e=Math.atan2(t.b,t.a)*se;return new I(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}(t):new I(t,e,n,null==i?1:i)},W(C,{brighter:function(t){return new I(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new I(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return N(this).rgb()}}));var ge=-.14861,me=1.78277,ve=-.29227,ye=-.90649,xe=1.97294,be=xe*ye,we=xe*me,ke=me*ve-ye*ge;Gt(U,function(t,e,n,i){return 1===arguments.length?function(t){if(t instanceof U)return new U(t.h,t.s,t.l,t.opacity);t instanceof F||(t=D(t));var e=t.r/255,n=t.g/255,i=t.b/255,r=(ke*i+be*e-we*n)/(ke+be-we),a=i-r,o=(xe*(n-r)-ve*a)/ye,s=Math.sqrt(o*o+a*a)/(xe*r*(1-r)),l=s?Math.atan2(o,a)*se-120:NaN;return new U(l<0?l+360:l,s,r,t.opacity)}(t):new U(t,e,n,null==i?1:i)},W(C,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new U(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new U(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*oe,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),r=Math.sin(t);return new F(255*(e+n*(ge*i+me*r)),255*(e+n*(ve*i+ye*r)),255*(e+n*(xe*i)),this.opacity)}}));var ze=i.map();mt.color={scale:"cool",scaleMinPoints:6,scaleOffset:0,stroke:"#333",strokeOpacity:1,fillOpacity:1},ze.set("viridis",function(t){return t.scaleSequential(t.interpolateViridis)}),ze.set("inferno",function(t){return t.scaleSequential(t.interpolateInferno)}),ze.set("magma",function(t){return t.scaleSequential(t.interpolateMagma)}),ze.set("plasma",function(t){return t.scaleSequential(t.interpolatePlasma)}),ze.set("warm",function(t){return t.scaleSequential(t.interpolateWarm)}),ze.set("cool",function(t){return t.scaleSequential(t.interpolateCool)}),ze.set("rainbow",function(t){return t.scaleSequential(t.interpolateRainbow)}),ze.set("cubehelix",function(t){return t.scaleSequential(t.interpolateCubehelixDefault)}),$t.getColorScale=function(t){return ze.get(t)(this.$)},$t.colors=function(t,n){var i=this.getModel("color"),r=!1,a=void 0,s=void 0;if(e.isArray(i.scale))s=this.getScale("ordinal").range(i.scale);else{if(!(a=this.getColorScale(i.scale)))throw new Error("Unknown scale "+i.scale);e.isObject(a)||(a={scale:a}),void 0===a.minPoints&&(a.minPoints=i.scaleMinPoints),s=a.scale,r=a.reversed}if(e.isFunction(s.interpolator)){var l=i.scaleOffset,u=t+l,d=Math.max(u,a.minPoints),c=r?[d-1,0]:[0,d-1];s.domain(c);var f=void 0;return o.range(l,Math.min(u,d)).map(function(t){return f=j(s(t)),f.opacity=n,f})}var h=s.range().slice();r&&h.reverse();for(var p=void 0,g=void 0,m=void 0,v=0;v<i.scaleOffset;++v)h.push(h.shift());return o.range(t).map(function(){return p=h.shift(),g=j(p),m=j(p),g.opacity=n,h.push(""+m.brighter(.2)),g})},$t.fill=function(t){function e(t,e){return r[e]}var n=this.getModel("color"),i=this.modelProperty("fillOpacity",n),r=this.colors(t.length,i);return e.colors=r,e},$t.stroke=function(t){function e(t,e){return r[e]}var n=this.getModel("color"),i=this.modelProperty("strokeOpacity",n),r=this.colors(t.length,i);return e.colors=r,e},$t.linearGradient=function(t,e,n,i){var r=this.paper().sel,a=r.select("defs");a.node()||(a=r.append("defs"));var o=a.selectAll("#"+i).data([0]),s=j(t);s.opacity=.1,o.enter().append("linearGradient").attr("id",i).attr("x1","0%").attr("y1","0%").attr("x2","vertical"===n?"0%":"100%").attr("y2","vertical"===n?"100%":"0%");var l=a.select("#"+i).selectAll("stop").data([{offset:"0%",color:t},{offset:"100%",color:s}]);return l.enter().append("stop").merge(l).attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}),"url(#"+i+")"},mt.legend={location:"top-right",orient:"vertical",fontSize:"3%",title:"",titleWidth:"20%",labelFormat:null,titleMinWidth:30,titleMaxWidth:60,minFontSize:10,maxFontSize:20,offset:[10,10],shapeWidth:15,shapeHeight:15,hide:300},$t.getLegend=function(t){return this.getD3("legend",t)},$t.legend=function(t,n){var i=this.getModel(),r=this.getModel("legend"),a=this.getModel("font"),o=e.pop(t,"type")||i.legendType,s=Math.max(n.vizHeight,n.vizWidth),l=this.dim(r.fontSize,s,r.minFontSize,r.maxFontSize),u=this.getLegend(o);if(r.location){if(!u)return ht("Could not load legend "+o);if(u=u().orient(r.orient),r.title&&(u.title(r.title),r.titleWidth)){var d=this.dim(r.titleWidth,s,r.titleMinWidth,r.titleMaxWidth);u.titleWidth(d)}r.labelFormat&&u.labelFormat(r.labelFormat),u.shapeWidth(r.shapeWidth).shapeHeight(r.shapeHeight);for(var c in t)u[c](t[c]);var f=this.group("legend").style("font-size",l+"px").html("").call(u),h=f.node().getBBox(),p=Me.get(r.location).call(this,h,n,r),g=this.translate(p.x,p.y);f.selectAll("text").style("fill",r.stroke||a.stroke),this.applyTransform(f,g),r.hide&&(s<r.hide?f.style("opacity",0):f.style("opacity",1))}};var Me=i.map({top:function(t,e,n){var i=this.dim(n.offset[1],e.vizHeight);return{x:e.margin.left+(e.innerWidth-t.width)/2,y:i}},bottom:function(t,e,n){var i=this.dim(n.offset[1],e.vizHeight);return{x:e.margin.left+(e.innerWidth-t.width)/2,y:e.vizHeight-t.height-i}},right:function(t,e,n){var i=this.dim(n.offset[0],e.vizWidth);return{x:e.vizWidth-t.width-i,y:e.margin.top+(e.innerHeight-t.height)/2}},left:function(t,e,n){var i=this.dim(n.offset[0],e.vizWidth);return{x:e.margin.left-i,y:e.margin.top+(e.innerHeight-t.height)/2}},"top-left":function(t,e,n){var i=this.dim(n.offset[0],e.vizWidth),r=this.dim(n.offset[1],e.vizHeight);return{x:e.margin.left+(e.innerWidth-t.width)/2+i,y:r}},"top-right":function(t,e,n){var i=this.dim(n.offset[0],e.vizWidth),r=this.dim(n.offset[1],e.vizHeight);return{x:e.vizWidth-t.width-i,y:r}},"bottom-left":function(t,e,n){var i=this.dim(n.offset[0],e.vizWidth),r=this.dim(n.offset[1],e.vizHeight);return{x:t.width+i,y:e.vizHeight-t.height-r}},"bottom-right":function(t,e,n){var i=this.dim(n.offset[0],e.vizWidth),r=this.dim(n.offset[1],e.vizHeight);return{x:e.vizWidth-t.width-i,y:e.vizHeight-t.height-r}}}),Se=function(t){return function(){return t}},Ae=function(t){return e.isFunction(t)?t:Se(t)},_e=function(t){return t},Oe=i.map({darker:function(){function t(t,e){var n=t.getModel("mouse"),i=j(e.style("fill")),r=i.darker(n.darkerFactor);e.node().__mouse_over__.fill=i,e.style("fill",r)}return t.out=function(t,e){var n=e.node().__mouse_over__.fill;n&&e.style("fill",n)},t}(),fill:function(){function t(t,e){var n=t.getModel("mouse"),i=j(e.style("fill"));e.node().__mouse_over__.fill=i,e.transition().style("fill",n.fillColor)}return t.out=function(t,e){var n=e.node().__mouse_over__.fill;n&&e.transition().style("fill",n)},t}()});Tt.options.mouse={over:["darker"],darkerFactor:.5,fillColor:"#addd8e"},$t.mouseOver=function(){var t=this,e=this.getModel("mouse");return function(n,i){this.__mouse_over__||(this.__mouse_over__={});var r=t.select(this),a=void 0;e.over.forEach(function(e){(a=Oe.get(e))?a(t,r,n,i):ht("Unknown mouse strategy "+e)})}},$t.mouseOut=function(){var t=this,e=this.getModel("mouse");return function(n,i){this.__mouse_over__||(this.__mouse_over__={});var r=t.select(this),a=void 0;e.over.forEach(function(e){(a=Oe.get(e))?a.out(t,r,n,i):ht("Unknown mouse strategy "+e)})}},Tt.options.tooltip={location:"top",offset:[10,10],html:""},e.inBrowser?$t.tooltip=function(){function t(){return null===s&&(s=u.select(document.body).append("div").classed("d3-tooltip",!0).style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box").node(),l=u.select(document.body).append("svg").style("opacity",0).style("pointer-events","none").node().createSVGPoint()),u.select(s)}function e(){}function n(t){for(;null==t.getScreenCTM&&null==t.parentNode;)t=t.parentNode;var e={},n=t.getScreenCTM(),i=t.getBBox(),r=i.width,a=i.height,o=i.x,s=i.y;return l.x=o,l.y=s,e.nw=l.matrixTransform(n),l.x+=r,e.ne=l.matrixTransform(n),l.y+=a,e.se=l.matrixTransform(n),l.x-=r,e.sw=l.matrixTransform(n),l.y-=a/2,e.w=l.matrixTransform(n),l.x+=r,e.e=l.matrixTransform(n),l.x-=r/2,l.y-=a/2,e.n=l.matrixTransform(n),l.y+=a,e.s=l.matrixTransform(n),e}var r=Ae("top"),a=Ae([0,0]),o=Ae(" "),s=null,l=null,d=i.map({top:function(t,e){var i=n(t);return{left:i.n.x-s.offsetWidth/2,top:i.n.y-s.offsetHeight-e[1]}},bottom:function(t,e,n){return{top:e.total.left+(e.innerWidth-t.width)/2,left:e.height-t.height-n.offsetY}},right:function(t,e){var i=n(t);return{left:i.e.x+e[0],top:i.e.y-s.offsetHeight/2}},left:function(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}},"top-left":function(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}},"top-right":function(t,e,n){return{x:e.width-t.width-n.offsetX,y:n.offsetY}},"bottom-left":function(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}},"bottom-right":function(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}}}),c=d.keys();return e.show=function(n){var i,s=Array.prototype.slice.call(arguments),l=t(),u=o.apply(this,s)||"",f=a.apply(this,s),h=r.apply(this,s),p=document.documentElement.scrollTop||document.body.scrollTop,g=document.documentElement.scrollLeft||document.body.scrollLeft;l.html(u).style("opacity",1).style("pointer-events","all");for(var m=c.length;m--;)l.classed(c[m],!1);return i=d.get(h).call(this,n,f),l.classed(h,!0).style("top",i.top+p+"px").style("left",i.left+g+"px"),e},e.hide=function(){return t().style("opacity",0).style("pointer-events","none"),e},e.location=function(t){return arguments.length?(r=null===t?t:Ae(t),e):r},e.html=function(t){return arguments.length?(o=null===t?t:Ae(t),e):o},e.offset=function(t){return arguments.length?(a=null==t?t:Ae(t),e):a},e}():$t.tooltip=_e,Oe.set("tooltip",function(){function t(t,e,n,i){var r=t.tooltipHtml(e,n,i);if(r){var a=t.getModel("tooltip");t.tooltip.location(a.location).offset(a.offset).html(r).show(e.node())}}return t.out=function(t){t.tooltip.hide()},t}()),$t.tooltipHtml=function(t,e,n){var i=this.getModel("tooltip");if(i.html)return this.dataStore.eval(i.html,{d:e,index:n,model:this.getModel()})},Tt.options.expand={location:"top-right",expandText:"expand",collapseText:"collapse",height:15,width:15,radius:3,offset:[0,0],stroke:"#adadad",fill:"#fff",fillOver:"#e6e6e6",textColor:"#111"},Tt.events.on("after-draw.expand",function(t){function e(){t.select(this).select("rect.button").attr("fill",i.fill)}var n=t.visualParent;if(t.isViz&&!(n.layers.length<=1)){var i=t.getModel("expand");if(t.__expanded||i.location&&function(t){return t.left||t.right||t.top||t.bottom}(t.getModel("padding"))){var r=t.getModel("font"),a=t.boundingBox(),o=t.group("expand"),s=o.node(),l=Math.floor(.8*Math.min(i.width,i.height)),u=t.__expanded?i.collapseText:i.expandText,d=!1;o.select("rect").size()||(d=!0,o.attr("cursor","pointer").on("mouseover",function(){t.select(this).select("rect.button").attr("fill",i.fillOver)}).on("mouseout",e),o.append("rect").classed("button",!0).attr("x",0).attr("y",0).attr("rx",i.radius).attr("ry",i.radius).attr("width",i.width).attr("height",i.height).attr("stroke",i.stroke).attr("fill",i.fill).attr("cursor","pointer"),o.append("text").attr("x",i.width/2).attr("y",i.height/2).attr("fill",i.textColor).attr("font-family",i.fontFamily||r.family).attr("text-anchor","middle").attr("alignment-baseline","middle").attr("font-size",l),o.append("rect").classed("placeholder",!0).attr("x",0).attr("y",0).attr("rx",i.radius).attr("ry",i.radius).attr("width",i.width).attr("height",i.height).attr("stroke","none").attr("fill","transparent").on("click",function(){var i=t.getModel("padding");if(e.call(this),t.__expanded){var r=t.__expanded.padding;delete t.__expanded,n.activate(),Xt.forEach(function(t){r[t]&&(i[t]=r[t])})}else t.__expanded={padding:Xt.reduce(function(t,e){return i[e]&&(t[e]=i[e],i[e]=0),t},{})},n.deactivate(),t.activate();n.redraw(!1)})),o.select("text").text(function(){return u});var c=Me.get(i.location).call(t,s.getBBox(),a,i);d||(o=o.transition(t.transition("expand"))),o.attr("transform",t.translate(c.x,c.y))}}}),Tt.options.transition={duration:250,delay:0,ease:null},$t.transition=function(t){var e=this.idname(t),n=this.getModel("transition");return l.transition(e).duration(n.duration)},$t.applyTransform=function(t,e){t.attr("transform")||t.attr("transform",e),t.transition().attr("transform",e)},$t.brushX=function(){return this.$.brushX()},$t.brushY=function(){return this.$.brushY()},$t.brush=function(){return this.$.brush()};var Pe=Ct("container",{initialise:function(){this.live=[],this.visualParent&&this.visualParent.live.push(this)},draw:function(t){if(this.drawing)return ht(this.toString()+" already drawing"),this.drawing;var e=this;return Tt.events.call("before-draw",void 0,e),Promise.all(this.live.map(function(e){return e.redraw(t)})).then(function(){delete e.drawing,Tt.events.call("after-draw",void 0,e)})},destroy:function(){this.pop(this.visualParent)}}),Ee={props:["schema","datasource","plugins","options"],render:function(t,n,i){var r=this,a=this.select(i).html();return this.getSchema(t.schema,function(i){return e.isObject(i)||(i={}),i=e.assign({},t.options,i),r.build(i,a,n)})},getSchema:function(t,n){var i=this.model.visual;if(i&&i!==this.model&&e.isString(t)){var r=i.getVisualSchema(t);r&&(t=r)}return e.isString(t)?this.json(t).then(n).catch(function(e){ht("Could not reach "+t+": "+e,e)}):n(t)},build:function(){}},Te=e.assign({},Ee,{build:function(t,e,n){var i=this.model,r=this.createElement("div"),a=i.root;return n.class&&r.attr("class",n.class),t.visuals||(t.visuals={}),i.visual=new Pe(r.node(),t,i.visual,i.visual?null:i.$new()),a.visualDashboard||(a.visualDashboard=i.visual),r.html(e)}}),We=e.assign({},Ee,{build:function(t,n,i){var r,a=this.createElement("div"),o=t.type||"visual",s=this.model,l=e.pop(t,"visualDrawOnMount"),u={};return i.class&&a.attr("class",i.class),"visual"===o?(r=e.pop(t,"layers"),u=t):u.visual=e.pop(t,"visual")||{},void 0!==l&&(s.visualDrawOnMount=l),s.visual=new jt(a.node(),u,s.visual,s.visual?null:s.$new()),"visual"!==o?s.visual.addVisual(t):r&&r.forEach(function(t){return s.visual.addVisual(t)}),a},mounted:function(){!1!==this.model.visualDrawOnMount&&this.model.visual.redraw()}}),Ce={install:function(t){t.addComponent("dashboard",Te),t.addComponent("visual",We)}},je=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},qe=function(t,e){var n=t[0],i=(t[1]-n)/e,r=Math.floor(Math.log10(i)),a=Math.pow(10,r);i/a>5&&(a*=10);var o=(a*=.1)*Math.ceil(i/a),s=a*Math.floor(n/a);return[s,s+e*o]},$e=function(t,e,n){return.299*(t=j(t)).r+.587*t.g+.114*t.b>186?n||"#000":e||"#fff"},De=function(t,e,n){e=Ae(e),t.each(function(t,i){var r=u.select(this),a=parseFloat(r.attr("dy"))||0,o=e(t,i),s=r.text().split("\n"),l=void 0,d=void 0,c=void 0,f=r.text(null).append("tspan").attr("x",0).attr("dy",a+"em");s.forEach(function(t,e){for(c=[],d=t.split(/\s+/).reverse(),e&&(f=r.append("tspan").attr("x",0).attr("dy",1.2+a+"em"));l=d.pop();)c.push(l),f.text(c.join(" ")),f.node().getComputedTextLength()>o&&c.length>1&&(c.pop(),f.text(c.join(" ")),c=[l],f=r.append("tspan").attr("x",0).attr("dy",1.2+a+"em").text(l))}),n&&r.selectAll("tspan").each(n)})},Fe=["linear","log","time"];e.assign(Tt.schema.definitions,{curve:{type:"string",description:"curve type for line and area charts",default:"natural",enum:["basis","basisClosed","basisOpen","bundle","cardinal","cardinalClosed","cardinalOpen","catmullRom","catmullRomClosed","catmullRomOpen","linear","linearClosed","monotoneX","monotoneY","natural","step","stepAfter","stepBefore"]},stack:{type:"object",properties:{order:{type:"string",enum:["ascending","descending","insideOut","none","reverse"],default:"none"},offset:{type:"string",enum:["diverging","expand","none","silhouette","wiggle"],default:"none"}}}});var He={lineWidth:{type:"number",default:1},curve:{$ref:"#/definitions/curve"},cornerRadius:{type:"number",default:0,minimum:0,description:"corner radius in pixels"},x:{type:"string",description:"data accessor for the x coordinate",default:"x"},y:{type:"string",description:"data accessor for the y coordinate",default:"y"},scaleX:{type:"string",description:"scale for the x coordinate",enum:Fe,default:"linear"},scaleY:{type:"string",description:"scale for the y coordinate",enum:Fe,default:"linear"},axisX:{type:"boolean",description:"draw x axis",default:!1},axisY:{type:"boolean",description:"draw y axis",default:!1},groupby:{type:"string",description:"Group data by a given dimension"},stack:{$ref:"#/definitions/stack"},gradient:{type:"boolean",description:"Gradient to zero opacity",default:!1},lineDarken:{type:"number",description:"Darken line color",minimum:0,maximum:1,default:.2}},Re={center:"middle",top:"hanging",bottom:"baseline",outside:"baseline"},Ye={center:function(t,e){return e/2},top:function(t,e,n){return n},bottom:function(t,e,n){return e-n},outside:function(t,e,n){return-n}};qt("barchart",{requires:["d3-scale","d3-axis","d3-svg-legend"],schema:{x:He.x,y:He.y,orientation:{type:"string",enum:["vertical","orizontal"],default:"vertical"},groupby:He.groupby,stack:He.stack,waffle:{type:"boolean",description:"ability to draw a waffle chart"},normalize:{type:"boolean"},lineWidth:He.lineWidth,cornerRadius:He.cornerRadius,axisX:He.axisX,axisY:He.axisY,scaleY:He.scaleY,sortby:{type:"string",enum:["x","y"]},label:{type:"string",description:"expression for label text"},scaleX:{type:"object",default:{type:"band",padding:.2},properties:{type:{type:"string"},padding:{type:"number"}}}},options:{labelLocation:"center",labelOffset:10,labelWidth:.7,valueformat:".1f",legendType:"color",legendLabel:"label"},doDraw:function(){var t=this.getModel(),e=this.frame,n=e.data,i=this.boundingBox(),r=this.group(),a=this.group("chart"),o=t.x,s=t.y,l=t.groupby,u="vertical"===t.orientation?new K(this):new Z(this),d=void 0,c=!1;if(this.applyTransform(r,this.translate(i.padding.left,i.padding.top)),this.applyTransform(a,this.translate(i.margin.left,i.margin.top)),l&&(d=e.dimension(l).group().top(1/0).map(function(t){return t.key})).length<=1&&(d=null),d){var f=e.pivot(o,l,s);"y"===t.sortby&&(f=f.sortby("total")),n=f.data,u.sz.domain(d).range(this.fill(d).colors),t.stack&&(t.normalize&&(n=this.normalize(f)),c=!0)}else u.sz.domain([s]).range(this.fill([s]).colors),c=!0;var h=n.map(function(t){return t[o]});u.sx.domain(h),c||!d?u.stacked(a,n,d):u.grouped(a,n,d),u.axis(h),u.legend(d)}});var Ne={init:function(t){this.viz=t,this.model=t.getModel(),this.box=t.boundingBox(),this.sx=t.getScale(this.model.scaleX),this.sy=t.getScale(this.model.scaleY),this.sz=t.getScale("ordinal")},legend:function(t){t&&this.viz.legend({type:"color",scale:this.sz},this.box)},stacked:function(t,e,n){function i(t){return h(t[1-M])-h(t[M])}function r(t){return f(t.data[g])}function a(t){return h(t[M])}function s(t){return t.forEach(function(e){e.key=t.key,e.value=e.data[t.key]}),t}function l(t,e){var n=k(t,e)+b(t,e)/2,i=z(t,e)+T(t,w(t,e),C);return v.translate(n,i)}function u(t){return $e(p(t.key),"#fff",A.stroke)}function d(t,e){return v.dataStore.eval(_,{d:t,index:e})}var c=this.viz.getModel("color"),f=this.sx,h=this.sy,p=this.sz,g=this.model.x,m=this.model.y,v=this.viz,y=this.model.cornerRadius,x=t.selectAll(".group"),b=void 0,w=void 0,k=void 0,z=void 0,M=void 0,S=void 0;if(n?this.sy.domain([0,o.max(e,function(t){return t.total})]).nice():(this.sy.domain([0,o.max(e,function(t){return t[m]})]).nice(),n=[this.model.y]),this.vertical?(k=r,z=a,b=f.bandwidth,w=i,M=1):(k=a,z=r,b=i,w=f.bandwidth,M=0),e=v.getStack().keys(n)(e),(x=x.data(e)).exit().transition().style("opacity",0).remove(),(S=x.enter().append("g").classed("group",!0).attr("fill",function(t){return p(t.key)}).merge(x).attr("fill",function(t){return p(t.key)}).attr("stroke",v.modelProperty("stroke",c)).attr("stroke-opacity",v.modelProperty("strokeOpacity",c)).selectAll("rect").data(s)).enter().append("rect").attr("x",k).attr("y",z).attr("height",w).attr("width",b).attr("rx",y).attr("ry",y).on("mouseover",v.mouseOver()).on("mouseout",v.mouseOut()).merge(S).transition().attr("x",k).attr("y",z).attr("height",w).attr("width",b),S.exit().transition().style("opacity",0).remove(),this.model.label){var A=v.getModel("font"),_=this.model.label,O=v.font(this.box)+"px",P=t.selectAll(".labels").data(e),E=this.vertical?Re[this.model.labelLocation]||"baseline":"middle",T=Ye[this.model.labelLocation],W=this.model.labelWidth,C=this.model.labelOffset;(S=P.enter().append("g").classed("labels",!0).merge(P).selectAll("text").data(s)).enter().append("text").classed("label",!0).attr("transform",l).style("fill",u).style("font-size",O).text(d).merge(S).text(d).style("font-size",O).call(De,function(t){return W*b(t)},function(){v.select(this).attr("alignment-baseline",E).attr("text-anchor","middle")}).transition(v.transition("text")).attr("transform",l).style("fill",u)}},grouped:function(t,e,n){function i(t){return l(t[c])}function r(t){return u(t.value)}function a(t){return u(0)-u(t.value)}var s=this.viz.getModel("color"),l=this.sx,u=this.sy,d=this.sz,c=this.model.x,f=this.viz,h=this.model.cornerRadius,p=l.paddingInner(),g=f.getScale("band").domain(n).paddingInner(.5*p),m=t.selectAll(".group"),v=void 0,y=void 0,x=void 0,b=void 0;u.domain([0,o.max(e,function(t){return n.reduce(function(e,n){return Math.max(e,t[n])},0)})]).nice(),this.vertical?(g.rangeRound([0,l.bandwidth()]),x=i,v=g.bandwidth,y=a):(x=i,y=g.bandwidth,v=a),(m=m.data(e)).exit().remove(),(b=m.enter().append("g").classed("group",!0).attr("transform",function(t){return f.translate(x(t),0)}).merge(m).attr("transform",function(t){return f.translate(x(t),0)}).selectAll("rect").data(function(t){return n.map(function(e){return{key:e,value:t[e]}})})).exit().transition().style("opacity",0).remove(),b.enter().append("rect").attr("x",function(t){return g(t.key)}).attr("y",r).attr("rx",h).attr("ry",h).attr("height",y).attr("width",v).attr("stroke-width",this.model.lineWidth).attr("stroke",s.stroke).attr("stroke-opacity",0).attr("fill",function(t){return d(t.key)}).on("mouseover",f.mouseOver()).on("mouseout",f.mouseOut()).merge(b).transition(f.transition("rect")).attr("x",function(t){return g(t.key)}).attr("y",r).attr("height",y).attr("width",v).attr("stroke",s.stroke).attr("stroke-opacity",s.strokeOpacity).attr("fill",function(t){return d(t.key)}),b.exit().remove()}};K.prototype=e.assign({},Ne,{axis:function(t){this.model.axisX&&this.viz.xAxis1(!0===this.model.axisX?"bottom":this.model.axisX,this.sx,this.box,t[0]),this.model.axisY&&this.viz.yAxis1(!0===this.model.axisY?"left":this.model.axisY,this.sy,this.box)}}),Z.prototype=e.assign({},Ne,{axis:function(t){this.model.axisX&&this.viz.xAxis1(!0===this.model.axisX?"left":this.model.axisX,this.sx,this.box,t[0]),this.model.axisY&&this.viz.yAxis1(!0===this.model.axisY?"bottom":this.model.axisY,this.sy,this.box)}});var Be=function(){function t(t){var s=!1,l=void 0,u=void 0,d=void 0;return e&&(u=t.dimension(e).group().top(1/0).map(function(t){return t.key}).sort()).length<=1&&(u=null),u?(t=t.pivot(n,e,i),r&&(t=t.sortby("total")),l=t.data,a&&(o&&(l=function(t){return t}(l)),l=a.keys(u)(l),s=!0)):(l=t.data,u=[i]),s||(l=u.map(function(t,e){return d=l.map(function(e){return d=[0,e[t]],d.data=e,d}),d.index=e,d.key=t,d})),new J(l,n,i,s)}var e=null,n="x",i="y",r=!1,a=null,o=!1;return t.groupby=function(n){return arguments.length?(e=n,t):e},t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(i=e,t):i},t.normalize=function(e){return arguments.length?(o=e,t):o},t.stack=function(e){return arguments.length?(a=e,t):a},t};J.prototype={rangeX:function(){return this.range(this.x)},rangeY:function(){return this.range()},range:function(t){function e(t){return t[0]}function n(t){return t[1]}function i(e){return e.data[t]}var r=void 0,a=void 0;return a=t?this.data.reduce(function(t,e){return r=o.extent(e,i),t.push(r[0]),t.push(r[1]),t},[]):this.data.reduce(function(t,i){return r=o.extent(i,e),t.push(r[0]),t.push(r[1]),r=o.extent(i,n),t.push(r[0]),t.push(r[1]),t},[]),o.extent(a)}},qt("linechart",{requires:["d3-scale","d3-shape","d3-axis","d3-svg-legend"],schema:{lineWidth:He.lineWidth,curve:He.curve,x:He.x,y:He.y,scaleX:He.scaleX,scaleY:He.scaleY,groupby:He.groupby,axisX:He.axisX,axisY:He.axisY},doDraw:function(){function t(t,e){return g[e]}var n=this.getModel(),i=this.frame,r=n.x,a=n.y,o=this.boundingBox(),s=Be().groupby(n.groupby).x(r).y(a)(i),l=s.rangeX(),u=s.rangeY(),d=this.getScale(n.scaleX).domain(l).rangeRound([0,o.innerWidth]),c=this.getScale(n.scaleY).domain(u).rangeRound([o.innerHeight,0]).nice(),f=this.group(),h=this.group("chart"),p=h.selectAll(".line").data(s.data),g=this.stroke(s.data).colors,m=0,v=this.$.line().x(function(t){return d(t.data[r])+m}).y(function(t){return c(t[1])}).curve(this.getCurve(n.curve));this.applyTransform(f,this.translate(o.padding.left,o.padding.top)),this.applyTransform(h,this.translate(o.margin.left,o.margin.top)),e.isFunction(d.bandwidth)&&(d.domain(s.data[0].map(function(t){return t.data[r]})),m=d.bandwidth()/2),p.enter().append("path").attr("class","line").attr("fill","none").attr("stroke",t).attr("stroke-width",n.lineWidth).attr("d",v).merge(p).transition().attr("stroke",t).attr("stroke-width",n.lineWidth).attr("d",v),p.exit().transition().style("opacity",0).remove(),n.axisX&&this.xAxis1(!0===n.axisX?"bottom":n.axisX,d,o),n.axisY&&this.yAxis1(!0===n.axisY?"left":n.axisY,c,o),s.data.length>1&&this.legend({type:"color",scale:this.getScale("ordinal").range(g).domain(s.data.map(function(t){return t.key}))},o)}}),qt("areachart",{requires:["d3-scale","d3-shape","d3-axis","d3-svg-legend"],schema:{lineWidth:He.lineWidth,curve:He.curve,x:He.x,y:He.y,scaleX:He.scaleX,scaleY:He.scaleY,groupby:He.groupby,axisX:He.axisX,axisY:He.axisY,stack:He.stack,gradient:He.gradient,lineDarken:He.lineDarken},doDraw:function(){function t(t){return h(t.data[o])}function e(t){return p(t[0])}function n(t){return p(t[1])}var i=this,r=this.frame,a=this.getModel(),o=a.x,s=a.y,l=this.getModel("color"),u=this.boundingBox(),d=Be().groupby(a.groupby).stack(this.getStack()).x(o).y(s)(r),c=d.rangeX(),f=d.rangeY(),h=this.getScale(a.scaleX).domain(c).rangeRound([0,u.innerWidth]),p=this.getScale(a.scaleY).domain(f).rangeRound([u.innerHeight,0]).nice(),g=this.group(),m=this.group("chart"),v=m.selectAll(".areagroup").data(d.data),y=this.colors(d.data.length),x=a.gradient?y.map(function(t,e){return i.linearGradient(t,u,"vertical","fill"+i.model.uid+"-"+e)}):y,b=this.getCurve(a.curve);this.applyTransform(g,this.translate(u.padding.left,u.padding.top)),this.applyTransform(m,this.translate(u.margin.left,u.margin.top)),v.exit().transition().style("opacity",0).remove();var w=v.enter().append("g").classed("areagroup",!0).merge(v).selectAll("path").data(function(r){var o=i.$.area().curve(b).x(t).y1(n).y0(e),s=i.$.line().curve(b).x(t).y(n),l=j(y[r.index]);return[{type:"area",data:r,draw:o(r),stroke:"none",fill:x[r.index]},{type:"line",data:r,draw:s(r),fill:"none",stroke:l.darker(a.lineDarken)}]});w.enter().append("path").attr("class",function(t){return t.type}).attr("fill",function(t){return t.fill}).attr("stroke",function(t){return t.stroke}).attr("d",function(t){return t.draw}).merge(w).transition(this.transition("area")).attr("d",function(t){return t.draw}).attr("fill",function(t){return t.fill}).attr("stroke",function(t){return t.stroke}).attr("fill-opacity",l.fillOpacity).attr("stroke-width",a.lineWidth).attr("stroke-opacity",l.strokeOpacity),w.exit().transition().style("opacity",0).remove(),a.axisX&&this.xAxis1(!0===a.axisX?"bottom":a.axisX,h,u,c[0]),a.axisY&&this.yAxis1(!0===a.axisY?"left":a.axisY,p,u,f[0]),d.data.length>1&&this.legend({type:"color",scale:this.getScale("ordinal").range(y).domain(d.data.map(function(t){return t.key}))},u)},ticks:function(t,e){return Math.max(Math.floor(t/e),1)}});var Xe=Math.PI/180,Ve={proportionalData:function(t,e){return t.dimension(e).top(1/0)},total:function(t){function e(e){return n+=e[t],e[t]}var n=0;return e.total=function(){return n},e}};qt("piechart",Ve,{requires:["d3-scale","d3-shape","d3-svg-legend"],schema:{field:{type:"string",default:"data"},label:{type:"string",default:"label"},startAngle:{description:"Overall start angle of the pie in degree",default:0,type:"number"},endAngle:{description:"Overall end angle of the pie in degree",default:360,type:"number"},sort:{type:"string",description:"sort data before visualizing",enum:["none","ascending","descending"],default:"none"},innerRadius:{description:"Inner radius for donuts",default:0,oneOf:[{type:"number",minimum:0},{type:"string"}]},padAngle:{description:"Angular separation between each adjacent arcs in degree",default:0,type:"number",minimum:0},cornerRadius:He.cornerRadius,lineWidth:He.lineWidth,center:{type:"string",description:"Expression which display information in the center of the pie chart. Should be used with innerRadius greater than 0"},centerFont:{description:"Center text font size and family",$ref:"#/definitions/font"}},doDraw:function(t){var e=this.getModel(),r=this.getModel("color"),a=e.field,o=this.boundingBox(),s=Math.min(o.innerWidth,o.innerHeight)/2,l=y(e.innerRadius,s),u=this.total(a),c=this.$.pie().padAngle(Xe*e.padAngle).startAngle(Xe*e.startAngle).endAngle(Xe*e.endAngle).value(u),f=this.$.arc().innerRadius(l).outerRadius(s).cornerRadius(e.cornerRadius),h=this.group(),p=this.group("chart"),g=c(this.proportionalData(t,a)),m=this.fill(g),v=p.selectAll(".slice").data(g);if(this.applyTransform(h,this.translate(o.padding.left,o.padding.top)),this.applyTransform(p,this.translate(o.margin.left+o.innerWidth/2,o.margin.top+o.innerHeight/2)),v.enter().append("path").attr("class","slice").attr("stroke",r.stroke).attr("stroke-opacity",0).attr("fill",m).attr("stroke-width",e.lineWidth).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(v).transition().attr("stroke",r.stroke).attr("stroke-opacity",r.strokeOpacity).attr("d",f).attr("fill",m),v.exit().transition().remove(),e.center){var x=i.map(g.reduce(function(t,e){return t[e.data.label]=e,t})),b=this.dataStore.eval(e.center,{total:u.total(),d:x});if(b){var w=this.getModel("font"),k=this.dim(e.centerFontSize,o.innerWidth),z=p.selectAll(".info").data([b]);z.enter().append("text").attr("class","info").attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-size",k+"px").style("fill-opacity",0).merge(z).text(b).style("fill-opacity",e.centerOpacity).style("fill",w.stroke).call(De,1.5*(l||s))}}if(e.legendType){u=u.total();var M=n.viewExpression(e.legendLabel),S=d.format(e.fractionFormat),A=g.map(function(t,n){return M.eval({d:t,value:t.value,format:S,total:u,fraction:t.value/u,label:t.data[e.label]||n})});this.legend({scale:this.getScale("ordinal").domain(A).range(m.colors)},o)}}});qt("pyramidchart",Ve,{requires:["d3-scale","d3-shape","d3-svg-legend"],options:{field:"data",label:"label",pad:.005,lineWidth:1,inverted:!1,funnel:!1,legendType:"color",invereted:!1,legendLabel:"label + ' - ' + format('.1%', fraction)"},doDraw:function(t){var e=this.getModel(),i=e.field,r=this.getModel("color"),a=this.boundingBox(),o=(e.funnel?function(){function t(t){var a=void 0,o=void 0,s=void 0,l=void 0,u=void 0,d=void 0,c=void 0,f=0,h=0,p=t.length,g=new Array(p),m=new Array(p),v=i/p;for(a=0;a<p;++a)g[m[a]=a]=+e(t[a],a,t);for(m.sort(function(t,e){return je(g[t],g[e])}),u=g[m[0]],a=0;a<p;++a)o=m[a],l=g[o]/u,s=[[(d=r*l)/2,h+(c=f)],[-d/2,h+c],[-d/2,h+v-(f=i*(a===p-1?0:.5*n(l,a)))],[d/2,h+v-f]],h+=v,g[o]={index:a,value:g[o],fraction:l,points:s,data:t[o]};return g}var e=_e,n=Se(0),i=1,r=1;return t.value=function(n){return arguments.length?(e="function"==typeof n?n:Se(+n),t):e},t.base=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(i=e,t):i},t.pad=function(e){return arguments.length?(n="function"==typeof e?e:Se(+e),t):n},t}():function(){function t(t){var a=void 0,o=void 0,s=void 0,l=void 0,u=void 0,d=void 0,c=void 0,f=void 0,h=void 0,p=void 0,g=void 0,m=t.length,v=.5*r/i,y=new Array(m),x=new Array(m);for(a=0;a<m;++a)y[x[a]=a]=+e(t[a],a,t);for(x.sort(function(t,e){return je(y[t],y[e])}),h=y[x[0]],d=null,a=m-1;a>=0;--a)l=[],null===d?l.push([0,0]):(c=(f=d+p)*v,l.push([c,f]),l.push([-c,f])),o=x[a],s=m-a-1,u=y[o]/h,g=Math.sqrt(u),c=(f=(d=i*g)-(p=a?n(g,s):0))*v,l.push([-c,f]),l.push([c,f]),y[o]={index:s,value:y[o],fraction:u,points:l,data:t[o]};return y}var e=_e,n=Se(0),i=1,r=1;return t.value=function(n){return arguments.length?(e="function"==typeof n?n:Se(+n),t):e},t.base=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(i=e,t):i},t.pad=function(e){return arguments.length?(n="function"==typeof e?e:Se(+e),t):n},t}()).pad(e.pad).value(function(t){return t[i]}),s=this.getScale("linear").rangeRound([0,a.innerWidth]),l=this.getScale("linear").rangeRound(e.inverted?[a.innerHeight,0]:[0,a.innerHeight]),u=t.new(o(this.proportionalData(t,i))).dimension("fraction").bottom(1/0),d=this.$.symbol().type(function(t){return function(t){return{draw:function(e){t.forEach(function(t,n){n?e.lineTo(t[0],t[1]):e.moveTo(t[0],t[1])}),e.closePath()}}}(t.points.map(function(t){return[s(t[0]),l(t[1])]}))}).size(1),c=this.fill(u),f=this.group(),h=this.group("chart"),p=h.style("shape-rendering","crispEdges").selectAll(".segment").data(u);if(this.applyTransform(f,this.translate(a.padding.left,a.padding.top)),this.applyTransform(h,this.translate(a.margin.left+a.innerWidth/2,a.margin.top)),p.enter().append("path").attr("class","segment").attr("stroke",r.stroke).attr("stroke-opacity",0).attr("fill",c).attr("stroke-width",e.lineWidth).attr("d",d).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(p).transition().attr("stroke",r.stroke).attr("stroke-opacity",r.strokeOpacity).attr("d",d).attr("fill",c),p.exit().remove(),e.legendType){var g=n.viewExpression(e.legendLabel),m=this,v=u.map(function(t,n){return g.eval(m.getContext({d:t,value:t.value,fraction:t.fraction,label:t.data[e.label]||n}))});this.legend({scale:this.getScale("ordinal").domain(v).range(c.colors)},a)}}});qt("treemap",{requires:["d3-scale","d3-hierarchy"],options:{label:"label",field:"data",padding:2,tile:"resquarify",format:","},doDraw:function(t,e){function n(t){return[t]}function i(t){var e=void 0;return t.map(function(t){return(e=t.children)&&(t._children=i(e),delete t.children),t})}var r=this,a=this.getModel(),o=this.getModel("font"),s=this.boundingBox(),l=nt(a.label),u=nt(a.field),c=d.format(a.format),f=e.hierarchy(function(t){return t={children:i(t)},t[a.label]="root",t}(t.data)).sum(u).sort(function(t,e){return e.value-t.value}).eachBefore(function(t){t.parent?(t.data._counter=t.parent.data._counter,t.parent.data._counter++):t.data._counter=0}),h=e.treemap().tile(function(t,e,n,i){return n.substring(0,e.length)!==e&&(n=""+e+n[0].toUpperCase()+n.substring(1)),i?t[n]:t[n]()}(e,"treemap",a.tile,!0)).size([s.innerWidth,s.innerHeight]).round(!0).padding(a.padding),p=this.fill(f.children).colors,g=this.group().attr("transform",this.translate(s.total.left,s.total.top)).style("shape-rendering","crispEdges"),m=h(f).leaves(),v=g.selectAll("g").data(m),y=this;this.paper().size(s),v.exit().remove();var x=(v=v.enter().append("g").attr("transform",function(t){return r.translate(t.x0,t.y0)}).merge(v).attr("transform",function(t){return r.translate(t.x0,t.y0)})).selectAll("rect").data(n);x.enter().append("rect").attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}).attr("fill",function(t){return p[t.data._counter]}).attr("stroke","none").on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(x).transition().attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}).attr("fill",function(t){return p[t.data._counter]}),(x=v.selectAll("text").data(n)).enter().append("text").style("fill",function(t){return $e(p[t.data._counter],"#fff",o.stroke)}).selectAll("tspan").data(function(t){var e=y.font({height:Math.min(t.x1-t.x0,t.y1-t.y0)}),n=l(t.data).split(/(?=[A-Z][^A-Z])/g);return n.push(c(t.value)),n.map(function(t){return{size:e,text:t}})}).enter().append("tspan").style("font-size",function(t){return t.size}).attr("x",4).attr("y",function(t,e){return 1.5*t.size+1.2*e*t.size}).text(function(t){return t.text})}}),qt("text",{options:{label:"label",data:"data",text:'label + " " + data',sizeReduction:.7},doDraw:function(t){function e(t,e){return n.translate((e+.5)*d,0)}var n=this,i=this.getModel(),r=this.getModel("font"),a=this.boundingBox(),o=this.font(a),s=this.group(),l=this.group("chart"),u=l.selectAll("text").data(t.data),d=a.innerWidth/t.data.length,c=.4*d,f=this.dataStore,h=this.modelProperty("stroke",r);this.applyTransform(s,this.translate(a.padding.left,a.padding.top)),this.applyTransform(l,this.translate(a.margin.left,a.margin.top+a.innerHeight/2)),u.enter().append("text").attr("transform",e).attr("text-anchor","middle").attr("alignment-baseline","middle").style("fill",h).merge(u).attr("transform",e).text(function(t){return f.eval(i.text,t)}).style("fill",h).call(De,c,function(t,e){var r=o;e&&(r=i.sizeReduction*o),n.select(this).attr("font-size",r+"px")}),s.exit().remove()}}),qt("heatmap",{requires:["d3-scale","d3-axis","d3-svg-legend"],options:{shape:"square",layout:"heatmap",buckets:10,pad:.005,x:"x",y:"y",z:"data",label:null,axisX:!0,axisY:!0,reverseColors:!0,tableColors:null},doDraw:function(t){function e(t){return t.data[i.label]}function n(t){return $e(t.color,"#fff",a.stroke)}var i=this.getModel(),r=this.getModel("color"),a=this.getModel("font"),s=i.layout,l=this.boundingBox(),u=o.extent(t.data,nt(i.z));u[0]<0&&"punchcard"===s&&(s="heatmap");var d=this.heatmap(s,t,l,u),c=(l.innerWidth-d.width)/2,f=(l.innerHeight-d.height)/2,h=this.getSymbol(i.shape).size(function(t){return t.size*t.size}),p=this.group(),g=this.group("chart"),m=g.selectAll(".shape").data(d.data);if(this.applyTransform(p,this.translate(l.padding.left,l.padding.top)),this.applyTransform(g,this.translate(l.margin.left+c,l.margin.top+f)),o.range[0]<0&&"punchcard"===s&&(s="heatmap"),m.enter().append("path").classed("shape",!0).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).attr("fill",function(t){return t.color}).attr("fill-opacity",0).attr("stroke-opacity",0).attr("stroke",r.stroke).attr("d",h).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(m).transition(this.transition()).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).attr("fill-opacity",r.fillOpacity).attr("fill",function(t){return t.color}).attr("stroke-opacity",r.strokeOpacity).attr("stroke",r.stroke).attr("d",h),i.label&&"heatmap"===s){var v=this.font(l)+"px",y=g.selectAll(".labels").data(d.data);y.enter().append("text").classed("labels",!0).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).style("text-anchor","middle").style("alignment-baseline","middle").style("fill",n).style("font-size",v).text(e).merge(y).text(e).style("font-size",v).call(De,Math.ceil(.8*d.size)).transition(this.transition("text")).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).style("fill",n)}var x={innerWidth:d.width,innerHeight:d.height,margin:{top:l.margin.top+f,left:l.margin.left+c}};i.axisX&&this.xAxis1(!0===i.axisX?"bottom":i.axisX,d.scaleX,x),i.axisY&&this.yAxis1(!0===i.axisY?"left":i.axisY,d.scaleY,x),"heatmap"===s?this.legend({type:"color",shape:i.shape,scale:d.colors},l):"punchcard"===s&&this.legend({type:"size",shape:i.shape,scale:d.sizes},l)},heatmap:function(t,e,n,r){var a=this.getModel(),s=a.pad,l=a.x,u=a.y,d=a.z,c=e.dimension(a.x).group().size(),f=e.dimension(a.y).group().size(),h=Math.min(a.buckets,c*f),p=(1-s*(c+1))*n.innerWidth/c,g=(1-s*(f+1))*n.innerHeight/f,m=[],v=[],y=[],x=i.map(),b=i.map(),w=void 0,k=void 0,z=void 0,M=void 0,S=void 0,A=void 0,_=void 0,O=void 0,P=void 0,E=void 0;if(p<g?(O=p,P=n.innerWidth,E=f*(O+(s*=P))+s):(O=g,E=n.innerHeight,P=c*(O+(s*=E))+s),r=qe(r,h),"heatmap"===t){var T=this.fill(o.range(h)).colors;a.reverseColors&&(T=T.reverse()),A=this.getScale("quantile").range(T).domain(r),_=function(){return 1}}else{var W=this.colors(1)[0];A=function(){return W},_=this.getScale("quantile").range(o.range(h).map(function(t){return(t+1)/h})).domain(r)}return e.data.forEach(function(t){w=t[l],k=t[u],z=t[d],x.has(w)||(x.set(w,v.length),v.push(w)),b.has(k)||(b.set(k,y.length),y.push(k)),M=x.get(w),S=b.get(k),m.push({i:M,j:S,x:s+O/2+M*(O+s),y:s+O/2+S*(O+s),color:A(z),size:O*_(z),data:t})}),{data:m,size:O,width:P,height:E,scaleX:this.getScale("band").domain(v).range([0,P]),scaleY:this.getScale("band").domain(y).range([0,E]),colors:A,sizes:_}}}),$t.getGeoProjection=function(t){return this.getD3("geo",t)()},qt("geochart",{requires:["d3-scale","d3-geo","topojson","d3-geo-projection","d3-svg-legend"],schema:{geometry:{type:"string",description:"The geometry to visualize from the topojson geometry objects",default:"countries"},geoKey:{type:"string",default:"id"},dataKey:{type:"string",default:"id"},dataLabelKey:{type:"string",default:"label"},dataValueKey:{type:"string",default:"value"},neighbors:{type:"boolean",default:!1},buckets:{type:"number",default:10},choroplethScale:{type:"string",default:"quantile"},boundGeometry:{type:"string"},boundScaleFactor:{type:"number",default:.9},projection:{type:"string",default:"kavrayskiy7"},graticule:{type:"boolean",default:!1},leaflet:{type:"boolean",default:!1},scale:{type:"number",default:200}},doDraw:function(){var t=function(t){var e={};return"frameCollection"===t.type?t.frames.each(function(t){"Topology"===t.type?e.topology=t:"dataframe"===t.type&&(e.data=t.data)}):"Topology"===t.type&&(e.topology=t),e}(this.frame);if(!t.topology)return ht("Topojson data not available - cannot draw topology");this._geoPath||this.createGeoPath(t),this.update(t)},update:function(t){var n=this.getModel(),i=this.getModel("color"),r=this.boundingBox(),a=this.group(),s=this.group("geo"),l=this._geoPath,u=function(t,n,i){var r=i.geoKey,a=i.dataKey,s={},l=void 0,u=void 0,d=void 0;if(!n.topology)return ht("No topology object available");var c=n.topology.objects[i.geometry];if(!c)return ht("Topology object "+i.geometry+" is not available");var f=i.neighbors?t.neighbors(c.geometries):null;return l=t.feature(n.topology,c).features,n.data&&(s=n.data.reduce(function(t,e){return t[e[a]]=e,t},{})),l=l.map(function(t){return d=t.properties,u=t[r]||d[r],{id:u,type:t.type,geometry:t.geometry,data:e.assign({},d,s[u])}}),f&&l.forEach(function(t,e){t.neighbors=f[e],t.rank=o.max(t.neighbors,function(t){return l[t].rank})+1|0}),l}(this.$,t,n);if(!u){var d=Object.keys(t.topology.objects).map(function(t){return'"'+t+'"'}).join(", ");return ht('Could not find *geometry* "'+n.geometry+'" in ['+d+"] - cannot draw geochart")}a.transition(this.transition("group0")).attr("transform",this.translate(r.padding.left,r.padding.top)),s.transition(this.transition("group1")).attr("transform",this.translate(r.margin.left,r.margin.top));var c=s.selectAll(".geometry").data(u),f=this.choropleth(u,r);this.center(t),c.enter().append("path").attr("class","geometry").attr("d",l).style("fill","none").style("stroke",this.modelProperty("stroke",i)).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(c).transition(this.transition("geometry")).attr("d",l).style("stroke",this.modelProperty("stroke",i)).style("fill",f).style("fill-opacity",i.fillOpacity),c.exit().remove()},createGeoPath:function(t){var e,n=this.getModel(),i=this.getGeoProjection(n.projection).scale(n.scale),r=this.$,a=r.geoPath().projection(i),o=this;if(this._geoPath=a,this.center(t),n.leaflet){var s="leaflet-"+n.uid,l=this.paper();this.visualParent.paper.append("div").attr("id",s),(e=new r.Map(s,{center:[37.8,-96.9],zoom:4}).addLayer(new r.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"))).getPanes().overlayPane.appendChild(l.element),i=r.transform({point:function(t,n){var i=e.latLngToLayerPoint(new r.LatLng(n,t));this.stream.point(i.x,i.y)}}),e.on("viewreset",function(){return o.update(t)})}return a},center:function(t){var e=this.getModel();if(e.boundGeometry){var n=this._geoPath,i=n.projection(),r=this.boundingBox(),a=t.topology.objects[e.boundGeometry],o=a?this.$.feature(t.topology,a).features:null;if(!o)return ht('Could not find *boundGeometry* "'+e.boundGeometry+'" for centering - skip centering geochart');i.scale(1).translate([0,0]);var s=n.bounds(o[0]),l=s[0],u=s[1],d=(u[0]-l[0])/r.innerWidth,c=(u[1]-l[1])/r.innerHeight,f=Math.round(e.boundScaleFactor/Math.max(d,c)),h=[(r.innerWidth-f*(u[0]+l[0]))/2,(r.innerHeight-f*(u[1]+l[1]))/2];i.scale(f).translate(h)}},choropleth:function(t,e){var n=this.getModel(),i=n.dataLabelKey,r=n.dataValueKey,a=void 0,s=void 0,l=void 0,u=void 0;return n.neighbors?(a=nt("rank"),u=(s=o.extent(t,a))[1]+1):(a=function(t){return t.data[r]},u=Math.min(n.buckets,t.length),s=qe(o.extent(t,a),u)),l=this.getScale(n.choroplethScale).range(this.colors(u).reverse()).domain(s),this.legend({type:"color",scale:l},e),function(t){return t.label=t.data[i]||t.id,t.value=a(t),t.color=l(t.value),t.color}}});var Le=["K","M","G"].map(function(t,e){return{symbol:t,size:1<<10*(e+1)}}).reverse(),Ge={props:["url"],render:function(t,e,i){var r=this,a=this,o=this.select(i).html();return n.viewProviders.require("marked").then(function(e){if(t.url)return r.fetchText(t.url).then(function(t){return t=e(t),a.viewElement('<div class="doc">'+t+"</div>")});var n=e(o);return a.viewElement('<div class="doc">'+n+"</div>")})}},Ie=s.timeFormat("%d %b %Y, %H:%M"),Ue=["system","arch","processor","cpus","python"],Ke={model:function(){return{info:[]}},render:function(){var t=this.model;return t.dataStore.onData("benchmarks.info",function(e){t.info=function(t){var e=new Date(t.date),n=[{label:"date",value:Ie(e)}];return Ue.forEach(function(e){n.push({label:e,value:t[e]})}),n}(e.data[0])}),this.viewElement('<div class="card">\n<dic class="card-body">\n<dl class="row" d3-for="entry in info">\n    <dt class="col-sm-4" d3-html="entry.label"></dt>\n    <dd class="col-sm-8" d3-html="entry.value"></dd>\n</dl>\n</div>\n</div>')}};e.inBrowser&&window.development&&n.viewProviders.setDebug(!0),ze.set("redyellowblue",function(t){return t.scaleSequential(c.interpolateRdBu)}),e.assign(Tt.options.dataContext,{$binaryFormat:function(t){var e=d.format(t);return function(t){for(var n=0;n<Le.length;++n)if(t>=Le[n].size)return t/=Le[n].size,e(t)+Le[n].symbol+"B";return e(t)+"B"}}}),t.start=function(){n.viewReady(function(){Q().mount("body")})},t.appView=Q,Object.defineProperty(t,"__esModule",{value:!0})});