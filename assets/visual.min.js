!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-let"),require("d3-collection"),require("d3-timer"),require("d3-selection"),require("d3-dispatch"),require("d3-dsv"),require("d3-array"),require("d3-time-format"),require("d3-transition"),require("d3-format"),require("d3-scale-chromatic")):"function"==typeof define&&define.amd?define(["exports","d3-let","d3-collection","d3-timer","d3-selection","d3-dispatch","d3-dsv","d3-array","d3-time-format","d3-transition","d3-format","d3-scale-chromatic"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,r,i,o,a,s,u,l,c,d){"use strict";function f(){var t=null;return e.inBrowser&&window.d3&&(t=window.d3.require),t||function(){return Promise.reject(new Error("Cannot requires libraries, d3-require is not available"))}}function h(t){function n(t){It(this).el=t}return n.prototype=e.assign({},Bt,t),n}function p(t,n){if(e.isString(t)){if(!n)return t;var r=function(t){var n=Ft.handlebars;if(n||(n=e.inBrowser?window.handlebars:require("handlebars")),n)return n.compile(t);Lt("compile function requires handlebars")}(t);if(!r)return t;t=r}return t(n)}function g(t,e){var n=i.select(document.createElement("div"));n.html(p(t,e));var r=n.node().children;return 1!==r.length&&Lt("HtmlElement function should return one root element only, got "+r.length),r[0]}function m(t){this.response=t,this.description=t.statusText}function v(t){if(t.status>=300)throw new m(t);var e=(t.headers.get("content-type")||"").split(";")[0];if("application/json"===e)return t.json();throw new Error("Expected JSON content type, got "+e)}function y(t,e,n){return n?g(t,e):p(t,e)}function b(t,e,n){switch(e.type){case te.IDENTIFIER:return t[e.name];case te.LITERAL:return n?t[e.value]:e.value;case te.ARRAY_EXP:return e.elements.map(function(e){return b(t,e)});case te.LOGICAL_EXP:case te.BINARY_EXP:return function(t,e,n){ge[t]||(ge[t]=new Function("a","b","return a "+t+" b"));return ge[t](e,n)}(e.operator,b(t,e.left),b(t,e.right));case te.CALL_EXP:return function(t,e,n){var r;n=n.map(function(e){return b(t,e)}),e.type!==te.IDENTIFIER&&(t=b(t,e.object),e=e.property);if(!(r=t[e.name]))throw new EvalError('callable "'+e.name+'" not found in context');return r.apply(t,n)}(t,e.callee,e.arguments);case te.MEMBER_EXP:return b(b(t,e.object),e.property,!0);case te.CONDITIONAL_EXP:return b(t,e.test)?b(t,e.consequent):b(t,e.alternate);case te.UNARY_EXP:return function(t,e){pe[t]||(pe[t]=new Function("arg","return "+t+" arg"));return pe[t](e)}(e.operator,b(t,e.argument))}}function x(t,e){switch(1===arguments.length&&(e=n.set()),t.type){case te.IDENTIFIER:e.add(t.name);break;case te.ARRAY_EXP:t.elements.forEach(function(t){return x(t,e)});break;case te.LOGICAL_EXP:case te.BINARY_EXP:x(t.left,e),x(t.right,e);break;case te.CALL_EXP:x(t.callee,e),t.arguments.forEach(function(t){return x(t,e)});break;case te.MEMBER_EXP:e.add(w(t));break;case te.CONDITIONAL_EXP:x(t.test,e),x(t.consequent,e),b(t.alternate,e);break;case te.UNARY_EXP:x(t.argument,e)}return e}function w(t){return t.type===te.IDENTIFIER?t.name:w(t.object)+"."+t.property.name}function k(t){this.codes=te,this.expr=t,this.parsed=he(t)}function E(t,e,r,i){function o(e){return null===s&&(s=function(t){function e(e){E(this,e,t,!1)}return e.prototype=t,e}(t)),new s(e)}var a=n.map(),s=null;a.set("",be()),Object.defineProperties(ye(t),{$events:{get:function(){return a}},parent:{get:function(){return r}},isolated:{get:function(){return i}}}),t.$child=o,t.$update(e)}function _(t){return e.isObject(t)&&"[object d3Model]"===t.toString()}function M(t,n,r){function i(e){if(a&&(e=a.get.call(t)),e!==r){var i=t.$$name||"model";Rt("updating "+i+"."+n),t.$change(n,r).$change(),r=o(e,r)}}function o(n,r){return n===r?r:e.isArray(n)?function(t,n){_(n)&&n.$off();e.isArray(n)||(n=[]);for(var r=0;r<t.length;++r)t[r]=o(t[r],n[r]);return t}(n,r):_(r)?function(t,e){return xe(t)?(e.$update(t),e):(e.$off(),o(t))}(n,r):xe(n)?t.$new(n):n}var a;t.$events.set(n,be()),Object.defineProperty(t,n,function(){var o={get:function(){return r}};return e.isFunction(r)&&(r={get:r}),xe(r)&&e.isFunction(r.get)?(r=(a=r).get.call(t),a.reactOn?a.reactOn.forEach(function(e){t.$on(e+"."+n,i)}):Lt("reactive lazy property "+n+" does not specify 'reactOn' list or properties"),e.isFunction(a.set)&&(o.set=a.set)):o.set=i,o}()),r=o(r),t.$change(n)}function A(t,e){var n=t.$events.get(e);return!n&&t.parent?A(t.parent,e):n}function z(t,e){e?t.on("change."+e,null):t.on("change",null)}function O(t,e){E(this,t,e,!0)}function S(t){return new O(t)}function $(t,n,r){var i=3===arguments.length?n[r]:void 0;e.isFunction(i)||2===arguments.length?P(t,n).events.add(""):i instanceof S?($(t,i),(n=n.$owner(r))&&P(t,n).events.add("")):((n=n.$owner(r)||n).$isReactive(r)||n.$set(r,i),P(t,n).events.add(r))}function P(t,e){var r=t.get(e.uid);return r||(r={model:e,events:n.set()},t.set(e.uid,r)),r}function C(t,r,i){function a(r){var a=e.pop(r,"parent"),s=n.map(a?a.components:null),u=n.map(a?a.directives:i),h=o.dispatch("message","mounted"),p={};l.each(function(t,e){s.set(e,t)}),c.each(function(t,e){u.set(e,t)}),T(s,e.pop(r,"components")),j(u,e.pop(r,"directives")),Object.defineProperties(this,{name:{get:function(){return t}},components:{get:function(){return s}},directives:{get:function(){return u}},parent:{get:function(){return a}},root:{get:function(){return a?a.root:this}},cache:{get:function(){return a?a.cache:p}},props:{get:function(){return f}},uid:{get:function(){return this.model.uid}},events:{get:function(){return h}}}),this.model=e.assign({},e.isFunction(d)?d():d,e.pop(r,"model")),Me.call("component-created",void 0,this)}function s(t){return new a(t)}e.isFunction(r)&&(r={render:r});var u=e.assign({},r),l=T(n.map(),e.pop(u,"components")),c=j(n.map(),e.pop(u,"directives")),d=e.pop(u,"model"),f=e.pop(u,"props");return a.prototype=e.assign({},Qt,Ae,u),s.prototype=a.prototype,s}function T(t,e){return n.map(e).each(function(e,n){t.set(n,C(n,e,Ae))}),t}function j(t,e){return n.map(e).each(function(e,n){t.set(n,Ee(e))}),t}function D(t,e,n){return Object.defineProperty(It(t),"el",{get:function(){return e}}),t.select(e).view(t).mount(null,n).then(function(){return function(t,e){var n=t.parent;t.childrenMounted(),n&&!n.isMounted?n.events.on("mounted."+t.uid,function(){N(t,e)}):N(t,e)}(t,n)})}function N(t,e){return void 0===t.isMounted?(t.isMounted=!1,!1):(t.isMounted?Lt("view "+t.name+" already mounted"):(t.isMounted=!0,t.mounted(),e&&e(t),t.events.call("mounted",void 0,t,e),t.events.on("mounted",null),Me.call("component-mounted",void 0,t)),!0)}function q(){this.attrs={},this.all=[]}function R(t,e,n,r){if(t&&t.tagName){var i=e.components.get(t.tagName.toLowerCase()),o=Oe(t,e.directives),a=o.preMount();if(a)return a.execute(e.model);var s=void 0;return s=i?[i({parent:e}).mount(t,n,r)]:we(t.children).map(function(t){return R(t,e,n,r)}),Promise.all(s).then(function(){return o.execute(e.model)})}}function F(){var t=this.__d3_directives__,e=this.__d3_view__;t&&(t.all.forEach(function(t){return t.destroy()}),delete this.__d3_directives__),e&&(e.destroy(),delete this.__d3_view__)}function L(){document.removeEventListener("DOMContentLoaded",L),window.removeEventListener("load",L),W()}function W(){for(var t=void 0;Ft.readyCallbacks.length;)t=Ft.readyCallbacks.shift(),r.timeout(t)}function X(t){var n=this.model.data.children;if(n){if(!e.isArray(n))return De("children should be an array of fields, for "+(void 0===n?"undefined":Fe(n))),t;t.selectAll(".d3form").data(n).enter().append(Y).classed("d3form",!0)}return t}function Y(t){var e=function(t){var e=t.type||"text";return Le[e]||e}(t);return e||(De("Could not find form component "+t.type),e="input",t.type="hidden"),document.createElement("d3-form-"+e)}function H(t){var e=t.attr("min"),n=t.attr("max");return e=null===e?-1/0:+e,n=null===n?1/0:+n,[e,n]}function I(t,e,n){var r=Qe[n.attr("type")]||Qe[n.node().tagName.toLowerCase()];if(!r)return e;var i=void 0;return r.forEach(function(r){(i=Qe.wrappers[r])?e=i(t,e,n):De("Could not find form field wrapper "+r)}),e}function B(t,n){!e.isArray(t)&&arguments.length||(t={store:n,data:t||[],dimensions:{}}),Object.defineProperties(this,{_inner:{get:function(){return t}},store:{get:function(){return t.store}},data:{get:function(){return t.data}},dimensions:{get:function(){return t.dimensions}},type:{get:function(){return"dataframe"}}})}function V(t){var e=(t.headers.get("content-type")||"").split(";")[0];return un.has(e)?t.text().then(a.csvParse):"text/tab-separated-values"===e?t.text().then(a.tsvParse):"application/json"===e?t.json():(an("Cannot load content type '"+e+"'"),[])}function G(t){this.frames=n.map(),Object.defineProperties(this,{store:{get:function(){return t}},type:{get:function(){return"frameCollection"}}})}function U(t,e){return t.reduce(function(t,n){return void 0!==e(n)&&(t+=1),t},0)}function K(t,n,r){if(e.isArray(r)?t=t.new(r):r&&(t=r),n.length){var i=n.splice(0,1)[0],o=i?i(t):null;return e.isPromise(o)?o.then(function(e){return K(t,n,e)}):K(t,n,o)}return t}function J(t){var r=n.map();Object.defineProperties(this,{sources:{get:function(){return r}}}),this.transforms=e.assign({},Mn),this.dataCount=0,this.model=t&&e.isFunction(t.$child)?t:S(t)}function Z(t,e){return"string"==typeof t&&t.indexOf("%")===t.length-1?Sn(.01*parseFloat(t)*e):+t}function Q(t,e){var n={width:e.width,height:e.height};return n.width||(n.width=function(t){var e=tt(t,"width");if(e)return function(t){var e=t.getBoundingClientRect().width,n=i.select(t),r=et(n.style("padding-left")),o=et(n.style("padding-right"));return e-r-o}(e)}(t),n.width?n.widthElement=function(t){return tt(t,"width")}(t):n.width=$n),n.height||(n.height=function(t){var e=tt(t,"width");if(e)return function(t){var e=t.getBoundingClientRect().height,n=i.select(t),r=et(n.style("padding-top")),o=et(n.style("padding-bottom"));return e-r-o}(e)}(t),n.height?n.heightElement=function(t){return tt(t,"height")}(t):n.height=Pn),n.height=wn(Z(n.height,n.width),void 0,window.innerHeight),n}function tt(t,e){for(var n=t.node?t.node():t;n&&"BODY"!==n.tagName;){if(n.getBoundingClientRect()[e])return n;n=n.parentNode}}function et(t){return t&&"px"==t.substring(t.length-2)?+t.substring(0,t.length-2):0}function nt(t){if(e.isArray(t))return t.map(nt);if(e.isObject(t)){var n={};for(var r in t)n[r]=nt(t[r]);return n}return t}function rt(t){var e={},n=void 0,r=void 0,i=void 0;for(i in t)(r=t[i]).$ref&&(r=function(t){var e=t.split("/");return Tn.schema.definitions[e[e.length-1]]||{}}(r.$ref)),n=r.default,e[i]=void 0===n?null:n;return e}function it(){var t=this.__visual__;t?(t.destroy(),Rt('Removed "'+t.toString()+'" from DOM, '+Tn.live.length+" live visuals left")):gn("d3-visual without __visual__ object")}function ot(t,n){function r(e,n){var r=this.initialise(e,n);Object.defineProperties(this,{element:{get:function(){return r}},sel:{get:function(){return this.select(r)}},paperType:{get:function(){return t}}})}return r.prototype=e.assign({},Qt,Ln,n),Tn.papers[t]=r,r}function at(t,n){var r=n.options[t];void 0===r||e.isObject(r)||(n.options[t]=ct(r||0))}function st(t,e,n){return Bn.reduce(function(r,i){return r[i]=Z(t[i],Vn.indexOf(i)>-1?e:n),r},{})}function ut(t){delete t.__boundingBox,e.isArray(t.layers)&&t.layers.forEach(ut)}function lt(){return{width:this.innerWidth,height:this.innerHeight,margin:ct(0),padding:ct(0),total:ct(0),innerWidth:this.innerWidth,innerHeight:this.innerHeight,$nomargins:this.$nomargins}}function ct(t){return{left:t,right:t,top:t,bottom:t}}function dt(t,e,n){t.select("path.domain").attr("stroke",e.stroke);var r=t.selectAll("text").attr("fill",e.stroke);if(e.hide){var i=n.range();Math.abs(i[0]-i[i.length-1])<e.hide?t.style("opacity",0):t.style("opacity",1)}e.rotate&&r.attr("transform","rotate("+e.rotate+")").style("text-anchor",e.ancor)}function ft(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ht(){}function pt(t){var e;return t=(t+"").trim().toLowerCase(),(e=Qn.exec(t))?(e=parseInt(e[1],16),new yt(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1)):(e=tr.exec(t))?gt(parseInt(e[1],16)):(e=er.exec(t))?new yt(e[1],e[2],e[3],1):(e=nr.exec(t))?new yt(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=rr.exec(t))?mt(e[1],e[2],e[3],e[4]):(e=ir.exec(t))?mt(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=or.exec(t))?bt(e[1],e[2]/100,e[3]/100,1):(e=ar.exec(t))?bt(e[1],e[2]/100,e[3]/100,e[4]):sr.hasOwnProperty(t)?gt(sr[t]):"transparent"===t?new yt(NaN,NaN,NaN,0):null}function gt(t){return new yt(t>>16&255,t>>8&255,255&t,1)}function mt(t,e,n,r){return r<=0&&(t=e=n=NaN),new yt(t,e,n,r)}function vt(t){return t instanceof ht||(t=pt(t)),t?(t=t.rgb(),new yt(t.r,t.g,t.b,t.opacity)):new yt}function yt(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function bt(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new wt(t,e,n,r)}function xt(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof wt)return new wt(t.h,t.s,t.l,t.opacity);if(t instanceof ht||(t=pt(t)),!t)return new wt;if(t instanceof wt)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new wt(a,s,u,t.opacity)}(t):new wt(t,e,n,null==r?1:r)}function wt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function kt(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function Et(t){if(t instanceof _t)return new _t(t.l,t.a,t.b,t.opacity);if(t instanceof $t){var e=t.h*ur;return new _t(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof yt||(t=vt(t));var n=Ot(t.r),r=Ot(t.g),i=Ot(t.b),o=Mt((.4124564*n+.3575761*r+.1804375*i)/cr),a=Mt((.2126729*n+.7151522*r+.072175*i)/dr);return new _t(116*a-16,500*(o-a),200*(a-Mt((.0193339*n+.119192*r+.9503041*i)/fr)),t.opacity)}function _t(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function Mt(t){return t>mr?Math.pow(t,1/3):t/gr+hr}function At(t){return t>pr?t*t*t:gr*(t-hr)}function zt(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ot(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function St(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof $t)return new $t(t.h,t.c,t.l,t.opacity);t instanceof _t||(t=Et(t));var e=Math.atan2(t.b,t.a)*lr;return new $t(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}(t):new $t(t,e,n,null==r?1:r)}function $t(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function Pt(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof Ct)return new Ct(t.h,t.s,t.l,t.opacity);t instanceof yt||(t=vt(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(_r*r+kr*e-Er*n)/(_r+kr-Er),o=r-i,a=(wr*(n-i)-br*o)/xr,s=Math.sqrt(a*a+o*o)/(wr*i*(1-i)),u=s?Math.atan2(a,o)*lr-120:NaN;return new Ct(u<0?u+360:u,s,i,t.opacity)}(t):new Ct(t,e,n,null==r?1:r)}function Ct(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Tt(t){this.vertical=!0,this.init(t),this.sx.rangeRound([0,this.box.innerWidth]),this.sy.rangeRound([this.box.innerHeight,0])}function jt(t){this.init(t),this.sx.rangeRound([0,this.box.innerHeight]),this.sy.rangeRound([0,this.box.innerWidth])}function Dt(t,e,n,r){this.data=t,this.stacked=r,this.x=e,this.y=n}function Nt(){var t=Ce().use(Ze).use(tn).use(Dr);return Me.on("component-mounted",function(t){"d3form"===t.name&&t.model.$on(function(){})}),t}var qt="[d3-view-debug]",Rt=function(t){Ft.logger.debug&&Ft.logger.debug(t)};e.logger.debug=null;var Ft={logger:e.logger,fetch:function(){if(e.inBrowser)return window.fetch}(),readyCallbacks:[],setDebug:function(t){!arguments.length||t?this.logger.debug=e.isFunction(t)?t:function(t){Ft.logger.info(qt+" "+t)}:this.logger.debug=null},require:f()},Lt=function(t){Ft.logger.warn("[d3-view] "+t)},Wt=n.map({disabled:"disabled",readonly:"readOnly",required:"required"}),Xt={create:function(t){return this.arg?t:Lt("Cannot bind to empty attribute. Specify :<attr-name>")},refresh:function(t,n){if("class"===this.arg)return this.refreshClass(n);if(e.isArray(n))return Lt("Cannot apply array to attribute "+this.arg);var r=Wt.get(this.arg);r?this.sel.property(r,n||!1):this.sel.attr(this.arg,n||null)},refreshClass:function(t){var n=this.sel;e.isArray(t)||(t=[t]),this.oldValue&&this.oldValue.forEach(function(t){t&&n.classed(t,!1)}),this.oldValue=t.map(function(t){var r=!0;return e.isArray(t)&&(r=t[1],t=t[0]),t&&n.classed(t,r),t})}},Yt={refresh:function(t,n){if(e.isNumber(n)&&(n=""+n),e.isString(n)){var r=this,i=this.sel,o=this.passes?this.transition(i):null;o?o.style("opacity",0).on("end",function(){i.html(n),r.selectChildren().mount(),r.transition(i).style("opacity",1)}):(i.html(n),this.selectChildren().mount())}}},Ht=function(t,e){function n(){if(null!==i)return i;var n=this,o=arguments;return i=new Promise(function(a,s){r.timeout(function(){i=null;try{a(t?t.apply(n,o):void 0)}catch(t){s(t)}},e)})}var i=null;return n.promise=function(){return i},n},It=function(t){return Object.defineProperty(t,"sel",{get:function(){return i.select(this.el)}}),t},Bt={on:function(t,e){var n=function(t,e,n){return Ht(function(){e.$set(n,t.value())})}(this,t,e);this.sel.on("input",n).on("change",n)},off:function(){this.sel.on("input",null).on("change",null)},value:function(t){if(!arguments.length)return this.sel.property("value");this.sel.property("value",t)}},Vt=h(),Gt=h({value:function(t){if(!arguments.length)return this.sel.property("checked");this.sel.property("checked",t)}}),Ut={input:Vt,textarea:Vt,select:h({value:function(t){var n,r=this.sel,o=r.selectAll("option"),a=t;if(!arguments.length)return a=[],o.each(function(){(n=i.select(this)).property("selected")&&a.push(n.attr("value")||"")}),r.property("multiple")?a:a[0]||"";e.isArray(a)||(a=[t||""]),o.each(function(){n=i.select(this),t=n.attr("value")||"",n.property("selected",a.indexOf(t)>-1)})}}),checkbox:Gt},Kt={create:function(t){var e=this.sel.attr("type"),n=this.el.tagName.toLowerCase(),r=Ut[e]||Ut[n];return r?(this.tag=new r(this.el),t):Lt("Cannot apply d3-value directive to "+n)},mount:function(t){var e=this.expression;if(e.parsed.type!==e.codes.IDENTIFIER)return Lt('d3-value expression support identifiers only, got "'+e.parsed.type+'": '+this.expression);var n=this.expression.expr;return t.$set(n,this.tag.value()),this.tag.on(t,n),t},refresh:function(t,e){this.tag.value(e)},destroy:function(){this.tag.off()}};m.prototype=Error.prototype;var Jt=function(t){return t&&!e.isFunction(t.size)?i.select(t):t},Zt={isd3:!0,providers:Ft,viewElement:g,select:function(t){return i.select(t)},selectAll:function(t){return i.selectAll(t)},createElement:function(t){return i.select(document.createElement(t))},fetch:function(t,e){var n=Ft.fetch;return 1==arguments.length?n(t):n(t,e)},fetchText:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.fetch.apply(this,[t].concat(n)).then(function(t){return t.text()})},json:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.fetch.apply(this,[t].concat(n)).then(v)},renderFromUrl:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.cache;return t in r?Promise.resolve(y(r[t],e,n)):this.fetchText(t).then(function(i){return r[t]=i,y(i,e,n)})},on:function(t,e,n){if(t=Jt(t),null===n)return t.on(e,null);t.on(e,function(){return n(i.event)})},selectChildren:function(t){return arguments.length||(t=this.el),this.selectAll(Array.prototype.slice.call(t.children))},domEvent:function(){return i.event}};Ft.transition={duration:0};var Qt=e.assign(Zt,{transition:function(t){arguments.length||(t=this.sel);var e=this.transitionDuration(t);if(e>0)return t.transition(this.uid).duration(e)},transitionDuration:function(t){if(arguments.length||(t=this.sel),t&&e.isFunction(t.transition)&&t.size()){var n=t.attr("data-transition-duration");return+(null===n?Ft.transition.duration:n)}return 0}}),te={COMPOUND:"Compound",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",LOGICAL_EXP:"LogicalExpression",CONDITIONAL_EXP:"ConditionalExpression",ARRAY_EXP:"ArrayExpression"},ee=function(t,e){var n=new Error(t+" at character "+e);throw n.index=e,n.description=t,n},ne={"-":!0,"!":!0,"~":!0,"+":!0},re={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},ie=function(t){var e,n=0;for(var r in t)(e=r.length)>n&&t.hasOwnProperty(r)&&(n=e);return n},oe=ie(ne),ae=ie(re),se={true:!0,false:!1,null:null},ue=function(t){return re[t]||0},le=function(t,e,n){return{type:"||"===t||"&&"===t?te.LOGICAL_EXP:te.BINARY_EXP,operator:t,left:e,right:n}},ce=function(t){return t>=48&&t<=57},de=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=128&&!re[String.fromCharCode(t)]},fe=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t>=128&&!re[String.fromCharCode(t)]},he=function(t){for(var e,n,r=0,i=t.charAt,o=t.charCodeAt,a=function(e){return i.call(t,e)},s=function(e){return o.call(t,e)},u=t.length,l=function(){for(var t=s(r);32===t||9===t;)t=s(++r)},c=function t(){var e,n,i=f();return l(),63!==s(r)?i:(r++,(e=t())||ee("Expected expression",r),l(),58===s(r)?(r++,(n=t())||ee("Expected expression",r),{type:te.CONDITIONAL_EXP,test:i,consequent:e,alternate:n}):void ee("Expected :",r))},d=function(){l();for(var e=t.substr(r,ae),n=e.length;n>0;){if(re.hasOwnProperty(e))return r+=n,e;e=e.substr(0,--n)}return!1},f=function(){var t,e,n,i,o,a,s,u;if(a=h(),!(e=d()))return a;for(o={value:e,prec:ue(e)},(s=h())||ee("Expected expression after "+e,r),i=[a,o,s];(e=d())&&0!==(n=ue(e));){for(o={value:e,prec:n};i.length>2&&n<=i[i.length-2].prec;)s=i.pop(),e=i.pop().value,a=i.pop(),t=le(e,a,s),i.push(t);(t=h())||ee("Expected expression after "+e,r),i.push(o,t)}for(t=i[u=i.length-1];u>1;)t=le(i[u-1].value,i[u-2],t),u-=2;return t},h=function e(){var n,i,o;if(l(),n=s(r),ce(n)||46===n)return p();if(39===n||34===n)return g();if(de(n)||40===n)return y();if(91===n)return x();for(o=(i=t.substr(r,oe)).length;o>0;){if(ne.hasOwnProperty(i))return r+=o,{type:te.UNARY_EXP,operator:i,argument:e(),prefix:!0};i=i.substr(0,--o)}return!1},p=function(){for(var t,e,n="";ce(s(r));)n+=a(r++);if(46===s(r))for(n+=a(r++);ce(s(r));)n+=a(r++);if("e"===(t=a(r))||"E"===t){for(n+=a(r++),"+"!==(t=a(r))&&"-"!==t||(n+=a(r++));ce(s(r));)n+=a(r++);ce(s(r-1))||ee("Expected exponent ("+n+a(r)+")",r)}return e=s(r),de(e)?ee("Variable names cannot start with a number ("+n+a(r)+")",r):46===e&&ee("Unexpected period",r),{type:te.LITERAL,value:parseFloat(n),raw:n}},g=function(){for(var t,e="",n=a(r++),i=!1;r<u;){if((t=a(r++))===n){i=!0;break}if("\\"===t)switch(t=a(r++)){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+="\\"+t}else e+=t}return i||ee('Unclosed quote after "'+e+'"',r),{type:te.LITERAL,value:e,raw:n+e+n}},m=function(){var e,n=s(r),i=r;for(de(n)?r++:ee("Unexpected "+a(r),r);r<u&&(n=s(r),fe(n));)r++;return e=t.slice(i,r),se.hasOwnProperty(e)?{type:te.LITERAL,value:se[e],raw:e}:"this"===e?{type:te.THIS_EXP}:{type:te.IDENTIFIER,name:e}},v=function(t){for(var e,n,i=[],o=!1;r<u;){if(l(),(e=s(r))===t){o=!0,r++;break}44===e?r++:((n=c())&&n.type!==te.COMPOUND||ee("Expected comma",r),i.push(n))}return o||ee("Expected "+String.fromCharCode(t),r),i},y=function(){var t,e;for(e=40===(t=s(r))?b():m(),l(),t=s(r);46===t||91===t||40===t;)r++,46===t?(l(),e={type:te.MEMBER_EXP,computed:!1,object:e,property:m()}):91===t?(e={type:te.MEMBER_EXP,computed:!0,object:e,property:c()},l(),93!==(t=s(r))&&ee("Unclosed [",r),r++):40===t&&(e={type:te.CALL_EXP,arguments:v(41),callee:e}),l(),t=s(r);return e},b=function(){r++;var t=c();if(l(),41===s(r))return r++,t;ee("Unclosed (",r)},x=function(){return r++,{type:te.ARRAY_EXP,elements:v(93)}},w=[];r<u;)59===(e=s(r))||44===e?r++:(n=c())?w.push(n):r<u&&ee('Unexpected "'+a(r)+'"',r);return 1===w.length?w[0]:{type:te.COMPOUND,body:w}};he.addUnaryOp=function(t){return oe=Math.max(t.length,oe),ne[t]=!0,this},he.addBinaryOp=function(t,e){return ae=Math.max(t.length,ae),re[t]=e,this},he.addLiteral=function(t,e){return se[t]=e,this},he.removeUnaryOp=function(t){return delete ne[t],t.length===oe&&(oe=ie(ne)),this},he.removeBinaryOp=function(t){return delete re[t],t.length===ae&&(ae=ie(re)),this},he.removeLiteral=function(t){return delete se[t],this};var pe={},ge={};k.prototype={eval:function(t){return b(t,this.parsed)},safeEval:function(t){try{return b(t,this.parsed)}catch(t){Lt("Could not evaluate <<"+this.expr+">> expression: "+t)}},identifiers:function(){return x(this.parsed).values()}};var me=function(t){return new k(t)},ve=0,ye=function(t){var e="d3v"+ ++ve;return arguments.length?(Object.defineProperty(t,"uid",{get:function(){return e}}),t):e},be=function(){var t=o.dispatch("change"),e=0;return{on:function(e,n){return arguments.length<2?t.on(e):(t.on(e,n),this)},trigger:Ht(function(){t.apply("change",this,arguments),e+=1}),triggered:function(){return e}}},xe=function(t){return t&&t.constructor===Object},we=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.prototype.slice.call(t,e)};S.prototype=O.prototype={constructor:O,toString:function(){return"[object d3Model]"},$on:function(t,n){1===arguments.length&&e.isFunction(t)&&(n=t,t="");var r=t.split("."),i=r[0],o=A(this,i);return o?(this.$events.get(i)||r.push(this.uid),r[0]="change",o.on(r.join("."),n)):Lt('Cannot bind to "'+i+'" - no such reactive property')},$change:function(t){var e=arguments.length?t:"",n=this.$events.get(e),r=we(arguments,1);return n?n.trigger.apply(this,r):this.isolated?Lt("attribute '"+e+"' is not a reactive property this model"):this.parent.$change(e),this},$update:function(t,e){if(t){e=2!==arguments.length||e;for(var n in t)(e||void 0===this[n])&&("$"===n.substring(0,1)?this.constructor.prototype[n]?Lt("Cannot set attribute method "+n+", it is protected"):this[n]=t[n]:this.$set(n,t[n]))}return this},$set:function(t,e){this.$events.get(t)?this[t]=e:M(this,t,e)},$new:function(t){return new O(t,this)},$off:function(t){if(void 0===t)this.$events.each(function(t){return z(t)});else{var e=t.split("."),n=e.splice(0,1)[0],r=this.$events.get(n);r&&z(r,e.join("."))}},$isReactive:function(t){return!!this.$events.has(t)||!(!this.parent||this.isolated)&&this.parent.$isReactive(t)},$owner:function(t){if(!this.$events.has(t)){if(!this.parent||this.isolated)return;return this.parent.$owner(t)}return this},$push:function(t,e){var n=this[t].slice();return n.push(e),this[t]=n,this},$splice:function(t,e,n){var r=this[t].slice();return 2==arguments.length?r.splice(e):3==arguments.length&&r.splice(e,n),this[t]=r,this}},Object.defineProperty(O.prototype,"root",{get:function(){return this.parent?this.parent.root:this}});var ke={create:function(t){return t},preMount:function(){},mount:function(t){return t},refresh:function(){},destroy:function(){},removeAttribute:function(){this.el.removeAttribute(this.name)},execute:function(t){this.active&&(this.removeAttribute(),this.identifiers=[],(t=this.mount(t))&&this.bindModel(t))},bindModel:function(t){var r=this,i=function(){var e=r.expression?r.expression.eval(t):void 0;r.refresh(t,e),r.passes++},o=void 0,a=void 0,s=void 0,u=void 0;if(this.expression){var l=n.map();this.expression.identifiers().forEach(function(n){for(o=n.split("."),a=t,s=null,u=0;u<o.length-1;++u)if(a=a[o[u]],!e.isObject(a)){s=o.slice(0,u+1).join("."),Lt("Property "+s+" is not an object. Directive "+r.name+" cannot bind to "+n);break}if(null===s){if(!(a instanceof S))return Lt(n+" is not a reactive model. Directive "+r.name+" cannot bind to it");$(l,a,o[o.length-1])}}),l.each(function(t){t.events.has("")?r.identifiers.push({model:t.model,attr:""}):t.events.each(function(e){r.identifiers.push({model:t.model,attr:e})})})}else r.identifiers.push({model:t,attr:""});this.identifiers.forEach(function(t){var e=t.attr+"."+r.uid;t.model.$on(e,i)}),this.bindDestroy(t),i()},bindDestroy:function(t){var e=this,n=this,r=this.destroy;n.destroy=function(){return r.call(n,t)},this.sel.on("remove."+n.uid,function(){e.identifiers.forEach(function(t){t.model.$off(t.attr+"."+n.uid)}),n.destroy()})}},Ee=function(t){function n(t,e,n){this.el=t,this.name=e.name,this.arg=n,this.passes=0;var r=It(ye(this)).create(e.value);r&&(this.expression=me(r)),this.active||(this.active=!e.value||this.expression)}function r(t,e,r){return new n(t,e,r)}return n.prototype=e.assign({},Qt,ke,t),r.prototype=n.prototype,r},_e=function(t){if(e.isString(t))try{return JSON.parse(t)}catch(e){return t}return t},Me=o.dispatch("message","component-created","component-mount","component-mounted"),Ae={render:function(){},childrenMounted:function(){},mounted:function(){},destroy:function(){},mount:function(t,n,r){var i=this;if(!N(this)){Me.call("component-mount",void 0,this,t,n);var o=this.select(t),a=o.directives(),s=a?a.attrs:function(t){for(var e={},n=void 0,r=0;r<t.attributes.length;++r)e[(n=t.attributes[r]).name]=n.value;return e}(t),u=this.parent.model,l=o.datum(),c=this.props,d=this.model,f=e.assign(function(t){var n=void 0;return Object.keys(t).reduce(function(r,i){return"data-"===i.substring(0,5)&&(r[n=i.split("-").splice(1).reduce(function(t,e,n){return t+=n?e.substring(0,1).toUpperCase()+e.substring(1):e},"")]=e.pop(t,i)),r},{})}(s),l,n),h=void 0,p=void 0;n=e.assign({},l,n);for(h in d)void 0!==(p=e.pop(f,h))&&(e.isString(p)?u.$isReactive(p)?p!==h?d[h]=function(t){return{reactOn:[t],get:function(){return this[t]}}}(p):delete d[h]:d[h]=_e(p):d[h]=p);this.model=d=u.$child(d),d.$$view=this,d.$$name=this.name,e.isArray(c)&&(c=c.reduce(function(t,e){return t[e]=void 0,t},{})),e.isObject(c)&&Object.keys(c).forEach(function(t){void 0!==(p=_e(void 0===f[t]?void 0===n[t]?s[t]:n[t]:f[t]))?(e.isString(p)&&d[p]&&(p=d[p]),n[t]=p):void 0!==c[t]&&(n[t]=c[t])});var g=this.render(n,s,t);return g.then||(g=Promise.resolve(g)),g.then(function(e){return function(t,e,n,r){return n?(1!==(n=Jt(n)).size()&&Lt("render function must return a single HTML node"),n=n.node(),e.parentNode.insertBefore(n,e),t.select(e).remove(),D(t,n,r)):Lt("render function must return a single HTML node. It returned nothing!")}(i,t,e,r)})}Lt("already mounted")}},ze=["name","class","disabled","readonly","required","href"],Oe=function(t,e){var n=i.select(t),r=n.directives();if(r)return r;if(r=new q,!e)return r;for(var o=0;o<t.attributes.length;++o){var a=t.attributes[o],s=a.name.split("-"),u="d3"===s[0]?s[1]:null,l=void 0;if(u){!(l=s.slice(2).join("-"))&&ze.indexOf(u)>-1&&(l=u,u="attr");var c=e.get(u);c?r.add(c(t,a,l)):Lt(t.tagName+' cannot find directive "'+u+'". Did you forget to register it?')}r.attrs[a.name]=a.value}return r.size()&&n.directives(r),r};q.prototype={size:function(){return this.all.length},pop:function(t){var e=this.all.indexOf(t);return e>-1&&(t.removeAttribute(),this.all.splice(e,1)),t},add:function(t){this.all.push(t)},forEach:function(t){this.all.forEach(t)},preMount:function(){for(var t=void 0,e=0;e<this.all.length;++e)if((t=this.all[e]).preMount())return this.pop(t)},execute:function(t){if(this.size())return Promise.all(this.all.map(function(e){return e.execute(t)}))}},i.selection.prototype.mount=function(t,e){var n=[];return this.each(function(){var r=i.select(this).view();r?n.push(R(this,r,t,e)):Lt("Cannot mount, no view object available to mount to")}),Promise.all(n)},i.selection.prototype.view=function(t){if(arguments.length)return this.property("__d3_view__",t);for(var e=this.node(),n=e?e.__d3_view__:null,r=e?e.parentNode:null;r&&!n;)n=r.__d3_view__,r=r.parentNode;return n},i.selection.prototype.model=function(){var t=this.view();return t?t.model:null},i.selection.prototype.directives=function(t){return arguments.length?this.property("__d3_directives__",t):this.node().__d3_directives__};var Se={use:function(t){return e.isObject(t)?t.install(this):t(this),this},addComponent:function(t,e){var n=C(t,e);return this.components.set(t,n),n},addDirective:function(t,e){var n=Ee(e);return this.directives.set(t,n),n},mount:function(t,n){if(N(this))Lt("already mounted");else if(Me.call("component-mount",void 0,this,t),t=function(t){if(!t)return Lt("element not defined, pass an identifier or an HTMLElement object");var n=(e.isFunction(t.node)?t:i.select(t)).node();if(n)return n;Lt("could not find "+t+" element")}(t))return this.model=this.parent?this.parent.model.$child(this.model):S(this.model),D(this,t,n)}},$e={attr:Xt,html:Yt,value:Kt,on:{mount:function(t){var e=this.arg||"click",n=this.expression;this.on(this.sel,e+"."+this.uid,function(e){var r=t.$child();r.$event=e,n.eval(r)}),this.bindDestroy(t)},destroy:function(){var t=this.arg||"click";this.on(this.sel,t+"."+this.uid,null)}},for:{create:function(t){var e=[];return t.trim().split(" ").forEach(function(t){t&&e.push(t)}),3!==e.length||"in"!=e[1]?Lt('d3-for directive requires "item in expression" template, got "'+t+'"'):(this.itemName=e[0],this.itemClass="for"+this.uid,e[2])},preMount:function(){return!0},mount:function(t){if(this.creator=this.el,this.el=this.creator.parentNode,i.select(this.creator).remove(),this.el)return t},refresh:function(t,n){if(e.isArray(n)){var r=void 0,i=this.creator,o=i.tagName+"."+this.itemClass,a=this.itemName,s=this.sel,u=s.selectAll(o),l=u.filter(function(){return r=this.__d3_view__.model[a],n.indexOf(r)>-1}).data(n),c=u.filter(function(){return r=this.__d3_view__.model[a],-1===n.indexOf(r)}),d=C("forView",Se),f=s.view(),h=void 0,p=void 0,g=void 0,m=void 0;(this.transition(c)||c).style("opacity",0).remove(),l.enter().append(function(){return p=i.cloneNode(!0),g=f.select(p),f.transitionDuration(g)>0&&g.style("opacity",0),p}).classed(this.itemClass,!0).each(function(t,e){(h={index:e})[a]=t,d({model:h,parent:f}).mount(this,function(t){n[e]=t.model[a],(m=t.transition())&&m.style("opacity",1)})}).merge(l).each(function(t){this.__d3_view__.model[a]=t})}}},if:{mount:function(t){var e=this.sel;return this.display=e.style("display"),this.display&&"none"!==this.display||(this.display="block"),t},refresh:function(t,e){var n=this.sel,r=this.passes?this.transition(n):null;e?n.style("display",this.display):r||n.style("display","none"),r&&(e?r.style("opacity",1):r.style("opacity",0).on("end",function(){return n.style("display","none")}))}}};if(e.inBrowser){new MutationObserver(function(t){t.forEach(function(t){var e=t.removedNodes,n=void 0;if(e&&e.length)for(var r=0;r<e.length;++r)(n=i.select(e[r])).view()&&(n.selectAll("*").each(F),F.call(e[r]))})}).observe(document.documentElement,{childList:!0,subtree:!0})}var Pe=j(n.map(),$e),Ce=function(t){return C("view",Se,Pe)(t)},Te=function(t){Ft.readyCallbacks.push(t),"complete"!==document.readyState?(document.addEventListener("DOMContentLoaded",L),window.addEventListener("load",L)):W()},je={logger:e.logger},De=function(t){je.logger.warn("[d3-form] "+t)},Ne=n.map({disabled:"disabled",readonly:"readOnly",required:"required"}),qe={inputData:function(t,n){var r=this.model;return n||(n={}),n.id=n.id||r.uid,r.data=n,t.attr("id",n.id),n.classes&&t.classed(n.classes,!0),function(t,n,r){var i,o,a;if(e.isObject(r))for(o in r)i=r[o],e.isObject(i)&&("d3-"===o.substring(0,3)?(a=o.replace("-","_"),n.$set(a,i),i=a):i=JSON.stringify(i)),t.attr(o,i||"")}(t,r,n.attributes),Ne.each(function(r,i){var o=n[i];o&&(e.isString(o)?t.attr("d3-attr-"+i,o):t.property(r,!0))}),n},wrap:function(t){var e=this,n=t;return e.model.$formExtensions.forEach(function(r){n=r(e,n,t)||n}),n},wrapTemplate:function(t,e){var n=document.createElement("div"),r=i.select(n).html(e).select("slot");if(!r.size())return De("template does not provide a slot element"),t;var o=i.select(r.node().parentNode);return t.nodes().forEach(function(t){o.insert(function(){return t},"slot")}),r.remove(),i.selectAll(n.children)}},Re=e.assign({},qe,{model:{value:null,error:"",isDirty:null,changed:!1,srOnly:!1,placeholder:"",showError:{reactOn:["error","isDirty"],get:function(){return!!this.error&&this.isDirty}},$validate:function(){}},inputData:function(t,e){if(!(e=qe.inputData.call(this,t,e)).name)return De("Input field without a name");t.attr("name",e.name),e.placeholder=e.placeholder||e.label||e.name;var n=this.model;return n.form.inputs[e.name]=n,n.name=e.name,n.$on("value",function(){null===n.isDirty?n.isDirty=!1:(n.isDirty=!0,n.changed=!0),n.form.$change()}),e}}),Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Le={text:"input",email:"input",password:"input",checkbox:"input",number:"input",date:"input",url:"input","datetime-local":"input"},We=e.assign({},qe,{render:function(t){var e=t?t.tag||"fieldset":"fieldset",n=this.createElement(e);return t=this.inputData(n,t),X.call(this,n)}}),Xe={get:function(t){var n=this.all.slice(0);if(e.isObject(t))for(var r in t)n.push(function(t,e){return{set:function(e,n){n[t]},validate:function(t,n){return e(t,n)}}}(r,t[r]));return n},set:function(t,e){var n=t.model;n._view=t,n.validators.forEach(function(t){return t.set(e,n.data)}),n.$on("value.validate",this.validate),n.$validate=this.validate},validate:function(){for(var t,e,n=this._view,r=this.validators,i=this.value,o=n.sel.attr("id")===this.data.id?n.sel:n.sel.select("#"+this.data.id),a=0;a<r.length;++a)if(t=r[a],e=t.validate(o,i)){!0===e&&(e="");break}this.error=e||""},all:[{set:function(t,n){var r=n.required;e.isString(r)?t.attr("d3-required",r):t.property("required",r||!1)},validate:function(t,e){if(t.property("required")){if(!e)return"required";if(""===e)return!0}}},{set:function(t,n){var r=n.minLength;e.isString(r)?t.attr("d3-attr-minlength",r):void 0!==r&&t.attr("minlength",r)},validate:function(t,e){var n=+t.attr("minlength");if(n==n&&n>0&&e.length<n)return"too short - "+n+" characters or more expected"}},{set:function(t,n){var r=n.maxLength;e.isString(r)?t.attr("d3-attr-maxlength",r):void 0!==r&&t.attr("maxlength",r)},validate:function(t,e){var n=+t.attr("maxlength");if(n==n&&n>0&&e&&e.length>n)return"too long - "+n+" characters or less expected"}},{set:function(t,n){var r=n.minimum;e.isString(r)?t.attr("d3-attr-min",r):void 0!==r&&t.attr("min",r)},validate:function(t,e){var n=H(t);if(n&&+e<n[0])return"must be greater or equal "+n[0]}},{set:function(t,n){var r=n.maximum;e.isString(r)?t.attr("d3-attr-max",r):void 0!==r&&t.attr("max",r)},validate:function(t,e){var n=H(t);if(n&&+e>n[1])return"must be less or equal "+n[1]}}]},Ye=["checkbox","radio"],He=e.assign({},Re,{render:function(t){var e=this.createElement("input");return t=this.inputData(e,t),e.attr("type",t.type||"text").attr("d3-value","value"),-1===Ye.indexOf(e.attr("type"))&&e.attr("placeholder",t.placeholder),Xe.set(this,e),this.wrap(e)}}),Ie=e.assign({},Re,{render:function(t){var e=this.createElement("textarea");return t=this.inputData(e,t),e.attr("placeholder",t.placeholder).attr("d3-value","value"),Xe.set(this,e),this.wrap(e)}}),Be=e.assign({},Re,{model:e.assign({options:[],$optionLabel:function(){return e.isArray(this.option)?this.option[1]||this.option[0]:this.option},$optionValue:function(){return e.isArray(this.option)?this.option[0]:this.option}},Re.model),render:function(t){var e=this.createElement("select");return t=this.inputData(e,t),e.attr("d3-value","value").attr("placeholder",t.placeholder).append("option").attr("d3-for","option in options").attr("d3-html","$optionLabel()").attr("d3-attr-value","$optionValue()"),Xe.set(this,e),this.wrap(e)}}),Ve=e.assign({},qe,{render:function(t){var e=t?t.tag||"button":"button",n=this.createElement(e);t=this.inputData(n,t);var r=this.model;return r.type=t.type||"submit",t.endpoint&&(r.endpoint=t.endpoint),r.$submit=function(){r.actions.submit.call(r,i.event)},t.submit||(t.submit="$submit()"),n.attr("type",r.type).attr("name",r.name).attr("d3-on-click",t.submit).html(t.label||"submit"),this.wrap(n)}}),Ge={default:function(t){this.message(t)},redirect:function(t){window.location.href=t.redirectTo||"/"}},Ue={submit:function(t){var n=this.form,r=e.assign({},Ke,this.endpoint);t&&(t.preventDefault(),t.stopPropagation());var i=je.fetch,o=n.$inputData(),a={};if(i)if(r.url){if("application/json"===r.contentType)a.headers={"Content-Type":r.contentType},a.body=JSON.stringify(o);else{a.body=new FormData;for(var s in o)a.body.set(s,o[s])}n.$setSubmit()?(a.method=r.method,i(r.url,a).then(function(t){n.$setSubmitDone();var e=(t.headers.get("content-type")||"").split(";")[0];"application/json"===e?t.json().then(function(e){n.$response(e,t.status,t.headers)}):De("Cannot load content type '"+e+"'")},function(){n.$setSubmitDone()})):n.$setSubmitDone()}else De("No url, cannot submit");else De("fetch provider not available, cannot submit")}},Ke={contentType:"application/json",method:"post"},Je={props:["schema","values"],components:{"d3-form-fieldset":We,"d3-form-input":He,"d3-form-textarea":Ie,"d3-form-select":Be,"d3-form-submit":Ve},model:{formSubmitted:!1,formPending:!1,$isValid:function(t){var e=void 0,n=!0;for(var r in this.inputs)e=this.inputs[r],t&&(e.isDirty=!0),e.$validate(),e.error&&(n=!1);return n},$setSubmit:function(){return this.formSubmitted=!0,this.formPending=!0,this.$isValid(!0)},$setSubmitDone:function(){this.formPending=!1},$inputData:function(){var t,e=this.inputs,n={};for(var r in e)((t=e[r].value)||He.changed)&&(n[r]=t);return n},$response:function(t,e,n){if(e<300)if(this.data.resultHandler){var r=Ge[this.data.resultHandler];r?r.call(this,t,e,n):De("Could not find "+this.data.resultHandler+" result handler")}else Ge.default.call(this,t,e,n);else this.$responseError(t,e,n)},$responseError:function(t){t.level="error",this.$message(t)}},render:function(t){function n(t){t=qe.inputData.call(o,i,t),r.validators=Xe.get(t.validators);for(var n in Ue){var a=t[n];e.isString(a)&&(a=o.model.$get(a)),r.actions[n]=a||Ue[n]}return X.call(o,i),i}var r=this.model,i=this.createElement("form").attr("novalidate",""),o=this;r.$formExtensions=this.root.$formExtensions||[],r.inputs={},r.actions={},r.form=r;var a=t.schema;if(t.values&&(a.values=t.values),e.isString(a)){return(0,je.fetch)(a,{method:"GET"}).then(function(t){if(200===t.status)return t.json().then(n);De("Could not load form from "+a+": status "+t.status)})}return n(a)},childrenMounted:function(){var t=this.model,e=t.data.values;e&&Object.keys(e).forEach(function(n){var r=t.inputs[n];r&&(r.value=e[n])})}},Ze={install:function(t){t.addComponent("d3form",Je),t.$formExtensions=[];for(var e in t.providers)je[e]=t.providers[e]},actions:Ue,responses:Ge},Qe={input:["inputGroup","label","formGroup"],checkbox:["formCheck"],textarea:["label","formGroup"],select:["label","formGroup"],submit:["submit"],wrappers:{label:function(t,e){var n=t.model.data;return t.wrapTemplate(e,function(t){var e=t.label||t.name;return"<label for="+t.id+' class="control-label" d3-class="[srOnly ? \'sr-only\' : null]">'+e+"</label>\n<slot></slot>"}(n))},formGroup:function(t,e,n){var r=t.model.data,i=void 0!==r.size?r.size:t.model.form.data.size,o=i?"form-control form-control-"+i:"form-control";return n.classed(o,!0).attr("d3-class","["+(r.required||!1)+' ? "form-control-required" : null, showError ? "form-control-danger" : null]'),t.wrapTemplate(e,'<div class="form-group" d3-class=\'showError ? "has-danger" : null\'>\n<slot></slot>\n<p d3-if="showError" class="text-danger error-block" d3-html="error"></p>\n</div>')},inputGroup:function(t,e,n){var r=t.model.data.group;if(!r)return e;var i="g"+n.attr("id");return n.attr("aria-describedby",i),t.wrapTemplate(e,function(t,e){return'<div class="input-group" :class="bootstrapStatus()">\n<span class="input-group-addon" id="'+t+'">'+r+"</span>\n<slot></slot>\n</div>"}(i))},formCheck:function(t,e,n){var r=t.model.data;return n.classed("form-check-input",!0),t.wrapTemplate(e,'<div class="form-check">\n<label class="form-check-label">\n<slot></slot>\n'+r.label+"\n</label>\n</div>")},submit:function(t,e,n){var r=t.model.data.theme||"primary";return n.classed("btn",!0).classed("btn-"+r,!0),t.wrapTemplate(e,'<div class="form-group">\n<slot></slot>\n</div>')}}},tn={install:function(t){if(!t.$formExtensions)return De("form bootstrap requires the form plugin installed first!");t.$formExtensions.push(I)}},en="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},nn=function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t,e){!function(t){function e(t){return t}function n(t,e){for(var n=0,r=e.length,i=new Array(r);n<r;++n)i[n]=t[e[n]];return i}function r(t){function e(e,n,r,i){for(;r<i;){var o=r+i>>>1;n<t(e[o])?i=o:r=o+1}return r}return e.right=e,e.left=function(e,n,r,i){for(;r<i;){var o=r+i>>>1;t(e[o])<n?r=o+1:i=o}return r},e}function i(t){function e(t,e,r){for(var i=r-e,o=1+(i>>>1);--o>0;)n(t,o,i,e);return t}function n(e,n,r,i){for(var o,a=e[--i+n],s=t(a);(o=n<<1)<=r&&(o<r&&t(e[i+o])>t(e[i+o+1])&&o++,!(s<=t(e[i+o])));)e[i+n]=e[i+o],n=o;e[i+n]=a}return e.sort=function(t,e,r){for(var i,o=r-e;--o>0;)i=t[e],t[e]=t[e+o],t[e+o]=i,n(t,1,o,e);return t},e}function o(t){var e=i(t);return function(n,r,i,o){var a,s,u,l=new Array(o=Math.min(i-r,o));for(s=0;s<o;++s)l[s]=n[r++];if(e(l,0,o),r<i){a=t(l[0]);do{t(u=n[r])>a&&(l[0]=u,a=t(e(l,0,o)[0]))}while(++r<i)}return l}}function a(t){return function(e,n,r){for(var i=n+1;i<r;++i){for(var o=i,a=e[i],s=t(a);o>n&&t(e[o-1])>s;--o)e[o]=e[o-1];e[o]=a}return e}}function s(t){function e(r,i,o){return(o-i<x?n:function(n,r,i){var o,a=(i-r)/6|0,s=r+a,u=i-1-a,l=r+i-1>>1,c=l-a,d=l+a,f=n[s],h=t(f),p=n[c],g=t(p),m=n[l],v=t(m),y=n[d],b=t(y),x=n[u],w=t(x);h>g&&(o=f,f=p,p=o,o=h,h=g,g=o);b>w&&(o=y,y=x,x=o,o=b,b=w,w=o);h>v&&(o=f,f=m,m=o,o=h,h=v,v=o);g>v&&(o=p,p=m,m=o,o=g,g=v,v=o);h>b&&(o=f,f=y,y=o,o=h,h=b,b=o);v>b&&(o=m,m=y,y=o,o=v,v=b,b=o);g>w&&(o=p,p=x,x=o,o=g,g=w,w=o);g>v&&(o=p,p=m,m=o,o=g,g=v,v=o);b>w&&(o=y,y=x,x=o,o=b,b=w,w=o);var k=p,E=g,_=y,M=b;n[s]=f,n[c]=n[r],n[l]=m,n[d]=n[i-1],n[u]=x;var A=r+1,z=i-2,O=E<=M&&E>=M;if(O)for($=A;$<=z;++$){P=n[$];if((C=t(P))<E)$!==A&&(n[$]=n[A],n[A]=P),++A;else if(C>E)for(;;){if(!((T=t(n[z]))>E)){if(T<E){n[$]=n[A],n[A++]=n[z],n[z--]=P;break}n[$]=n[z],n[z--]=P;break}z--}}else for($=A;$<=z;$++){P=n[$];if((C=t(P))<E)$!==A&&(n[$]=n[A],n[A]=P),++A;else if(C>M)for(;;){if(!((T=t(n[z]))>M)){T<E?(n[$]=n[A],n[A++]=n[z],n[z--]=P):(n[$]=n[z],n[z--]=P);break}if(--z<$)break}}if(n[r]=n[A-1],n[A-1]=k,n[i-1]=n[z+1],n[z+1]=_,e(n,r,A-1),e(n,z+2,i),O)return n;if(A<s&&z>u){for(var S;(S=t(n[A]))<=E&&S>=E;)++A;for(;(T=t(n[z]))<=M&&T>=M;)--z;for(var $=A;$<=z;$++){var P=n[$],C=t(P);if(C<=E&&C>=E)$!==A&&(n[$]=n[A],n[A]=P),A++;else if(C<=M&&C>=M)for(;;){var T;if(!((T=t(n[z]))<=M&&T>=M)){T<E?(n[$]=n[A],n[A++]=n[z],n[z--]=P):(n[$]=n[z],n[z--]=P);break}if(--z<$)break}}}return e(n,A,z+1)})(r,i,o)}var n=a(t);return e}function u(t){for(var e=new Array(t),n=-1;++n<t;)e[n]=0;return e}function l(t){return[0,t.length]}function c(){return null}function d(){return 0}function f(t){return t+1}function h(t){return t-1}function p(t){return function(e,n){return e+ +t(n)}}function g(t){return function(e,n){return e-t(n)}}function m(){function t(t){var e=x,n=t.length;return n&&(m=m.concat(t),A=_(A,x+=n),O.forEach(function(r){r(t,e,n)})),u}function r(t){function r(e,r,i){F=e.map(t),L=I(function(t){for(var e=v(t,t),n=-1;++n<t;)e[n]=n;return e}(i),0,i),F=n(F,L);var o,a=B(F),s=a[0],u=a[1];if(W)for(o=0;o<i;++o)W(F[o],o)||(A[L[o]+r]|=Y);else{for(o=0;o<s;++o)A[L[o]+r]|=Y;for(o=u;o<i;++o)A[L[o]+r]|=Y}if(!r)return q=F,R=L,U=s,void(K=u);var l=q,c=R,d=0,f=0;for(q=new Array(x),R=v(x,x),o=0;d<r&&f<i;++o)l[d]<F[f]?(q[o]=l[d],R[o]=c[d++]):(q[o]=F[f],R[o]=L[f++]+r);for(;d<r;++d,++o)q[o]=l[d],R[o]=c[d];for(;f<i;++f,++o)q[o]=F[f],R[o]=L[f]+r;a=B(q),U=a[0],K=a[1]}function a(t,e,n){V.forEach(function(t){t(F,L,e,n)}),F=L=null}function u(t){for(var e,n=0,r=0;n<x;++n)A[e=R[n]]&&(n!==r&&(q[r]=q[n]),R[r]=t[e],++r);for(q.length=r;r<x;)R[r++]=0;var i=B(q);U=i[0],K=i[1]}function w(t){var e=t[0],n=t[1];if(W)return W=null,j(function(t,r){return e<=r&&r<n}),U=e,K=n,X;var r,i,o,a=[],s=[];if(e<U)for(r=e,i=Math.min(U,n);r<i;++r)A[o=R[r]]^=Y,a.push(o);else if(e>U)for(r=U,i=Math.min(e,K);r<i;++r)A[o=R[r]]^=Y,s.push(o);if(n>K)for(r=Math.max(e,K),i=n;r<i;++r)A[o=R[r]]^=Y,a.push(o);else if(n<K)for(r=Math.max(U,n),i=K;r<i;++r)A[o=R[r]]^=Y,s.push(o);return U=e,K=n,z.forEach(function(t){t(Y,a,s)}),X}function $(t){return w((B=function(t,e){return function(n){var r=n.length;return[t.left(n,e,0,r),t.right(n,e,0,r)]}}(b,t))(q))}function P(t){return w((B=function(t,e){var n=e[0],r=e[1];return function(e){var i=e.length;return[t.left(e,n,0,i),t.left(e,r,0,i)]}}(b,t))(q))}function C(){return w((B=l)(q))}function T(t){return B=l,j(W=t),U=0,K=x,X}function j(t){var e,n,r,i=[],o=[];for(e=0;e<x;++e)!(A[n=R[e]]&Y)^!!(r=t(q[e],e))&&(r?(A[n]&=H,i.push(n)):(A[n]|=Y,o.push(n)));z.forEach(function(t){t(Y,i,o)})}function D(t){function n(e,n,r,i){function o(){++X===W&&(k=M(k,L<<=1),C=M(C,L),W=y(L))}var d,f,h,p,g,b,w=P,k=v(X,W),E=D,O=F,S=X,$=0,T=0;for(U&&(E=O=c),P=new Array(X),X=0,C=S>1?_(C,x):v(x,W),S&&(h=(f=w[0]).key);T<i&&!((p=t(e[T]))>=p);)++T;for(;T<i;){for(f&&h<=p?(g=f,b=h,k[$]=X,(f=w[++$])&&(h=f.key)):(g={key:p,value:O()},b=p),P[X]=g;!(p>b||(C[d=n[T]+r]=X,A[d]&H||(g.value=E(g.value,m[d])),++T>=i));)p=t(e[T]);o()}for(;$<S;)P[k[$]=X]=w[$++],o();if(X>$)for($=0;$<r;++$)C[$]=k[C[$]];d=z.indexOf(I),X>1?(I=a,B=u):(!X&&K&&(X=1,P=[{key:null,value:O()}]),1===X?(I=s,B=l):(I=c,B=c),C=null),z[d]=I}function r(){if(X>1){for(var t=X,e=P,n=v(t,t),r=0,i=0;r<x;++r)A[r]&&(n[C[i]=C[r]]=1,++i);for(P=[],X=0,r=0;r<t;++r)n[r]&&(n[r]=X++,P.push(e[r]));if(X>1)for(r=0;r<i;++r)C[r]=n[C[r]];else C=null;z[z.indexOf(I)]=X>1?(B=u,I=a):1===X?(B=l,I=s):B=I=c}else if(1===X){if(K)return;for(r=0;r<x;++r)if(A[r])return;P=[],X=0,z[z.indexOf(I)]=I=B=c}}function a(t,e,n){if(t!==Y&&!U){var r,i,o,a;for(r=0,o=e.length;r<o;++r)A[i=e[r]]&H||((a=P[C[i]]).value=D(a.value,m[i]));for(r=0,o=n.length;r<o;++r)(A[i=n[r]]&H)===t&&((a=P[C[i]]).value=N(a.value,m[i]))}}function s(t,e,n){if(t!==Y&&!U){var r,i,o,a=P[0];for(r=0,o=e.length;r<o;++r)A[i=e[r]]&H||(a.value=D(a.value,m[i]));for(r=0,o=n.length;r<o;++r)(A[i=n[r]]&H)===t&&(a.value=N(a.value,m[i]))}}function u(){var t,e;for(t=0;t<X;++t)P[t].value=F();for(t=0;t<x;++t)A[t]&H||((e=P[C[t]]).value=D(e.value,m[t]))}function l(){var t,e=P[0];for(e.value=F(),t=0;t<x;++t)A[t]&H||(e.value=D(e.value,m[t]))}function b(){return U&&(B(),U=!1),P}function w(t,e,n){return D=t,N=e,F=n,U=!0,$}function k(){return w(f,h,d)}function E(t){function e(e){return t(e.value)}return T=o(e),j=i(e),$}function O(){var t=z.indexOf(I);return t>=0&&z.splice(t,1),(t=V.indexOf(n))>=0&&V.splice(t,1),(t=S.indexOf(r))>=0&&S.splice(t,1),$}var $={top:function(t){var e=T(b(),0,P.length,t);return j.sort(e,0,e.length)},all:b,reduce:w,reduceCount:k,reduceSum:function(t){return w(p(t),g(t),d)},order:E,orderNatural:function(){return E(e)},size:function(){return X},dispose:O,remove:O};G.push($);var P,C,T,j,D,N,F,L=8,W=y(L),X=0,I=c,B=c,U=!0,K=t===c;return arguments.length<1&&(t=e),z.push(I),V.push(n),S.push(r),n(q,R,0,x),k().orderNatural()}function N(){G.forEach(function(t){t.dispose()});var t=O.indexOf(r);return t>=0&&O.splice(t,1),(t=O.indexOf(a))>=0&&O.splice(t,1),(t=S.indexOf(u))>=0&&S.splice(t,1),k&=H,C()}var q,R,F,L,W,X={filter:function(t){return null==t?C():Array.isArray(t)?P(t):"function"==typeof t?T(t):$(t)},filterExact:$,filterRange:P,filterFunction:T,filterAll:C,top:function(t){for(var e,n=[],r=K;--r>=U&&t>0;)A[e=R[r]]||(n.push(m[e]),--t);return n},bottom:function(t){for(var e,n=[],r=U;r<K&&t>0;)A[e=R[r]]||(n.push(m[e]),--t),r++;return n},group:D,groupAll:function(){var t=D(c),e=t.all;return delete t.all,delete t.top,delete t.order,delete t.orderNatural,delete t.size,t.value=function(){return e()[0].value},t},dispose:N,remove:N},Y=~k&-~k,H=~Y,I=s(function(t){return F[t]}),B=l,V=[],G=[],U=0,K=0;return O.unshift(r),O.push(a),S.push(u),k|=Y,(E>=32?!Y:k&-(1<<E))&&(A=M(A,E<<=1)),r(m,0,x),a(0,0,x),X}function a(){function t(t,e){var n;if(!v)for(n=e;n<x;++n)A[n]||(a=s(a,m[n]))}function e(t,e,n){var r,i,o;if(!v){for(r=0,o=e.length;r<o;++r)A[i=e[r]]||(a=s(a,m[i]));for(r=0,o=n.length;r<o;++r)A[i=n[r]]===t&&(a=u(a,m[i]))}}function n(t,e,n){return s=t,u=e,l=n,v=!0,c}function r(){return n(f,h,d)}function i(){return v&&(function(){var t;for(a=l(),t=0;t<x;++t)A[t]||(a=s(a,m[t]))}(),v=!1),a}function o(){var n=z.indexOf(e);return n>=0&&z.splice(n),(n=O.indexOf(t))>=0&&O.splice(n),c}var a,s,u,l,c={reduce:n,reduceCount:r,reduceSum:function(t){return n(p(t),g(t),d)},value:i,dispose:o,remove:o},v=!0;return z.push(e),O.push(t),t(0,0),r()}var u={add:t,remove:function(){for(var t=v(x,x),e=[],n=0,r=0;n<x;++n)A[n]?t[n]=r++:e.push(n);z.forEach(function(t){t(0,[],e)}),S.forEach(function(e){e(t)});for(var i,n=0,r=0;n<x;++n)(i=A[n])&&(n!==r&&(A[r]=i,m[r]=m[n]),++r);for(m.length=r;x>r;)A[--x]=0},dimension:r,groupAll:a,size:function(){return x}},m=[],x=0,k=0,E=8,A=w(0),z=[],O=[],S=[];return arguments.length?t(arguments[0]):u}function v(t,e){return(e<257?w:e<65537?k:E)(t)}function y(t){return 8===t?256:16===t?65536:4294967296}m.version="1.3.12",m.permute=n;var b=m.bisect=r(e);b.by=r;(m.heap=i(e)).by=i;(m.heapselect=o(e)).by=o;(m.insertionsort=a(e)).by=a;(m.quicksort=s(e)).by=s;var x=32,w=u,k=u,E=u,_=function(t,e){for(var n=t.length;n<e;)t[n++]=0;return t},M=function(t,e){if(e>32)throw new Error("invalid array width!");return t};"undefined"!=typeof Uint8Array&&(w=function(t){return new Uint8Array(t)},k=function(t){return new Uint16Array(t)},E=function(t){return new Uint32Array(t)},_=function(t,e){if(t.length>=e)return t;var n=new t.constructor(e);return n.set(t),n},M=function(t,e){var n;switch(e){case 16:n=k(t.length);break;case 32:n=E(t.length);break;default:throw new Error("invalid array width!")}return n.set(t),n}),t.crossfilter=m}(e||en)}).crossfilter,rn=function(t){return function(e){return e[t]}};B.prototype={constructor:B,dataFrame:function(){return this},size:function(){return this.data.length},new:function(t){return e.isArray(t)?new B(t,null,this.store):new B(this._inner,t)},cf:function(){return this._inner.cf||(this._inner.cf=nn(this.data)),this._inner.cf},dimension:function(t,e,n){1===arguments.length&&(n=!0);var r=this.dimensions[t];if(r){if(n)return r;r.dispose()}return e||(e=rn(t)),this.dimensions[t]=this.cf().dimension(e),this.dimensions[t]},sortby:function(t,e){return this.new(this.dimension(t).top(e||1/0))},pivot:function(t,e,n,r){function i(i){var o=void 0,a=void 0;return function(s,u){return o=""+u[e],a=i*u[n],s[t]=u[t],o in s?s[o]+=a:s[o]=a,r in s?s[r]+=a:s[r]=a,s}}var o=this.dimension(t).group();return r||(r="total"),this.new(o.reduce(i(1),i(-1),Object).all().map(function(t){return t.value}))},add:function(){},map:function(t){return this.new(this.data.map(t))}};var on={schema:{type:"object",description:"array of data",properties:{data:{type:"array",description:"array of data"}}},initialise:function(t){this._data=t.data},getConfig:function(t){return e.isArray(t)?{data:t}:e.isObject(t)&&e.isArray(t.data)?t:void 0},getData:function(){return this.asFrame(this._data)}},an=function(t){Ft.logger.warn("[d3-data-source] "+t)},sn=["http","https","ws","wss"],un=n.set(["text/plain","text/csv","application/vnd.ms-excel"]),ln={schema:{type:"object",description:"Remote data resource",properties:{url:{type:"string",description:"url for fetching data"}}},getConfig:function(t){return function(t){return e.isString(t)&&sn.indexOf(t.split("://")[0])>-1}(t)?{url:t}:e.isObject(t)&&t.url?t:void 0},initialise:function(t){this.url=t.url},getData:function(){var t=Ft.fetch,e=this;return t?t(this.url).then(V).then(function(t){return e.asFrame(t)}):(an("fetch provider not available, cannot submit"),[])}},cn={schema:{type:"object",description:"Composite data source for combining data together",properties:{source:{type:"array",description:"Array of data sources keys",item:{type:"string"}},expression:{type:"string",description:"expression to evaluate, must return a data frame or a Promise"}}},initialise:function(t){this.source=t.source,this.expression=t.expression?me(t.expression):null},getConfig:function(t){if(e.isObject(t)&&t.source)return e.isArray(t.source)||(t.source=[t.source]),t},getData:function(t){var n=this.store,r=this.source,i=this.expression,o=this;return Promise.all(r.map(function(e){return n.getData(e,t)})).then(function(a){var s=void 0;if(1===a.length?s=a[0]:o.config.merge?s=o.mergeFrames(a):(s=new G(n),a.forEach(function(t,e){s.frames.set(r[e],t)})),i){var u=n.model.$child(e.assign({},t,{frame:s}));s=i.eval(u)}return e.isPromise(s)?s.then(function(t){return o.asFrame(t)}):o.asFrame(s)})},mergeFrames:function(t){return t[0]}};G.prototype={new:function(t){return new B(t,this.store)},dataFrame:function(){for(var t=this.frames.values(),e=0;e<t.length;++e)if("dataframe"===t[e].type)return t[e]}};var dn={schema:{type:"object",description:"Expression to evaluate by the data store",properties:{expression:{type:"string",description:"expression to evaluate, must return a data frame or a Promise"}}},initialise:function(t){this.expression=me(t.expression)},getConfig:function(t){if(e.isObject(t)&&t.expression)return t},getData:function(t){var n=this,r=this.store.model.$child(t),i=this.expression.eval(r);return e.isPromise(i)?i.then(function(t){return n.asFrame(t)}):n.asFrame(i)}},fn=function(t){function e(t){return i.validate(t)?function(e){return n(e,t)}:i.logError()}var n=t.transform,r=t.schema||{},i=Ft.jsonValidator?Ft.jsonValidator(t.schema):hn;return r.type||(r.type="object"),e.schema=r,e},hn={validate:function(){return!0}},pn=fn({schema:{description:"The filter transform removes objects from a data frame based on a provided filter expression",properties:{expr:{type:"string"}},required:["expr"]},transform:function(t,e){var n=me(e.expr);return t.data.reduce(function(e,r,i){return n.safeEval({d:r,index:i,frame:t})&&e.push(r),e},[])}}),gn=function(t,e){Ft.logger.warn("[d3-visualize] "+t),e&&Ft.logger.error(e.stack)},mn=n.map({count:U,max:s.max,min:s.min,sum:s.sum,mean:s.mean,median:s.median,variance:s.variance,deviation:s.deviation}),vn=n.map({count:function(t){return t+1},sum:function(t,e){return t+e},max:Math.max,min:Math.min}),yn={dataSource:null,size:{width:null,height:"70%"}};yn.dateFormat="%d-%b-%y";var bn={date:function(t){return u.utcParse(t.dateFormat||yn.dateFormat)},number:function(){return parseFloat}},xn=fn({shema:{description:"map a field values into another type",properties:{fields:{type:"object"},dateFormat:{type:"string"}},required:["fields"]},transform:function(t,r){var i=[],o=void 0,a=void 0;return n.map(r.fields).each(function(t,n){e.isString(t)&&(t={type:t}),(a=bn[t.type])?i.push([n,a(t)]):gn("Cannot convert field "+n+" to type "+t.type)}),i.length&&(t=t.map(function(t){for(o=0;o<i.length;++o)t[i[o][0]]=i[o][1](t[i[o][0]]);return t})),t}}),wn=function(t,e,n){return void 0!==n&&(t=Math.min(t,n)),void 0===e?t:Math.max(t,e)},kn=fn({shema:{description:"Create moving average series from existing one. The new series override the existing one unless the as array is provided",properties:{method:{type:"string"},alpha:{type:"number"},period:{type:"number"},fields:{type:"array",items:{type:"string"}},as:{type:"array",items:{type:"string"}}},required:["fields"]},transform:function(t,e){var n=e.as||[],r=e.method||"ema",i=void 0,o=void 0,a=void 0;e.fields.forEach(function(s,u){if(i=n[u]||s,"sma"===r){var l=Math.max(e.period||10,1),c=[],d=[];t.data.forEach(function(t,e){o=t[s],c.length===l&&(o-=d.splice(0,1)[0]),d.push(o),e&&(o+=c[c.length-1]),c.push(o),t[i]=o/c.length})}else{var f=wn(e.alpha||.5,1-.999999,.999999);t.data.forEach(function(t,e){o=t[s],a=e?f*a+(1-f)*o:o,t[i]=a})}})}}),En=fn({schema:{description:"Group entries which are below a given aggregate cutoff",properties:{field:{type:"string"},cutoff:{type:"number"}},required:["field","cutoff"]},transform:function(t,e){var n=rn(e.field),r=s.sum(t.data,n),i=[],o=0;return t.dimension(e.field).bottom(1/0).reduce(function(t,a){return(o+=n(a))/r<e.cutoff?i.push(a):i?(i.push(a),(a={label:"other",children:i})[e.field]=o,i=null,t.push(a)):t.push(a),t},[])}}),_n=fn({schema:{description:"Perfrom a difference for a group of fields along a dimension. It is possible to perform a difference for different groups",properties:{dimension:{type:"string"},period:{type:"integer",minimum:1},fields:{type:"array",items:{type:"string"}},as:{type:"array",items:{type:"string"}},groupby:{type:"string"}},required:["dimension","fields"]},transform:function(t,n){function r(t){var r=t.dimension(n.dimension),s=n.fields.reduce(function(t,e){return t[e]=0,t},{}),u=[],l=void 0,c=void 0;r.top(1/0).forEach(function(t,r){l=e.assign({},t),u.push(t),c=r>o?u.splice(0,1)[0]:s,n.fields.forEach(function(e,n){t[i[n]||e]=t[e]-c[e]}),a.push(l)})}var i=n.as||[],o=n.period||1,a=[];if(n.groupby){var s=t.dimension(n.groupby);s.group().all().forEach(function(e){return r(t.new(s.filterAll().filter(e.key).top(1/0)))})}else r(t.new());return a}}),Mn=e.assign(n.map({filter:pn,aggregate:function(t){function n(t){var e,n,s=[];return a?function(t){var e=void 0,n=void 0,s=void 0,u=r.map(function(t,e){return n=i[e],s=vn.get("count"),n&&((s=vn.get(n))||(s=vn.get("count"),gn("Operation "+n+" is not supported, use count"))),{field:t,as:o[e]||t,op:s}});return t.dimension(a).group().reduce(function(t,n){return u.reduce(function(t,r){return e=0,r.as in t&&(e=t[r.as]),t[r.as]=r.op(e,n[r.field]),t},t)},null,Object).all().map(function(t){return t.value[a]=t.key,t.value})}(t):(r.forEach(function(r,a){e=i[a],n=U,e&&((n=mn.get(e))||(n=U,gn("Operation "+i[a]+" is not supported, use count"))),s.push({label:o[a]||r,data:n(t.data,function(t){return t[r]})})}),s)}var r=t.fields,i=t.ops,o=t.as,a=t.groupby;return r||i?e.isArray(r)?(i||(i="count"),e.isString(i)&&(i=function(t,e){var n=new Array(t);return n.fill(e),n}(r.length,i)),e.isArray(i)?(i.length<r.length&&gn("Aggregate transforms expects an ops array with same length as fields"),o||(o=[]),e.isArray(o)?n:gn("Aggregate transform expects an array of as fields")):gn("Aggregate transform expects an array of ops")):gn("Aggregate transforms expect an array of fields"):function(t){var e=void 0;return t.data.reduce(function(t,n){for(e in n)e in t?t[e]+=1:t[e]=1;return t},{})}},mapfields:xn,timeseries:function(t){var e=t.sortby,n=t.groupby;return e||gn('timeseries transform requires a "sortby" entry'),function(t){if(e){if(n){var r,i=t.dimension(n),o=i.group().top(1/0),a=t.new([]);return o.forEach(function(n){r=t.new(i.filterExact(n.key).top(1/0)).dimension(e).group().top(1/0),a.series.set(n.key,t.new(r).dimension("key").top(1/0))}),a}return t.new(t.dimension(e).top(1/0))}return t}},crossfilter:function(t){var n=t.fields,r=t.query;return e.isArray(n)?e.isArray(r)?r.length!=n.length?gn("crossfilter transform expects an query array with same length as fields"):function(t){var i=void 0,o=void 0;return n.forEach(function(n,a){o=r[a],e.isString(o)&&(o=t.store.eval(o)),i=t.dimension(n).filterAll(),o&&i.filter(o)}),i?t.new(i.top(1/0)):t}:gn("crossfilter transform expects an array of query"):gn("crossfilter transform expects an array of fields")},movingaverage:kn,groupsmall:En,diff:_n}),{add:function(t,e){this.set(t,fn(e))}}),An=o.dispatch("init","data"),zn={schema:{properties:{}},getConfig:function(){},initialise:function(){},getData:function(){},addTransforms:function(t){var n=this,r=void 0;t&&(e.isArray(t)||(t=[t]),t.forEach(function(t){(r=Mn.get(t.type))?n.transforms.push(r(t)):gn('Transform type "'+t.type+'" not known')}))},asFrame:function(t){return t&&!e.isArray(t)&&t.constructor!==B&&(t=[t]),e.isArray(t)&&(t=new B(t=t.map(function(t){return t.constructor!==Object&&(t={data:t}),t}),this.store)),function(t,e){return e?K(t,e.slice()):t}(t,this.transforms)}},On=e.assign(n.map(),{events:An,add:function(t,n){function r(n,r){!function(t,n,r,i){var o=i.dataName(e.pop(r,"name")),a=[];Object.defineProperties(t,{name:{get:function(){return o}},store:{get:function(){return i}},type:{get:function(){return n}},transforms:{get:function(){return a}},config:{get:function(){return r}}}),t.initialise(r),t.addTransforms(e.pop(r,"transforms")),i.sources.set(o,t),An.call("init",void 0,t)}(this,t,n,r)}return r.prototype=e.assign({},zn,n),r.prototype.constructor=r,this.set(t,r),r},create:function(t,e){for(var n,r=this.values(),i=0;i<r.length;++i)if(n=r[i].prototype.getConfig(t))return new r[i](n,e)}});On.add("array",on),On.add("remote",ln),On.add("composite",cn),On.add("expression",dn),J.prototype={size:function(){return this.sources.size()},addSources:function(t){if(e.isString(t)&&(t={source:t}),e.isArray(t)){var n=this;return t.map(function(t){return On.create(t,n)})}if(t)return On.create(t,this)},addTransforms:function(t){e.assign(this.transforms,t)},source:function(t,e){if(1===arguments.length)return this.sources.get(t);if(null===e){var n=this.sources.get(t);return this.sources.remove(t),n}return this.sources.set(t,e),this},clearCache:function(){this.sources.each(function(t){delete t.cachedFrame})},getData:function(t,n){var r=this.sources.get(t);if(!r)throw new Error("Data source "+t+" not available");if(r.cachedFrame)return Promise.resolve(r.cachedFrame);var i=r.getData(n);return e.isPromise(i)||(i=Promise.resolve(i)),i.then(function(t){return r.config.cache&&(r.cachedFrame=t),t})},eval:function(t,e){var n=this.model.$child(e);return n.dataStore=this,me(t).safeEval(n)},dataName:function(t){if(this.dataCount++,t)return""+t;return this.source("default")?"source"+this.dataCount:"default"}};var Sn=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},$n=400,Pn="75%",Cn=["visual","container"],Tn={live:[],types:{},papers:{},options:yn,schema:{title:"Visualize Specification Language",type:"object",definitions:{size:{oneOf:[{type:"number",description:"size in pixels",minimum:0},{type:"string",description:"Size as a percentage"}]}}},events:o.dispatch("before-init","after-init","resize","before-draw","after-draw")},jn={initialise:function(){},draw:function(){},redraw:function(t){if(this.drawing){var e=this,n="after-draw."+this.toString();Tn.events.on(n,function(){Tn.events.on(n,null),e.redraw(t)})}else this.drawing=this.draw(t);return this.drawing},destroy:function(){},toString:function(){return this.visualType+"-"+this.model.uid},getModel:function(t){t||(t=this.visualType);var n=this.model[t];if(!n&&t in yn){var r=e.pop(this.options,t),i=this;this.visualParent?n=this.visualParent.getModel(t).$child(r):(n=this.model.$new(yn[t])).$update(r),this.model[t]=n,n.$on(function(){return i.redraw(!1)})}return n},idname:function(t){return t||(t=this.visualType),t+"-"+this.model.uid},modelProperty:function(t,e){var n=this.getModel()[t];return void 0===n?e[t]:n},dim:function(t,e,n,r){return wn(Z(t,e),n,r)},pop:function(t){if(t){var e=t.live.indexOf(this);e>-1&&t.live.splice(e,1)}},getVisualSchema:function(t){var n=this.options.visuals?this.options.visuals[t]:null,r=this.visualParent;if(r&&e.isString(n)?(t=n,n=r.getVisualSchema(t)):r&&!n&&(n=r.getVisualSchema(t)),e.isObject(n))return nt(n)}},Dn=function(t,n){function r(e,n,r,i){Object.defineProperties(this,{visualType:{get:function(){return t}},isViz:{get:function(){return-1===Cn.indexOf(t)}},visualRoot:{get:function(){return this.visualParent?this.visualParent.visualRoot:this}}}),this.visualParent=r,this.model=r?r.model.$new():i||S(),this.options=n||{},this.drawing=!1,Tn.events.call("before-init",void 0,this),this.initialise(e),Tn.events.call("after-init",void 0,this)}var i=e.pop(n,"schema");return i&&(Tn.options[t]=rt(i),Tn.schema.definitions[t]={type:"object",properties:e.assign({data:{$ref:"#/definitions/data"}},i)}),r.prototype=e.assign({},Qt,jn,n),r.prototype.constructor=r,Tn.types[t]=r,r},Nn=Dn("visual",{schema:{render:{type:"string",enum:["canvas","svg"],default:"svg"},width:{description:"Width of the visual",$refs:"#/definitions/size"},height:{description:"Height of the visual",$refs:"#/definitions/size",default:"70%"}},initialise:function(t){if(!t)throw new Error("HTMLElement required by visual group");if(this.visualParent&&"container"!==this.visualParent.visualType)throw new Error("Visual parent can be a container only");this.select(t).select(".paper").node()||this.select(t).append("div").classed("paper",!0),Object.defineProperties(this,{element:{get:function(){return t}},paperElement:{get:function(){return this.sel.select(".paper")}},sel:{get:function(){return this.select(t)}},size:{get:function(){return[this.width,this.height]}}}),this.sel.classed("d3-visual",!0),this.layers=[],this.drawCount=0,Tn.live.push(this),t.__visual__=this,this.visualParent&&this.visualParent.live.push(this)},activate:function(){this.layers.forEach(function(t){return t.activate()})},deactivate:function(){this.layers.forEach(function(t){return t.deactivate()})},getVisual:function(){return this},draw:function(t){if(this.drawing)return gn(this.toString()+" already drawing"),this.drawing;this.drawCount?(this.drawCount++,this.clear()):(this.drawCount=1,this.fit());var e=this;return Tn.events.call("before-draw",void 0,this),Promise.all(this.layers.map(function(e){return e.redraw(t)})).then(function(){delete e.drawing,Tn.events.call("after-draw",void 0,e)},function(t){delete e.drawing,gn("Could not draw "+e.toString()+": "+t,t)})},clear:function(){},addVisual:function(t){var n=e.pop(t,"type"),r=Tn.types[n];if(r)return new r(this.element,t,this);gn('Cannot add visual "'+n+'", not available')},fit:function(){return this.resize(null,!0),this},resize:function(t,e){t||(t=Q(this.element.parentNode||this.element,this.getModel()));var n=this.size;return(e||n[0]!==t.width||n[1]!==t.height)&&(e||Rt('Resizing "'+this.toString()+'"'),this.width=t.width,this.height=t.height,this.paperElement.style("height",this.height+"px"),Tn.events.call("resize",void 0,this),e||this.draw(!1)),this},paper:function(){var t=this.__paper,e=this.getModel().render;if(t&&t.paperType===e)return t;var n=Tn.papers[e];if(!n)throw new Error("Unknown paper "+e);return t=new n(this),this.__paper=t,t},getPaperGroup:function(t){return this.paper().group(t)},destroy:function(){this.pop(this.visualParent),this.pop(Tn)}});if(e.inBrowser){new MutationObserver(function(t){t.forEach(function(t){var e=t.removedNodes;e&&e.length&&e.forEach(function(t){t.querySelectorAll&&(t.__visual__?it.call(t):i.select(t).selectAll(".d3-visual").each(it))})})}).observe(document.documentElement,{childList:!0,subtree:!0})}var qn=function(t){Ft.visualPlugins&&(!function(t){var n=void 0,r=void 0;Object.keys(t).forEach(function(i){n=t[i].options,r=t[i].prototype,n&&(Tn.options[i]=n),r&&e.assign(Rn,r)})}(Ft.visualPlugins),Ft.visualPlugins=null);for(var n=[{},Rn,Fn],r=1;r<arguments.length;++r)n.push(arguments[r]);return Dn(t,e.assign.apply(void 0,n))},Rn={$:null,initialise:function(t){var n=this.visualParent;if(void 0!==this.options.active?this.active=e.pop(this.options,"active"):this.active=!0,n){if(!n.layers)throw new Error("visual parent of "+this.visualType+" does not have layers")}else this.visualParent=n=new Nn(t,this.options,null,this.model),this.model=n.model.$new(),this.options={};n.layers.push(this)},paper:function(){return this.visualParent.paper()},activate:function(t){return this.active||(this.active=!0,this.group().transition(this.model.uid).on("end",function(){t&&t()}).style("opacity",1)),this},deactivate:function(t){return this.active&&(this.active=!1,this.group().transition(this.model.uid).on("end",function(){t&&t()}).style("opacity",0)),this},getVisual:function(){return this.visualParent.getVisual()},group:function(t){var e=this.visualType+"-"+this.model.uid,n=this.visualParent.getPaperGroup(e);return t&&t!==this.visualType?this.paper().childGroup(n,t):n},translate:function(t,n){return e.isFunction(t)?function(e){return"translate("+(t(e)||0)+", "+(n(e)||0)+")"}:"translate("+t+", "+n+")"},getD3:function(t,e){return this.$[""+t+e[0].toUpperCase()+e.substring(1)]},displayError:function(){}},Fn={draw:function(t){var e=this;if(this.drawing)return gn(this.toString()+" already drawing"),this.drawing;var n=this,r=this.doDraw;if(this.paper().size(this.boundingBox(!0)),this.active){if(Tn.events.call("before-draw",void 0,this),!1!==t||!this._drawArgs)return Promise.all([this.requires?Ft.require.apply(void 0,this.requires):[],this.getData()]).then(function(t){delete n.drawing;var i=t[1];i&&(e.$=t[0],e.frame=i,r.apply(n),Tn.events.call("after-draw",void 0,n))},function(t){delete n.drawing,gn("Could not draw "+n.toString()+": "+t,t),e.displayError(t)});delete n.drawing,r.apply(n,this._drawArgs),Tn.events.call("after-draw",void 0,n)}}},Ln={initialise:function(){},transition:function(){},size:function(t){return this.sel.attr("width",t.width).attr("height",t.height),this},group:function(t,e){return this.childGroup(this.sel,t,e)},childGroup:function(t,e,n){e||(e="main");var r=t.selectAll("."+e).data([0]).enter().append("g").classed(e,!0);return n&&r.attr("transform",n).merge().attr("transform",n),t.select("."+e)},dim:function(t){return t}};ot("svg",{initialise:function(t,e){e||t.model.uid;var n=t.paperElement.select("svg#"+e);return n.size()||(n=t.paperElement.append("svg").attr("id",e).classed(t.visualType,!0).style("position","absolute")),n.node()}}),ot("div",{initialise:function(t){var e=t.model.uid,n=t.visualParent,r=n.paperElement.select("div#"+e);return r.size()||(r=n.paperElement.append("div").attr("id",e).classed(n.visualType,!0).style("position","absolute")),r.node()},size:function(t){return this.sel.style("width",t.width+"px").style("height",t.height+"px"),this},childGroup:function(t,e){return e||(e="main"),t.selectAll("."+e).data([0]).enter().append("div").classed(e,!0),t.select("."+e)}});Rn.getScale=function(t){e.isString(t)&&(t={type:t});return function(t,n){return(n.$events?n.$events.keys():Object.keys(n)).forEach(function(r){e.isFunction(t[r])&&t[r](n[r])}),t}(this.getD3("scale",t.type)(),t)},yn.menu={display:!1,height:"8%",maxHeight:50,minHeight:20},Tn.events.on("after-init.menu",function(t){if("visual"===t.visualType){t.getModel("menu").display&&(t.menu=t.sel.insert("nav",":first-child").classed("d3-nav navbar p-1",!0),t.menu.append("h4").classed("title",!0))}}),Tn.events.on("before-draw.menu",function(t){t&&t.menu&&function(t){var e=t.getModel("menu"),n=t.dim(e.height,t.height,e.minHeight,e.maxHeight);t.menu.style("height",n+"px")}(t)}),e.assign(Tn.schema.definitions,{data:{type:"array",items:{$ref:"#/definitions/dataSource"}},dataSource:{oneOf:On.values().map(function(t){var e=t.prototype.schema;return e.properties.transforms={$ref:"#/definitions/transforms"},e})}}),Rn.getData=function(){var t=this.model.data;{if(t)return this.dataStore.getData(t,{$visual:this});gn("Visual "+this.visualType+" without data name, cannot get data")}},Rn.getContext=function(t){return this.dataStore.model.$child(t)},Tn.events.on("before-init.data",function(t){t.isViz&&(t.data=e.pop(t.options,"data"))}),Tn.events.on("after-init.data",function(t){Object.defineProperties(t,{dataStore:{get:function(){return t.model.root.dataStore}}}),t.isViz?function(t){var n=t.dataStore,r=e.pop(t,"data");r&&(e.isString(r)&&(r={source:r}),r.name||(r.name=t.model.uid),(r=n.addSources(r))?t.model.$set("data",r.name):gn("Could not create data source "+r.name))}(t):function(t){var n=t.dataStore,r=e.pop(t.options,"data");n||(n=new J(t.getModel("dataContext")),t.model.root.dataStore=n),n.addSources(r)}(t)});var Wn=n.map(),Xn=function(t,e){var n=Wn.get(t);return n||(n=c.format(t),Wn.set(t,n)),2==arguments.length?n(e):n},Yn=n.map(),Hn=function(t,e){var n=Yn.get(t);return n||(n=u.timeFormat(t),Yn.set(t,n)),2==arguments.length?n(e):n};if(Tn.options.dataContext={$format:Xn,$formatTime:Hn},Rn.format=function(t){var e=this.dataStore.eval(t);if(e)return e;try{return Xn(t)}catch(e){return Hn(t)}},Tn.options.font={size:"3%",minSize:10,maxSize:20,stroke:"#333",family:null},Rn.font=function(t,e){e=e||this.getModel("font");var n=this.getModel(),r=this.dim(e.size,t.height,e.minSize,e.maxSize);return n.fontSizeMultiplier&&(r*=n.fontSizeMultiplier),r},yn.resizeDelay||(yn.resizeDelay=200),e.inBrowser){var In=Ht(function(){Tn.live.forEach(function(t){return t.resize()})},yn.resizeDelay);i.select(window).on("resize.visuals",In)}yn.title={text:null,size:"3%",minSize:15,maxSize:25,offset:["10%",0]},Tn.events.on("before-init.title",function(t){var n=t.options.title;e.isString(n)&&(t.options.title={text:n})}),Tn.events.on("after-draw.title",function(t){var e=t.getModel("title"),n=t;if("visual"===n.visualType)delete n.__title;else{if(!t.isViz)return;n=t.visualParent}if(e.text)if(n.menu&&!n.__title)n.__title=e,function(t,e){var n=function(t){return+t.substring(0,t.length-2)}(t.menu.style("height")),r=e.maxSize?Math.min(n-4,e.maxSize):n-4,i=t.dim(e.size,t.width,e.minSize,r);t.menu.select(".title").html(e.text).style("font-size",i+"px").style("line-height",n+"px")}(n,e);else if(t.isViz){var r=t.boundingBox(!0),i=t.getModel("font"),o=e.stroke||i.stroke,a=t.font(r,e),s=t.group().selectAll("text.chartitle").data([e.text]),u=t.dim(e.offset[0],r.vizHeight),l=t.dim(e.offset[1],r.vizWidth),c=t.translate(r.margin.left+r.innerWidth/2+l,u);s.enter().append("text").classed("chartitle",!0).attr("transform",c).style("text-anchor","middle").style("font-size",a).style("fill",o).text(function(t){return t}).merge(s).transition().attr("transform",c).style("font-size",a).style("fill",o).text(function(t){return t})}});var Bn=["top","bottom","left","right"],Vn=["left","right"];yn.margin={top:20,bottom:20,left:20,right:20},yn.padding={top:0,bottom:0,left:0,right:0},Rn.boundingBox=function(t){if(t&&ut(this),!this.__boundingBox){var e=this.visualParent.width,n=this.visualParent.height,r=st(this.getModel("padding"),e,n),i=e-r.left-r.right,o=n-r.top-r.bottom,a=st(this.getModel("margin"),i,o),s=Bn.reduce(function(t,e){return t[e]=a[e]+r[e],t},{});this.__boundingBox={margin:a,padding:r,total:s,width:e,height:n,vizWidth:i,vizHeight:o,innerWidth:e-s.left-s.right,innerHeight:n-s.top-s.bottom,$nomargins:lt}}return this.__boundingBox},Tn.events.on("after-init.margin",function(t){t.margin=at("margin",t),t.padding=at("padding",t)}),Tn.events.on("before-draw.margin",function(t){t.isViz&&ut(t)});var Gn={ticks:5,tickSize:6,tickSizeOuter:null,rotate:null,ancor:"end",format:null,timeFormat:"%Y-%m-%d",stroke:"#333",hide:null,title:null,titleRotate:null,titleOffset:.7};Tn.options.xAxis=e.assign({location:"bottom"},Gn),Tn.options.yAxis=e.assign({location:"left"},Gn),Rn.getAxis=function(t,e){return this.getD3("axis",t)(e)},Rn.xAxis1=function(t,e,n,r){var i=this.getModel("xAxis"),o=this._axis(t,e,i,r),a=this.group("x-axis");return this.applyTransform(a,this.translateAxis(t,n)),dt(a.transition(this.transition("x-axis")).call(o),i,e),i.title&&this.axisTitle(a,t,e,n,i),a},Rn.yAxis1=function(t,e,n,r){var i=this.getModel("yAxis"),o=this._axis(t,e,i,r),a=this.group("y-axis");return this.applyTransform(a,this.translateAxis(t,n)),dt(a.transition(this.transition("x-axis")).call(o),i,e),i.title&&this.axisTitle(a,t,e,n,i),a},Rn.axisTitle=function(t,e,n,r,i){var o=t.selectAll("text.title").data([i.title]),a=i.titleRotate||0,s=0,u=0;a||"right"!==e&&"left"!==e||(a=-90),"left"==e&&(s=-i.titleOffset*r.margin.left,u=r.innerHeight/2);var l="translate("+s+","+u+") rotate("+a+")",c=this.font(r);o.enter().append("text").classed("title",!0).attr("transform",l).style("text-anchor","middle").style("font-size",c).style("fill",i.stroke).text(function(t){return t}).merge(o).transition().attr("transform",l).style("font-size",c).style("fill",i.stroke).text(function(t){return t})},Rn.translateAxis=function(t,e){return"top"===t||"left"===t?this.translate(e.margin.left,e.margin.top):"bottom"===t?this.translate(e.margin.left,e.margin.top+e.innerHeight):this.translate(e.margin.left+e.innerWidth,e.margin.top)},Rn._axis=function(t,n,r,i){var o=this.getAxis(t,n).tickSize(r.tickSize);return null!==r.tickSizeOuter&&o.tickSizeOuter(r.tickSizeOuter),e.isDate(i)?o.tickFormat(u.timeFormat(r.timeFormat)):null!==r.format&&o.tickFormat(this.format(r.format)),o.ticks(r.ticks)},Rn.getSymbol=function(t){return this.$.symbol().type(this.getD3("symbol",t))},Rn.getCurve=function(t){return this.getD3("curve",t)},Rn.getStack=function(){var t=this.getModel();if(t.stack){var e=this.$.stack();return t.stackOrder&&e.order(this.getD3("stack",t.stackOrder)),t.stackOffset&&e.offset(this.getD3("stack",t.stackOffset)),e}};var Un=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t},Kn="\\s*([+-]?\\d+)\\s*",Jn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Zn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Qn=/^#([0-9a-f]{3})$/,tr=/^#([0-9a-f]{6})$/,er=new RegExp("^rgb\\("+[Kn,Kn,Kn]+"\\)$"),nr=new RegExp("^rgb\\("+[Zn,Zn,Zn]+"\\)$"),rr=new RegExp("^rgba\\("+[Kn,Kn,Kn,Jn]+"\\)$"),ir=new RegExp("^rgba\\("+[Zn,Zn,Zn,Jn]+"\\)$"),or=new RegExp("^hsl\\("+[Jn,Zn,Zn]+"\\)$"),ar=new RegExp("^hsla\\("+[Jn,Zn,Zn,Jn]+"\\)$"),sr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Un(ht,pt,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}}),Un(yt,function(t,e,n,r){return 1===arguments.length?vt(t):new yt(t,e,n,null==r?1:r)},ft(ht,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new yt(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new yt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}})),Un(wt,xt,ft(ht,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new wt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new wt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new yt(kt(t>=240?t-240:t+120,i,r),kt(t,i,r),kt(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var ur=Math.PI/180,lr=180/Math.PI,cr=.95047,dr=1,fr=1.08883,hr=4/29,pr=6/29,gr=3*pr*pr,mr=pr*pr*pr;Un(_t,function(t,e,n,r){return 1===arguments.length?Et(t):new _t(t,e,n,null==r?1:r)},ft(ht,{brighter:function(t){return new _t(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new _t(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return t=dr*At(t),e=cr*At(e),n=fr*At(n),new yt(zt(3.2404542*e-1.5371385*t-.4985314*n),zt(-.969266*e+1.8760108*t+.041556*n),zt(.0556434*e-.2040259*t+1.0572252*n),this.opacity)}})),Un($t,St,ft(ht,{brighter:function(t){return new $t(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new $t(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return Et(this).rgb()}}));var vr=-.14861,yr=1.78277,br=-.29227,xr=-.90649,wr=1.97294,kr=wr*xr,Er=wr*yr,_r=yr*br-xr*vr;Un(Ct,Pt,ft(ht,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Ct(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Ct(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*ur,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new yt(255*(e+n*(vr*r+yr*i)),255*(e+n*(br*r+xr*i)),255*(e+n*(wr*r)),this.opacity)}}));var Mr=n.map();yn.color={scale:"cool",scaleMinPoints:6,scaleOffset:0,stroke:"#333",strokeOpacity:1,fillOpacity:1},Mr.set("viridis",function(t){return t.scaleSequential(t.interpolateViridis)}),Mr.set("inferno",function(t){return t.scaleSequential(t.interpolateInferno)}),Mr.set("magma",function(t){return t.scaleSequential(t.interpolateMagma)}),Mr.set("plasma",function(t){return t.scaleSequential(t.interpolatePlasma)}),Mr.set("warm",function(t){return t.scaleSequential(t.interpolateWarm)}),Mr.set("cool",function(t){return t.scaleSequential(t.interpolateCool)}),Mr.set("rainbow",function(t){return t.scaleSequential(t.interpolateRainbow)}),Mr.set("cubehelix",function(t){return t.scaleSequential(t.interpolateCubehelixDefault)}),Rn.getColorScale=function(t){return Mr.get(t)(this.$)},Rn.colors=function(t,n){var r=this.getModel("color"),i=!1,o=void 0,a=void 0;if(e.isArray(r.scale))a=this.getScale("ordinal").range(r.scale);else{if(!(o=this.getColorScale(r.scale)))throw new Error("Unknown scale "+r.scale);e.isObject(o)||(o={scale:o}),void 0===o.minPoints&&(o.minPoints=r.scaleMinPoints),a=o.scale,i=o.reversed}if(e.isFunction(a.interpolator)){var u=r.scaleOffset,l=t+u,c=Math.max(l,o.minPoints),d=i?[c-1,0]:[0,c-1];a.domain(d);var f=void 0;return s.range(u,Math.min(l,c)).map(function(t){return f=pt(a(t)),f.opacity=n,f})}var h=a.range().slice();i&&h.reverse();for(var p=void 0,g=void 0,m=void 0,v=0;v<r.scaleOffset;++v)h.push(h.shift());return s.range(t).map(function(){return p=h.shift(),g=pt(p),m=pt(p),g.opacity=n,h.push(""+m.brighter(.2)),g})},Rn.fill=function(t){function e(t,e){return i[e]}var n=this.getModel("color"),r=this.modelProperty("fillOpacity",n),i=this.colors(t.length,r);return e.colors=i,e},Rn.stroke=function(t){function e(t,e){return i[e]}var n=this.getModel("color"),r=this.modelProperty("strokeOpacity",n),i=this.colors(t.length,r);return e.colors=i,e},Rn.linearGradient=function(t,e,n,r){var i=this.paper().sel,o=i.select("defs");o.node()||(o=i.append("defs"));var a=o.selectAll("#"+r).data([0]),s=pt(t);s.opacity=.1,a.enter().append("linearGradient").attr("id",r).attr("x1","0%").attr("y1","0%").attr("x2","vertical"===n?"0%":"100%").attr("y2","vertical"===n?"100%":"0%");var u=o.select("#"+r).selectAll("stop").data([{offset:"0%",color:t},{offset:"100%",color:s}]);return u.enter().append("stop").merge(u).attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}),"url(#"+r+")"},yn.legend={location:"top-right",orient:"vertical",fontSize:"3%",title:"",titleWidth:"20%",labelFormat:null,titleMinWidth:30,titleMaxWidth:60,minFontSize:10,maxFontSize:20,offset:[10,10],shapeWidth:15,shapeHeight:15,hide:300},Rn.getLegend=function(t){return this.getD3("legend",t)},Rn.legend=function(t,n){var r=this.getModel(),i=this.getModel("legend"),o=this.getModel("font"),a=e.pop(t,"type")||r.legendType,s=Math.max(n.vizHeight,n.vizWidth),u=this.dim(i.fontSize,s,i.minFontSize,i.maxFontSize),l=this.getLegend(a);if(i.location){if(!l)return gn("Could not load legend "+a);if(l=l().orient(i.orient),i.title&&(l.title(i.title),i.titleWidth)){var c=this.dim(i.titleWidth,s,i.titleMinWidth,i.titleMaxWidth);l.titleWidth(c)}i.labelFormat&&l.labelFormat(i.labelFormat),l.shapeWidth(i.shapeWidth).shapeHeight(i.shapeHeight);for(var d in t)l[d](t[d]);var f=this.group("legend").style("font-size",u+"px").html("").call(l),h=f.node().getBBox(),p=Ar.get(i.location).call(this,h,n,i),g=this.translate(p.x,p.y);f.selectAll("text").style("fill",i.stroke||o.stroke),this.applyTransform(f,g),i.hide&&(s<i.hide?f.style("opacity",0):f.style("opacity",1))}};var Ar=n.map({top:function(t,e,n){var r=this.dim(n.offset[1],e.vizHeight);return{x:e.margin.left+(e.innerWidth-t.width)/2,y:r}},bottom:function(t,e,n){var r=this.dim(n.offset[1],e.vizHeight);return{x:e.margin.left+(e.innerWidth-t.width)/2,y:e.vizHeight-t.height-r}},right:function(t,e,n){var r=this.dim(n.offset[0],e.vizWidth);return{x:e.vizWidth-t.width-r,y:e.margin.top+(e.innerHeight-t.height)/2}},left:function(t,e,n){var r=this.dim(n.offset[0],e.vizWidth);return{x:e.margin.left-r,y:e.margin.top+(e.innerHeight-t.height)/2}},"top-left":function(t,e,n){var r=this.dim(n.offset[0],e.vizWidth),i=this.dim(n.offset[1],e.vizHeight);return{x:e.margin.left+(e.innerWidth-t.width)/2+r,y:i}},"top-right":function(t,e,n){var r=this.dim(n.offset[0],e.vizWidth),i=this.dim(n.offset[1],e.vizHeight);return{x:e.vizWidth-t.width-r,y:i}},"bottom-left":function(t,e,n){var r=this.dim(n.offset[0],e.vizWidth),i=this.dim(n.offset[1],e.vizHeight);return{x:t.width+r,y:e.vizHeight-t.height-i}},"bottom-right":function(t,e,n){var r=this.dim(n.offset[0],e.vizWidth),i=this.dim(n.offset[1],e.vizHeight);return{x:e.vizWidth-t.width-r,y:e.vizHeight-t.height-i}}}),zr=function(t){return function(){return t}},Or=function(t){return e.isFunction(t)?t:zr(t)},Sr=function(t){return t},$r=n.map({darker:function(){function t(t,e){var n=t.getModel("mouse"),r=pt(e.style("fill")),i=r.darker(n.darkerFactor);e.node().__mouse_over__.fill=r,e.style("fill",i)}return t.out=function(t,e){var n=e.node().__mouse_over__.fill;n&&e.style("fill",n)},t}(),fill:function(){function t(t,e){var n=t.getModel("mouse"),r=pt(e.style("fill"));e.node().__mouse_over__.fill=r,e.transition().style("fill",n.fillColor)}return t.out=function(t,e){var n=e.node().__mouse_over__.fill;n&&e.transition().style("fill",n)},t}()});Tn.options.mouse={over:["darker"],darkerFactor:.5,fillColor:"#addd8e"},Rn.mouseOver=function(){var t=this,e=this.getModel("mouse");return function(n,r){this.__mouse_over__||(this.__mouse_over__={});var i=t.select(this),o=void 0;e.over.forEach(function(e){(o=$r.get(e))?o(t,i,n,r):gn("Unknown mouse strategy "+e)})}},Rn.mouseOut=function(){var t=this,e=this.getModel("mouse");return function(n,r){this.__mouse_over__||(this.__mouse_over__={});var i=t.select(this),o=void 0;e.over.forEach(function(e){(o=$r.get(e))?o.out(t,i,n,r):gn("Unknown mouse strategy "+e)})}},Tn.options.tooltip={location:"top",offset:[10,10],html:""},e.inBrowser?Rn.tooltip=function(){function t(){return null===u&&(u=i.select(document.body).append("div").classed("d3-tooltip",!0).style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box").node(),l=i.select(document.body).append("svg").style("opacity",0).style("pointer-events","none").node().createSVGPoint()),i.select(u)}function e(){}function r(t){for(;null==t.getScreenCTM&&null==t.parentNode;)t=t.parentNode;var e={},n=t.getScreenCTM(),r=t.getBBox(),i=r.width,o=r.height,a=r.x,s=r.y;return l.x=a,l.y=s,e.nw=l.matrixTransform(n),l.x+=i,e.ne=l.matrixTransform(n),l.y+=o,e.se=l.matrixTransform(n),l.x-=i,e.sw=l.matrixTransform(n),l.y-=o/2,e.w=l.matrixTransform(n),l.x+=i,e.e=l.matrixTransform(n),l.x-=i/2,l.y-=o/2,e.n=l.matrixTransform(n),l.y+=o,e.s=l.matrixTransform(n),e}var o=Or("top"),a=Or([0,0]),s=Or(" "),u=null,l=null,c=n.map({top:function(t,e){var n=r(t);return{left:n.n.x-u.offsetWidth/2,top:n.n.y-u.offsetHeight-e[1]}},bottom:function(t,e,n){return{top:e.total.left+(e.innerWidth-t.width)/2,left:e.height-t.height-n.offsetY}},right:function(t,e){var n=r(t);return{left:n.e.x+e[0],top:n.e.y-u.offsetHeight/2}},left:function(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}},"top-left":function(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:n.offsetY}},"top-right":function(t,e,n){return{x:e.width-t.width-n.offsetX,y:n.offsetY}},"bottom-left":function(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}},"bottom-right":function(t,e,n){return{x:e.total.left+(e.innerWidth-t.width)/2,y:e.height-t.height-n.offsetY}}}),d=c.keys();return e.show=function(n){var r,i=Array.prototype.slice.call(arguments),u=t(),l=s.apply(this,i)||"",f=a.apply(this,i),h=o.apply(this,i),p=document.documentElement.scrollTop||document.body.scrollTop,g=document.documentElement.scrollLeft||document.body.scrollLeft;u.html(l).style("opacity",1).style("pointer-events","all");for(var m=d.length;m--;)u.classed(d[m],!1);return r=c.get(h).call(this,n,f),u.classed(h,!0).style("top",r.top+p+"px").style("left",r.left+g+"px"),e},e.hide=function(){return t().style("opacity",0).style("pointer-events","none"),e},e.location=function(t){return arguments.length?(o=null===t?t:Or(t),e):o},e.html=function(t){return arguments.length?(s=null===t?t:Or(t),e):s},e.offset=function(t){return arguments.length?(a=null==t?t:Or(t),e):a},e}():Rn.tooltip=Sr,$r.set("tooltip",function(){function t(t,e,n,r){var i=t.tooltipHtml(e,n,r);if(i){var o=t.getModel("tooltip");t.tooltip.location(o.location).offset(o.offset).html(i).show(e.node())}}return t.out=function(t){t.tooltip.hide()},t}()),Rn.tooltipHtml=function(t,e,n){var r=this.getModel("tooltip");if(r.html)return this.dataStore.eval(r.html,{d:e,index:n,model:this.getModel()})},Tn.options.expand={location:"top-right",expandText:"expand",collapseText:"collapse",height:15,width:15,radius:3,offset:[0,0],stroke:"#adadad",fill:"#fff",fillOver:"#e6e6e6",textColor:"#111"},Tn.events.on("after-draw.expand",function(t){function e(){t.select(this).select("rect.button").attr("fill",r.fill)}var n=t.visualParent;if(t.isViz&&!(n.layers.length<=1)){var r=t.getModel("expand");if(t.__expanded||r.location&&function(t){return t.left||t.right||t.top||t.bottom}(t.getModel("padding"))){var i=t.getModel("font"),o=t.boundingBox(),a=t.group("expand"),s=a.node(),u=Math.floor(.8*Math.min(r.width,r.height)),l=t.__expanded?r.collapseText:r.expandText,c=!1;a.select("rect").size()||(c=!0,a.attr("cursor","pointer").on("mouseover",function(){t.select(this).select("rect.button").attr("fill",r.fillOver)}).on("mouseout",e),a.append("rect").classed("button",!0).attr("x",0).attr("y",0).attr("rx",r.radius).attr("ry",r.radius).attr("width",r.width).attr("height",r.height).attr("stroke",r.stroke).attr("fill",r.fill).attr("cursor","pointer"),a.append("text").attr("x",r.width/2).attr("y",r.height/2).attr("fill",r.textColor).attr("font-family",r.fontFamily||i.family).attr("text-anchor","middle").attr("alignment-baseline","middle").attr("font-size",u),a.append("rect").classed("placeholder",!0).attr("x",0).attr("y",0).attr("rx",r.radius).attr("ry",r.radius).attr("width",r.width).attr("height",r.height).attr("stroke","none").attr("fill","transparent").on("click",function(){var r=t.getModel("padding");if(e.call(this),t.__expanded){var i=t.__expanded.padding;delete t.__expanded,n.activate(),Bn.forEach(function(t){i[t]&&(r[t]=i[t])})}else t.__expanded={padding:Bn.reduce(function(t,e){return r[e]&&(t[e]=r[e],r[e]=0),t},{})},n.deactivate(),t.activate();n.redraw(!1)})),a.select("text").text(function(){return l});var d=Ar.get(r.location).call(t,s.getBBox(),o,r);c||(a=a.transition(t.transition("expand"))),a.attr("transform",t.translate(d.x,d.y))}}}),Tn.options.transition={duration:250,delay:0,ease:null},Rn.transition=function(t){var e=this.idname(t),n=this.getModel("transition");return l.transition(e).duration(n.duration)},Rn.applyTransform=function(t,e){t.attr("transform")||t.attr("transform",e),t.transition().attr("transform",e)},Rn.brushX=function(){return this.$.brushX()},Rn.brushY=function(){return this.$.brushY()},Rn.brush=function(){return this.$.brush()};var Pr=Dn("container",{initialise:function(){this.live=[],this.visualParent&&this.visualParent.live.push(this)},draw:function(t){if(this.drawing)return gn(this.toString()+" already drawing"),this.drawing;var e=this;return Tn.events.call("before-draw",void 0,e),Promise.all(this.live.map(function(e){return e.redraw(t)})).then(function(){delete e.drawing,Tn.events.call("after-draw",void 0,e)})},destroy:function(){this.pop(this.visualParent)}}),Cr={props:["schema","datasource","plugins","options"],render:function(t,n,r){var i=this,o=this.select(r).html();return this.getSchema(t.schema,function(r){return e.isObject(r)||(r={}),r=e.assign({},t.options,r),i.build(r,o,n)})},getSchema:function(t,n){var r=this.model.visual;if(r&&r!==this.model&&e.isString(t)){var i=r.getVisualSchema(t);i&&(t=i)}return e.isString(t)?this.json(t).then(n).catch(function(e){gn("Could not reach "+t+": "+e,e)}):n(t)},build:function(){}},Tr=e.assign({},Cr,{build:function(t,e,n){var r=this.model,i=this.createElement("div"),o=r.root;return n.class&&i.attr("class",n.class),t.visuals||(t.visuals={}),r.visual=new Pr(i.node(),t,r.visual,r.visual?null:r.$new()),o.visualDashboard||(o.visualDashboard=r.visual),i.html(e)}}),jr=e.assign({},Cr,{build:function(t,n,r){var i,o=this.createElement("div"),a=t.type||"visual",s=this.model,u=e.pop(t,"visualDrawOnMount"),l={};return r.class&&o.attr("class",r.class),"visual"===a?(i=e.pop(t,"layers"),l=t):l.visual=e.pop(t,"visual")||{},void 0!==u&&(s.visualDrawOnMount=u),s.visual=new Nn(o.node(),l,s.visual,s.visual?null:s.$new()),"visual"!==a?s.visual.addVisual(t):i&&i.forEach(function(t){return s.visual.addVisual(t)}),o},mounted:function(){!1!==this.model.visualDrawOnMount&&this.model.visual.redraw()}}),Dr={install:function(t){t.addComponent("dashboard",Tr),t.addComponent("visual",jr)}},Nr=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},qr=function(t,e){var n=t[0],r=(t[1]-n)/e,i=Math.floor(Math.log10(r)),o=Math.pow(10,i);r/o>5&&(o*=10);var a=(o*=.1)*Math.ceil(r/o),s=o*Math.floor(n/o);return[s,s+e*a]},Rr=function(t,e,n){return.299*(t=pt(t)).r+.587*t.g+.114*t.b>186?n||"#000":e||"#fff"},Fr=function(t,e,n){e=Or(e),t.each(function(t,r){var o=i.select(this),a=parseFloat(o.attr("dy"))||0,s=e(t,r),u=o.text().split("\n"),l=void 0,c=void 0,d=void 0,f=o.text(null).append("tspan").attr("x",0).attr("dy",a+"em");u.forEach(function(t,e){for(d=[],c=t.split(/\s+/).reverse(),e&&(f=o.append("tspan").attr("x",0).attr("dy",1.2+a+"em"));l=c.pop();)d.push(l),f.text(d.join(" ")),f.node().getComputedTextLength()>s&&d.length>1&&(d.pop(),f.text(d.join(" ")),d=[l],f=o.append("tspan").attr("x",0).attr("dy",1.2+a+"em").text(l))}),n&&o.selectAll("tspan").each(n)})},Lr=["linear","log","time"];e.assign(Tn.schema.definitions,{curve:{type:"string",description:"curve type for line and area charts",default:"natural",enum:["basis","basisClosed","basisOpen","bundle","cardinal","cardinalClosed","cardinalOpen","catmullRom","catmullRomClosed","catmullRomOpen","linear","linearClosed","monotoneX","monotoneY","natural","step","stepAfter","stepBefore"]},stack:{type:"object",properties:{order:{type:"string",enum:["ascending","descending","insideOut","none","reverse"],default:"none"},offset:{type:"string",enum:["diverging","expand","none","silhouette","wiggle"],default:"none"}}}});var Wr={lineWidth:{type:"number",default:1},curve:{$ref:"#/definitions/curve"},cornerRadius:{type:"number",default:0,minimum:0,description:"corner radius in pixels"},x:{type:"string",description:"data accessor for the x coordinate",default:"x"},y:{type:"string",description:"data accessor for the y coordinate",default:"y"},scaleX:{type:"string",description:"scale for the x coordinate",enum:Lr,default:"linear"},scaleY:{type:"string",description:"scale for the y coordinate",enum:Lr,default:"linear"},axisX:{type:"boolean",description:"draw x axis",default:!1},axisY:{type:"boolean",description:"draw y axis",default:!1},groupby:{type:"string",description:"Group data by a given dimension"},stack:{$ref:"#/definitions/stack"},gradient:{type:"boolean",description:"Gradient to zero opacity",default:!1},lineDarken:{type:"number",description:"Darken line color",minimum:0,maximum:1,default:.2}},Xr={center:"middle",top:"hanging",bottom:"baseline",outside:"baseline"},Yr={center:function(t,e){return e/2},top:function(t,e,n){return n},bottom:function(t,e,n){return e-n},outside:function(t,e,n){return-n}};qn("barchart",{requires:["d3-scale","d3-axis","d3-svg-legend"],schema:{x:Wr.x,y:Wr.y,orientation:{type:"string",enum:["vertical","orizontal"],default:"vertical"},groupby:Wr.groupby,stack:Wr.stack,waffle:{type:"boolean",description:"ability to draw a waffle chart"},normalize:{type:"boolean"},lineWidth:Wr.lineWidth,cornerRadius:Wr.cornerRadius,axisX:Wr.axisX,axisY:Wr.axisY,scaleY:Wr.scaleY,sortby:{type:"string",enum:["x","y"]},label:{type:"string",description:"expression for label text"},scaleX:{type:"object",default:{type:"band",padding:.2},properties:{type:{type:"string"},padding:{type:"number"}}}},options:{labelLocation:"center",labelOffset:10,labelWidth:.7,valueformat:".1f",legendType:"color",legendLabel:"label"},doDraw:function(){var t=this.getModel(),e=this.frame,n=e.data,r=this.boundingBox(),i=this.group(),o=this.group("chart"),a=t.x,s=t.y,u=t.groupby,l="vertical"===t.orientation?new Tt(this):new jt(this),c=void 0,d=!1;if(this.applyTransform(i,this.translate(r.padding.left,r.padding.top)),this.applyTransform(o,this.translate(r.margin.left,r.margin.top)),u&&(c=e.dimension(u).group().top(1/0).map(function(t){return t.key})).length<=1&&(c=null),c){var f=e.pivot(a,u,s);"y"===t.sortby&&(f=f.sortby("total")),n=f.data,l.sz.domain(c).range(this.fill(c).colors),t.stack&&(t.normalize&&(n=this.normalize(f)),d=!0)}else l.sz.domain([s]).range(this.fill([s]).colors),d=!0;var h=n.map(function(t){return t[a]});l.sx.domain(h),d||!c?l.stacked(o,n,c):l.grouped(o,n,c),l.axis(h),l.legend(c)}});var Hr={init:function(t){this.viz=t,this.model=t.getModel(),this.box=t.boundingBox(),this.sx=t.getScale(this.model.scaleX),this.sy=t.getScale(this.model.scaleY),this.sz=t.getScale("ordinal")},legend:function(t){t&&this.viz.legend({type:"color",scale:this.sz},this.box)},stacked:function(t,e,n){function r(t){return h(t[1-_])-h(t[_])}function i(t){return f(t.data[g])}function o(t){return h(t[_])}function a(t){return t.forEach(function(e){e.key=t.key,e.value=e.data[t.key]}),t}function u(t,e){var n=k(t,e)+x(t,e)/2,r=E(t,e)+P(t,w(t,e),T);return v.translate(n,r)}function l(t){return Rr(p(t.key),"#fff",A.stroke)}function c(t,e){return v.dataStore.eval(z,{d:t,index:e})}var d=this.viz.getModel("color"),f=this.sx,h=this.sy,p=this.sz,g=this.model.x,m=this.model.y,v=this.viz,y=this.model.cornerRadius,b=t.selectAll(".group"),x=void 0,w=void 0,k=void 0,E=void 0,_=void 0,M=void 0;if(n?this.sy.domain([0,s.max(e,function(t){return t.total})]).nice():(this.sy.domain([0,s.max(e,function(t){return t[m]})]).nice(),n=[this.model.y]),this.vertical?(k=i,E=o,x=f.bandwidth,w=r,_=1):(k=o,E=i,x=r,w=f.bandwidth,_=0),e=v.getStack().keys(n)(e),(b=b.data(e)).exit().transition().style("opacity",0).remove(),(M=b.enter().append("g").classed("group",!0).attr("fill",function(t){return p(t.key)}).merge(b).attr("fill",function(t){return p(t.key)}).attr("stroke",v.modelProperty("stroke",d)).attr("stroke-opacity",v.modelProperty("strokeOpacity",d)).selectAll("rect").data(a)).enter().append("rect").attr("x",k).attr("y",E).attr("height",w).attr("width",x).attr("rx",y).attr("ry",y).on("mouseover",v.mouseOver()).on("mouseout",v.mouseOut()).merge(M).transition().attr("x",k).attr("y",E).attr("height",w).attr("width",x),M.exit().transition().style("opacity",0).remove(),this.model.label){var A=v.getModel("font"),z=this.model.label,O=v.font(this.box)+"px",S=t.selectAll(".labels").data(e),$=this.vertical?Xr[this.model.labelLocation]||"baseline":"middle",P=Yr[this.model.labelLocation],C=this.model.labelWidth,T=this.model.labelOffset;(M=S.enter().append("g").classed("labels",!0).merge(S).selectAll("text").data(a)).enter().append("text").classed("label",!0).attr("transform",u).style("fill",l).style("font-size",O).text(c).merge(M).text(c).style("font-size",O).call(Fr,function(t){return C*x(t)},function(){v.select(this).attr("alignment-baseline",$).attr("text-anchor","middle")}).transition(v.transition("text")).attr("transform",u).style("fill",l)}},grouped:function(t,e,n){function r(t){return u(t[d])}function i(t){return l(t.value)}function o(t){return l(0)-l(t.value)}var a=this.viz.getModel("color"),u=this.sx,l=this.sy,c=this.sz,d=this.model.x,f=this.viz,h=this.model.cornerRadius,p=u.paddingInner(),g=f.getScale("band").domain(n).paddingInner(.5*p),m=t.selectAll(".group"),v=void 0,y=void 0,b=void 0,x=void 0;l.domain([0,s.max(e,function(t){return n.reduce(function(e,n){return Math.max(e,t[n])},0)})]).nice(),this.vertical?(g.rangeRound([0,u.bandwidth()]),b=r,v=g.bandwidth,y=o):(b=r,y=g.bandwidth,v=o),(m=m.data(e)).exit().remove(),(x=m.enter().append("g").classed("group",!0).attr("transform",function(t){return f.translate(b(t),0)}).merge(m).attr("transform",function(t){return f.translate(b(t),0)}).selectAll("rect").data(function(t){return n.map(function(e){return{key:e,value:t[e]}})})).exit().transition().style("opacity",0).remove(),x.enter().append("rect").attr("x",function(t){return g(t.key)}).attr("y",i).attr("rx",h).attr("ry",h).attr("height",y).attr("width",v).attr("stroke-width",this.model.lineWidth).attr("stroke",a.stroke).attr("stroke-opacity",0).attr("fill",function(t){return c(t.key)}).on("mouseover",f.mouseOver()).on("mouseout",f.mouseOut()).merge(x).transition(f.transition("rect")).attr("x",function(t){return g(t.key)}).attr("y",i).attr("height",y).attr("width",v).attr("stroke",a.stroke).attr("stroke-opacity",a.strokeOpacity).attr("fill",function(t){return c(t.key)}),x.exit().remove()}};Tt.prototype=e.assign({},Hr,{axis:function(t){this.model.axisX&&this.viz.xAxis1(!0===this.model.axisX?"bottom":this.model.axisX,this.sx,this.box,t[0]),this.model.axisY&&this.viz.yAxis1(!0===this.model.axisY?"left":this.model.axisY,this.sy,this.box)}}),jt.prototype=e.assign({},Hr,{axis:function(t){this.model.axisX&&this.viz.xAxis1(!0===this.model.axisX?"left":this.model.axisX,this.sx,this.box,t[0]),this.model.axisY&&this.viz.yAxis1(!0===this.model.axisY?"bottom":this.model.axisY,this.sy,this.box)}});var Ir=function(){function t(t){var s=!1,u=void 0,l=void 0,c=void 0;return e&&(l=t.dimension(e).group().top(1/0).map(function(t){return t.key}).sort()).length<=1&&(l=null),l?(t=t.pivot(n,e,r),i&&(t=t.sortby("total")),u=t.data,o&&(a&&(u=function(t){return t}(u)),u=o.keys(l)(u),s=!0)):(u=t.data,l=[r]),s||(u=l.map(function(t,e){return c=u.map(function(e){return c=[0,e[t]],c.data=e,c}),c.index=e,c.key=t,c})),new Dt(u,n,r,s)}var e=null,n="x",r="y",i=!1,o=null,a=!1;return t.groupby=function(n){return arguments.length?(e=n,t):e},t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t.normalize=function(e){return arguments.length?(a=e,t):a},t.stack=function(e){return arguments.length?(o=e,t):o},t};Dt.prototype={rangeX:function(){return this.range(this.x)},rangeY:function(){return this.range()},range:function(t){function e(t){return t[0]}function n(t){return t[1]}function r(e){return e.data[t]}var i=void 0,o=void 0;return o=t?this.data.reduce(function(t,e){return i=s.extent(e,r),t.push(i[0]),t.push(i[1]),t},[]):this.data.reduce(function(t,r){return i=s.extent(r,e),t.push(i[0]),t.push(i[1]),i=s.extent(r,n),t.push(i[0]),t.push(i[1]),t},[]),s.extent(o)}},qn("linechart",{requires:["d3-scale","d3-shape","d3-axis","d3-svg-legend"],schema:{lineWidth:Wr.lineWidth,curve:Wr.curve,x:Wr.x,y:Wr.y,scaleX:Wr.scaleX,scaleY:Wr.scaleY,groupby:Wr.groupby,axisX:Wr.axisX,axisY:Wr.axisY},doDraw:function(){function t(t,e){return g[e]}var n=this.getModel(),r=this.frame,i=n.x,o=n.y,a=this.boundingBox(),s=Ir().groupby(n.groupby).x(i).y(o)(r),u=s.rangeX(),l=s.rangeY(),c=this.getScale(n.scaleX).domain(u).rangeRound([0,a.innerWidth]),d=this.getScale(n.scaleY).domain(l).rangeRound([a.innerHeight,0]).nice(),f=this.group(),h=this.group("chart"),p=h.selectAll(".line").data(s.data),g=this.stroke(s.data).colors,m=0,v=this.$.line().x(function(t){return c(t.data[i])+m}).y(function(t){return d(t[1])}).curve(this.getCurve(n.curve));this.applyTransform(f,this.translate(a.padding.left,a.padding.top)),this.applyTransform(h,this.translate(a.margin.left,a.margin.top)),e.isFunction(c.bandwidth)&&(c.domain(s.data[0].map(function(t){return t.data[i]})),m=c.bandwidth()/2),p.enter().append("path").attr("class","line").attr("fill","none").attr("stroke",t).attr("stroke-width",n.lineWidth).attr("d",v).merge(p).transition().attr("stroke",t).attr("stroke-width",n.lineWidth).attr("d",v),p.exit().transition().style("opacity",0).remove(),n.axisX&&this.xAxis1(!0===n.axisX?"bottom":n.axisX,c,a),n.axisY&&this.yAxis1(!0===n.axisY?"left":n.axisY,d,a),s.data.length>1&&this.legend({type:"color",scale:this.getScale("ordinal").range(g).domain(s.data.map(function(t){return t.key}))},a)}}),qn("areachart",{requires:["d3-scale","d3-shape","d3-axis","d3-svg-legend"],schema:{lineWidth:Wr.lineWidth,curve:Wr.curve,x:Wr.x,y:Wr.y,scaleX:Wr.scaleX,scaleY:Wr.scaleY,groupby:Wr.groupby,axisX:Wr.axisX,axisY:Wr.axisY,stack:Wr.stack,gradient:Wr.gradient,lineDarken:Wr.lineDarken},doDraw:function(){function t(t){return h(t.data[a])}function e(t){return p(t[0])}function n(t){return p(t[1])}var r=this,i=this.frame,o=this.getModel(),a=o.x,s=o.y,u=this.getModel("color"),l=this.boundingBox(),c=Ir().groupby(o.groupby).stack(this.getStack()).x(a).y(s)(i),d=c.rangeX(),f=c.rangeY(),h=this.getScale(o.scaleX).domain(d).rangeRound([0,l.innerWidth]),p=this.getScale(o.scaleY).domain(f).rangeRound([l.innerHeight,0]).nice(),g=this.group(),m=this.group("chart"),v=m.selectAll(".areagroup").data(c.data),y=this.colors(c.data.length),b=o.gradient?y.map(function(t,e){return r.linearGradient(t,l,"vertical","fill"+r.model.uid+"-"+e)}):y,x=this.getCurve(o.curve);this.applyTransform(g,this.translate(l.padding.left,l.padding.top)),this.applyTransform(m,this.translate(l.margin.left,l.margin.top)),v.exit().transition().style("opacity",0).remove();var w=v.enter().append("g").classed("areagroup",!0).merge(v).selectAll("path").data(function(i){var a=r.$.area().curve(x).x(t).y1(n).y0(e),s=r.$.line().curve(x).x(t).y(n),u=pt(y[i.index]);return[{type:"area",data:i,draw:a(i),stroke:"none",fill:b[i.index]},{type:"line",data:i,draw:s(i),fill:"none",stroke:u.darker(o.lineDarken)}]});w.enter().append("path").attr("class",function(t){return t.type}).attr("fill",function(t){return t.fill}).attr("stroke",function(t){return t.stroke}).attr("d",function(t){return t.draw}).merge(w).transition(this.transition("area")).attr("d",function(t){return t.draw}).attr("fill",function(t){return t.fill}).attr("stroke",function(t){return t.stroke}).attr("fill-opacity",u.fillOpacity).attr("stroke-width",o.lineWidth).attr("stroke-opacity",u.strokeOpacity),w.exit().transition().style("opacity",0).remove(),o.axisX&&this.xAxis1(!0===o.axisX?"bottom":o.axisX,h,l,d[0]),o.axisY&&this.yAxis1(!0===o.axisY?"left":o.axisY,p,l,f[0]),c.data.length>1&&this.legend({type:"color",scale:this.getScale("ordinal").range(y).domain(c.data.map(function(t){return t.key}))},l)},ticks:function(t,e){return Math.max(Math.floor(t/e),1)}});var Br=Math.PI/180,Vr={proportionalData:function(t,e){return t.dimension(e).top(1/0)},total:function(t){function e(e){return n+=e[t],e[t]}var n=0;return e.total=function(){return n},e}};qn("piechart",Vr,{requires:["d3-scale","d3-shape","d3-svg-legend"],schema:{field:{type:"string",default:"data"},label:{type:"string",default:"label"},startAngle:{description:"Overall start angle of the pie in degree",default:0,type:"number"},endAngle:{description:"Overall end angle of the pie in degree",default:360,type:"number"},sort:{type:"string",description:"sort data before visualizing",enum:["none","ascending","descending"],default:"none"},innerRadius:{description:"Inner radius for donuts",default:0,oneOf:[{type:"number",minimum:0},{type:"string"}]},padAngle:{description:"Angular separation between each adjacent arcs in degree",default:0,type:"number",minimum:0},cornerRadius:Wr.cornerRadius,lineWidth:Wr.lineWidth,center:{type:"string",description:"Expression which display information in the center of the pie chart. Should be used with innerRadius greater than 0"},centerFont:{description:"Center text font size and family",$ref:"#/definitions/font"}},doDraw:function(t){var e=this.getModel(),r=this.getModel("color"),i=e.field,o=this.boundingBox(),a=Math.min(o.innerWidth,o.innerHeight)/2,s=Z(e.innerRadius,a),u=this.total(i),l=this.$.pie().padAngle(Br*e.padAngle).startAngle(Br*e.startAngle).endAngle(Br*e.endAngle).value(u),d=this.$.arc().innerRadius(s).outerRadius(a).cornerRadius(e.cornerRadius),f=this.group(),h=this.group("chart"),p=l(this.proportionalData(t,i)),g=this.fill(p),m=h.selectAll(".slice").data(p);if(this.applyTransform(f,this.translate(o.padding.left,o.padding.top)),this.applyTransform(h,this.translate(o.margin.left+o.innerWidth/2,o.margin.top+o.innerHeight/2)),m.enter().append("path").attr("class","slice").attr("stroke",r.stroke).attr("stroke-opacity",0).attr("fill",g).attr("stroke-width",e.lineWidth).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(m).transition().attr("stroke",r.stroke).attr("stroke-opacity",r.strokeOpacity).attr("d",d).attr("fill",g),m.exit().transition().remove(),e.center){var v=n.map(p.reduce(function(t,e){return t[e.data.label]=e,t})),y=this.dataStore.eval(e.center,{total:u.total(),d:v});if(y){var b=this.getModel("font"),x=this.dim(e.centerFontSize,o.innerWidth),w=h.selectAll(".info").data([y]);w.enter().append("text").attr("class","info").attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-size",x+"px").style("fill-opacity",0).merge(w).text(y).style("fill-opacity",e.centerOpacity).style("fill",b.stroke).call(Fr,1.5*(s||a))}}if(e.legendType){u=u.total();var k=me(e.legendLabel),E=c.format(e.fractionFormat),_=p.map(function(t,n){return k.eval({d:t,value:t.value,format:E,total:u,fraction:t.value/u,label:t.data[e.label]||n})});this.legend({scale:this.getScale("ordinal").domain(_).range(g.colors)},o)}}});qn("pyramidchart",Vr,{requires:["d3-scale","d3-shape","d3-svg-legend"],options:{field:"data",label:"label",pad:.005,lineWidth:1,inverted:!1,funnel:!1,legendType:"color",invereted:!1,legendLabel:"label + ' - ' + format('.1%', fraction)"},doDraw:function(t){var e=this.getModel(),n=e.field,r=this.getModel("color"),i=this.boundingBox(),o=(e.funnel?function(){function t(t){var o=void 0,a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,f=0,h=0,p=t.length,g=new Array(p),m=new Array(p),v=r/p;for(o=0;o<p;++o)g[m[o]=o]=+e(t[o],o,t);for(m.sort(function(t,e){return Nr(g[t],g[e])}),l=g[m[0]],o=0;o<p;++o)a=m[o],u=g[a]/l,s=[[(c=i*u)/2,h+(d=f)],[-c/2,h+d],[-c/2,h+v-(f=r*(o===p-1?0:.5*n(u,o)))],[c/2,h+v-f]],h+=v,g[a]={index:o,value:g[a],fraction:u,points:s,data:t[a]};return g}var e=Sr,n=zr(0),r=1,i=1;return t.value=function(n){return arguments.length?(e="function"==typeof n?n:zr(+n),t):e},t.base=function(e){return arguments.length?(i=e,t):i},t.height=function(e){return arguments.length?(r=e,t):r},t.pad=function(e){return arguments.length?(n="function"==typeof e?e:zr(+e),t):n},t}():function(){function t(t){var o=void 0,a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,f=void 0,h=void 0,p=void 0,g=void 0,m=t.length,v=.5*i/r,y=new Array(m),b=new Array(m);for(o=0;o<m;++o)y[b[o]=o]=+e(t[o],o,t);for(b.sort(function(t,e){return Nr(y[t],y[e])}),h=y[b[0]],c=null,o=m-1;o>=0;--o)u=[],null===c?u.push([0,0]):(d=(f=c+p)*v,u.push([d,f]),u.push([-d,f])),a=b[o],s=m-o-1,l=y[a]/h,g=Math.sqrt(l),d=(f=(c=r*g)-(p=o?n(g,s):0))*v,u.push([-d,f]),u.push([d,f]),y[a]={index:s,value:y[a],fraction:l,points:u,data:t[a]};return y}var e=Sr,n=zr(0),r=1,i=1;return t.value=function(n){return arguments.length?(e="function"==typeof n?n:zr(+n),t):e},t.base=function(e){return arguments.length?(i=e,t):i},t.height=function(e){return arguments.length?(r=e,t):r},t.pad=function(e){return arguments.length?(n="function"==typeof e?e:zr(+e),t):n},t}()).pad(e.pad).value(function(t){return t[n]}),a=this.getScale("linear").rangeRound([0,i.innerWidth]),s=this.getScale("linear").rangeRound(e.inverted?[i.innerHeight,0]:[0,i.innerHeight]),u=t.new(o(this.proportionalData(t,n))).dimension("fraction").bottom(1/0),l=this.$.symbol().type(function(t){return function(t){return{draw:function(e){t.forEach(function(t,n){n?e.lineTo(t[0],t[1]):e.moveTo(t[0],t[1])}),e.closePath()}}}(t.points.map(function(t){return[a(t[0]),s(t[1])]}))}).size(1),c=this.fill(u),d=this.group(),f=this.group("chart"),h=f.style("shape-rendering","crispEdges").selectAll(".segment").data(u);if(this.applyTransform(d,this.translate(i.padding.left,i.padding.top)),this.applyTransform(f,this.translate(i.margin.left+i.innerWidth/2,i.margin.top)),h.enter().append("path").attr("class","segment").attr("stroke",r.stroke).attr("stroke-opacity",0).attr("fill",c).attr("stroke-width",e.lineWidth).attr("d",l).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(h).transition().attr("stroke",r.stroke).attr("stroke-opacity",r.strokeOpacity).attr("d",l).attr("fill",c),h.exit().remove(),e.legendType){var p=me(e.legendLabel),g=this,m=u.map(function(t,n){return p.eval(g.getContext({d:t,value:t.value,fraction:t.fraction,label:t.data[e.label]||n}))});this.legend({scale:this.getScale("ordinal").domain(m).range(c.colors)},i)}}});qn("treemap",{requires:["d3-scale","d3-hierarchy"],options:{label:"label",field:"data",padding:2,tile:"resquarify",format:","},doDraw:function(t,e){function n(t){return[t]}function r(t){var e=void 0;return t.map(function(t){return(e=t.children)&&(t._children=r(e),delete t.children),t})}var i=this,o=this.getModel(),a=this.getModel("font"),s=this.boundingBox(),u=rn(o.label),l=rn(o.field),d=c.format(o.format),f=e.hierarchy(function(t){return t={children:r(t)},t[o.label]="root",t}(t.data)).sum(l).sort(function(t,e){return e.value-t.value}).eachBefore(function(t){t.parent?(t.data._counter=t.parent.data._counter,t.parent.data._counter++):t.data._counter=0}),h=e.treemap().tile(function(t,e,n,r){return n.substring(0,e.length)!==e&&(n=""+e+n[0].toUpperCase()+n.substring(1)),r?t[n]:t[n]()}(e,"treemap",o.tile,!0)).size([s.innerWidth,s.innerHeight]).round(!0).padding(o.padding),p=this.fill(f.children).colors,g=this.group().attr("transform",this.translate(s.total.left,s.total.top)).style("shape-rendering","crispEdges"),m=h(f).leaves(),v=g.selectAll("g").data(m),y=this;this.paper().size(s),v.exit().remove();var b=(v=v.enter().append("g").attr("transform",function(t){return i.translate(t.x0,t.y0)}).merge(v).attr("transform",function(t){return i.translate(t.x0,t.y0)})).selectAll("rect").data(n);b.enter().append("rect").attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}).attr("fill",function(t){return p[t.data._counter]}).attr("stroke","none").on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(b).transition().attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}).attr("fill",function(t){return p[t.data._counter]}),(b=v.selectAll("text").data(n)).enter().append("text").style("fill",function(t){return Rr(p[t.data._counter],"#fff",a.stroke)}).selectAll("tspan").data(function(t){var e=y.font({height:Math.min(t.x1-t.x0,t.y1-t.y0)}),n=u(t.data).split(/(?=[A-Z][^A-Z])/g);return n.push(d(t.value)),n.map(function(t){return{size:e,text:t}})}).enter().append("tspan").style("font-size",function(t){return t.size}).attr("x",4).attr("y",function(t,e){return 1.5*t.size+1.2*e*t.size}).text(function(t){return t.text})}}),qn("text",{options:{label:"label",data:"data",text:'label + " " + data',sizeReduction:.7},doDraw:function(t){function e(t,e){return n.translate((e+.5)*c,0)}var n=this,r=this.getModel(),i=this.getModel("font"),o=this.boundingBox(),a=this.font(o),s=this.group(),u=this.group("chart"),l=u.selectAll("text").data(t.data),c=o.innerWidth/t.data.length,d=.4*c,f=this.dataStore,h=this.modelProperty("stroke",i);this.applyTransform(s,this.translate(o.padding.left,o.padding.top)),this.applyTransform(u,this.translate(o.margin.left,o.margin.top+o.innerHeight/2)),l.enter().append("text").attr("transform",e).attr("text-anchor","middle").attr("alignment-baseline","middle").style("fill",h).merge(l).attr("transform",e).text(function(t){return f.eval(r.text,t)}).style("fill",h).call(Fr,d,function(t,e){var i=a;e&&(i=r.sizeReduction*a),n.select(this).attr("font-size",i+"px")}),s.exit().remove()}}),qn("heatmap",{requires:["d3-scale","d3-axis","d3-svg-legend"],options:{shape:"square",layout:"heatmap",buckets:10,pad:.005,x:"x",y:"y",z:"data",label:null,axisX:!0,axisY:!0,reverseColors:!0,tableColors:null},doDraw:function(t){function e(t){return t.data[r.label]}function n(t){return Rr(t.color,"#fff",o.stroke)}var r=this.getModel(),i=this.getModel("color"),o=this.getModel("font"),a=r.layout,u=this.boundingBox(),l=s.extent(t.data,rn(r.z));l[0]<0&&"punchcard"===a&&(a="heatmap");var c=this.heatmap(a,t,u,l),d=(u.innerWidth-c.width)/2,f=(u.innerHeight-c.height)/2,h=this.getSymbol(r.shape).size(function(t){return t.size*t.size}),p=this.group(),g=this.group("chart"),m=g.selectAll(".shape").data(c.data);if(this.applyTransform(p,this.translate(u.padding.left,u.padding.top)),this.applyTransform(g,this.translate(u.margin.left+d,u.margin.top+f)),s.range[0]<0&&"punchcard"===a&&(a="heatmap"),m.enter().append("path").classed("shape",!0).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).attr("fill",function(t){return t.color}).attr("fill-opacity",0).attr("stroke-opacity",0).attr("stroke",i.stroke).attr("d",h).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(m).transition(this.transition()).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).attr("fill-opacity",i.fillOpacity).attr("fill",function(t){return t.color}).attr("stroke-opacity",i.strokeOpacity).attr("stroke",i.stroke).attr("d",h),r.label&&"heatmap"===a){var v=this.font(u)+"px",y=g.selectAll(".labels").data(c.data);y.enter().append("text").classed("labels",!0).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).style("text-anchor","middle").style("alignment-baseline","middle").style("fill",n).style("font-size",v).text(e).merge(y).text(e).style("font-size",v).call(Fr,Math.ceil(.8*c.size)).transition(this.transition("text")).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).style("fill",n)}var b={innerWidth:c.width,innerHeight:c.height,margin:{top:u.margin.top+f,left:u.margin.left+d}};r.axisX&&this.xAxis1(!0===r.axisX?"bottom":r.axisX,c.scaleX,b),r.axisY&&this.yAxis1(!0===r.axisY?"left":r.axisY,c.scaleY,b),"heatmap"===a?this.legend({type:"color",shape:r.shape,scale:c.colors},u):"punchcard"===a&&this.legend({type:"size",shape:r.shape,scale:c.sizes},u)},heatmap:function(t,e,r,i){var o=this.getModel(),a=o.pad,u=o.x,l=o.y,c=o.z,d=e.dimension(o.x).group().size(),f=e.dimension(o.y).group().size(),h=Math.min(o.buckets,d*f),p=(1-a*(d+1))*r.innerWidth/d,g=(1-a*(f+1))*r.innerHeight/f,m=[],v=[],y=[],b=n.map(),x=n.map(),w=void 0,k=void 0,E=void 0,_=void 0,M=void 0,A=void 0,z=void 0,O=void 0,S=void 0,$=void 0;if(p<g?(O=p,S=r.innerWidth,$=f*(O+(a*=S))+a):(O=g,$=r.innerHeight,S=d*(O+(a*=$))+a),i=qr(i,h),"heatmap"===t){var P=this.fill(s.range(h)).colors;o.reverseColors&&(P=P.reverse()),A=this.getScale("quantile").range(P).domain(i),z=function(){return 1}}else{var C=this.colors(1)[0];A=function(){return C},z=this.getScale("quantile").range(s.range(h).map(function(t){return(t+1)/h})).domain(i)}return e.data.forEach(function(t){w=t[u],k=t[l],E=t[c],b.has(w)||(b.set(w,v.length),v.push(w)),x.has(k)||(x.set(k,y.length),y.push(k)),_=b.get(w),M=x.get(k),m.push({i:_,j:M,x:a+O/2+_*(O+a),y:a+O/2+M*(O+a),color:A(E),size:O*z(E),data:t})}),{data:m,size:O,width:S,height:$,scaleX:this.getScale("band").domain(v).range([0,S]),scaleY:this.getScale("band").domain(y).range([0,$]),colors:A,sizes:z}}}),Rn.getGeoProjection=function(t){return this.getD3("geo",t)()},qn("geochart",{requires:["d3-scale","d3-geo","topojson","d3-geo-projection","d3-svg-legend"],schema:{geometry:{type:"string",description:"The geometry to visualize from the topojson geometry objects",default:"countries"},geoKey:{type:"string",default:"id"},dataKey:{type:"string",default:"id"},dataLabelKey:{type:"string",default:"label"},dataValueKey:{type:"string",default:"value"},neighbors:{type:"boolean",default:!1},buckets:{type:"number",default:10},choroplethScale:{type:"string",default:"quantile"},boundGeometry:{type:"string"},boundScaleFactor:{type:"number",default:.9},projection:{type:"string",default:"kavrayskiy7"},graticule:{type:"boolean",default:!1},leaflet:{type:"boolean",default:!1},scale:{type:"number",default:200}},doDraw:function(){var t=function(t){var e={};return"frameCollection"===t.type?t.frames.each(function(t){"Topology"===t.type?e.topology=t:"dataframe"===t.type&&(e.data=t.data)}):"Topology"===t.type&&(e.topology=t),e}(this.frame);if(!t.topology)return gn("Topojson data not available - cannot draw topology");this._geoPath||this.createGeoPath(t),this.update(t)},update:function(t){var n=this.getModel(),r=this.getModel("color"),i=this.boundingBox(),o=this.group(),a=this.group("geo"),u=this._geoPath,l=function(t,n,r){var i=r.geoKey,o=r.dataKey,a={},u=void 0,l=void 0,c=void 0;if(!n.topology)return gn("No topology object available");var d=n.topology.objects[r.geometry];if(!d)return gn("Topology object "+r.geometry+" is not available");var f=r.neighbors?t.neighbors(d.geometries):null;return u=t.feature(n.topology,d).features,n.data&&(a=n.data.reduce(function(t,e){return t[e[o]]=e,t},{})),u=u.map(function(t){return c=t.properties,l=t[i]||c[i],{id:l,type:t.type,geometry:t.geometry,data:e.assign({},c,a[l])}}),f&&u.forEach(function(t,e){t.neighbors=f[e],t.rank=s.max(t.neighbors,function(t){return u[t].rank})+1|0}),u}(this.$,t,n);if(!l){var c=Object.keys(t.topology.objects).map(function(t){return'"'+t+'"'}).join(", ");return gn('Could not find *geometry* "'+n.geometry+'" in ['+c+"] - cannot draw geochart")}o.transition(this.transition("group0")).attr("transform",this.translate(i.padding.left,i.padding.top)),a.transition(this.transition("group1")).attr("transform",this.translate(i.margin.left,i.margin.top));var d=a.selectAll(".geometry").data(l),f=this.choropleth(l,i);this.center(t),d.enter().append("path").attr("class","geometry").attr("d",u).style("fill","none").style("stroke",this.modelProperty("stroke",r)).on("mouseover",this.mouseOver()).on("mouseout",this.mouseOut()).merge(d).transition(this.transition("geometry")).attr("d",u).style("stroke",this.modelProperty("stroke",r)).style("fill",f).style("fill-opacity",r.fillOpacity),d.exit().remove()},createGeoPath:function(t){var e,n=this.getModel(),r=this.getGeoProjection(n.projection).scale(n.scale),i=this.$,o=i.geoPath().projection(r),a=this;if(this._geoPath=o,this.center(t),n.leaflet){var s="leaflet-"+n.uid,u=this.paper();this.visualParent.paper.append("div").attr("id",s),(e=new i.Map(s,{center:[37.8,-96.9],zoom:4}).addLayer(new i.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"))).getPanes().overlayPane.appendChild(u.element),r=i.transform({point:function(t,n){var r=e.latLngToLayerPoint(new i.LatLng(n,t));this.stream.point(r.x,r.y)}}),e.on("viewreset",function(){return a.update(t)})}return o},center:function(t){var e=this.getModel();if(e.boundGeometry){var n=this._geoPath,r=n.projection(),i=this.boundingBox(),o=t.topology.objects[e.boundGeometry],a=o?this.$.feature(t.topology,o).features:null;if(!a)return gn('Could not find *boundGeometry* "'+e.boundGeometry+'" for centering - skip centering geochart');r.scale(1).translate([0,0]);var s=n.bounds(a[0]),u=s[0],l=s[1],c=(l[0]-u[0])/i.innerWidth,d=(l[1]-u[1])/i.innerHeight,f=Math.round(e.boundScaleFactor/Math.max(c,d)),h=[(i.innerWidth-f*(l[0]+u[0]))/2,(i.innerHeight-f*(l[1]+u[1]))/2];r.scale(f).translate(h)}},choropleth:function(t,e){var n=this.getModel(),r=n.dataLabelKey,i=n.dataValueKey,o=void 0,a=void 0,u=void 0,l=void 0;return n.neighbors?(o=rn("rank"),l=(a=s.extent(t,o))[1]+1):(o=function(t){return t.data[i]},l=Math.min(n.buckets,t.length),a=qr(s.extent(t,o),l)),u=this.getScale(n.choroplethScale).range(this.colors(l).reverse()).domain(a),this.legend({type:"color",scale:u},e),function(t){return t.label=t.data[r]||t.id,t.value=o(t),t.color=u(t.value),t.color}}});var Gr=["K","M","G"].map(function(t,e){return{symbol:t,size:1<<10*(e+1)}}).reverse();e.inBrowser&&window.development&&Ft.setDebug(!0),Mr.set("redyellowblue",function(t){return t.scaleSequential(d.interpolateRdBu)}),e.assign(Tn.options.dataContext,{$binaryFormat:function(t){var e=c.format(t);return function(t){for(var n=0;n<Gr.length;++n)if(t>=Gr[n].size)return t/=Gr[n].size,e(t)+Gr[n].symbol+"B";return e(t)+"B"}}}),t.start=function(){Te(function(){Nt().mount("body")})},t.appView=Nt,Object.defineProperty(t,"__esModule",{value:!0})});